; ------------------------------------------------------------
; Mad Pascal Compiler version 1.6.6 [2021/07/22] for 6502
; ------------------------------------------------------------

STACKWIDTH	= 16
CODEORIGIN	= $2000

TRUE		= 1
FALSE		= 0

; ------------------------------------------------------------

	org $80

fxptr	.ds 2						; VBXE pointer
psptr	.ds 2						; PROGRAMSTACK Pointer

bp	.ds 2
bp2	.ds 2

eax	.ds 4						;8 bytes (aex + edx) -> divREAL
edx	.ds 4
ecx	.ds 4

TMP
ztmp
ztmp8	.ds 1
ztmp9	.ds 1
ztmp10	.ds 1
ztmp11	.ds 1

STACKORIGIN	.ds STACKWIDTH*4
zpend

; ------------------------------------------------------------

ax	= eax
al	= eax
ah	= eax+1

cx	= ecx
cl	= ecx
ch	= ecx+1

dx	= edx
dl	= edx
dh	= edx+1

	org eax

FP1MAN0	.ds 1
FP1MAN1	.ds 1
FP1MAN2	.ds 1
FP1MAN3	.ds 1

	org ztmp8

FP1SGN	.ds 1
FP1EXP	.ds 1

	org edx

FP2MAN0	.ds 1
FP2MAN1	.ds 1
FP2MAN2	.ds 1
FP2MAN3	.ds 1

	org ztmp10

FP2SGN	.ds 1
FP2EXP	.ds 1

	org ecx

FPMAN0	.ds 1
FPMAN1	.ds 1
FPMAN2	.ds 1
FPMAN3	.ds 1

	org bp2

FPSGN	.ds 1
FPEXP	.ds 1

	.ifdef MAIN.@DEFINES.BASICOFF
	org CODEORIGIN
	icl 'atari\basicoff.asm'
	ini CODEORIGIN
	.endif

	.ifdef MAIN.@DEFINES.S_VBXE
	opt h-
	ins 'atari\s_vbxe\sdxld2.obx'
	opt h+
	.endif

.local	RESOURCE
	icl 'atari\resource.asm'
	?EXTDETECT = 0
	?VBXDETECT = 0

	RCDATA 'keymap.bin' KEY_MAP 0 0 0 0 0 0 0 0
	RCASM 'dlist.asm' DISPLAY_LIST_ADDRESS 0 0 0 0 0 0 0 0
	RCDATA 'head.bin' BIN_HEADER 0 0 0 0 0 0 0 0
.endl

; ------------------------------------------------------------

	org CODEORIGIN

	STATICDATA

; ------------------------------------------------------------

RTLIB
	icl 'rtl6502_a8.asm'

.print 'ZPAGE: ',fxptr,'..',zpend-1

.print 'RTLIB: ',RTLIB,'..',*-1

; ------------------------------------------------------------

START
	tsx
	stx MAIN.@halt+1

	.ifdef fmulinit
	fmulinit
	eif

VLEN	= VARDATASIZE-VARINITSIZE
VADR	= DATAORIGIN+VARINITSIZE

	ift VADR > $BFFF
	ert 'Invalid memory address range ',VADR
	eli (VLEN>0) && (VLEN<=256)
	ldx #256-VLEN
	lda #$00
	sta:rne VADR+VLEN-256,x+
	eli VLEN>256
	@fill #VADR #VLEN #$00
	eif

	mwa #PROGRAMSTACK psptr

	.ifdef MAIN.@DEFINES.ROMOFF
	icl 'atari\romoff.asm'
	.endif

	ldx #$0F					; DOS II+/D ParamStr
	mva:rpl $340,x MAIN.IOCB@COPY,x-

	inx						; X = 0
	stx bp						; BP = 0

	stx skctl					; reset POKEY
	lda #3
	sta skctl

	dex						; X = 255

	UNITINITIALIZATION

.local	MAIN						; PROCEDURE

	jmp l_03E1

; ------------------------------------------------------------

.local	SYSTEM						; UNIT

.local	HEXSTR						; FUNCTION | ASSEMBLER | REGISTER

; ---------------------  ASM Block 001  ---------------------

	jsr @hexStr

;	@move #@buf Result #33
	ldy #256-33
	mva:rne @buf+33-256,y adr.Result+33-256,y+

@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

VALUE	= edx
DIGITS	= ecx
adr.RESULT	= [DATAORIGIN+$000B] .array [33]
.var RESULT	= adr.RESULT .word

@VarData	= RESULT
@VarDataSize	= 33

	rts						; ret
.endl

.local	PEEK						; FUNCTION | ASSEMBLER | REGISTER

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta A
	lda :STACKORIGIN+STACKWIDTH,x
	sta A+1
	dex

; ---------------------  ASM Block 002  ---------------------

	ldy #0
	mva (edx),y Result

@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

A	= edx
RESULT	= DATAORIGIN+$002C

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	UPCASE						; FUNCTION
	sta A

; optimize OK (SYSTEM), line = 1166

	lda A
	sta @CASETMP_0002
	clc						; clear carry for add
	adc #$FF-$7A					; make m = $FF
	adc #$7A-$61+1					; carry set if in range n to m
	jcc l_041D
@

; optimize OK (SYSTEM), line = 1167

	lda A
	sub #$20
	sta RESULT

	jmp a_0002
l_041D

; optimize OK (SYSTEM), line = 1169

	lda A
	sta RESULT
a_0002
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

A	= DATAORIGIN+$002D
RESULT	= DATAORIGIN+$002E
@CASETMP_0002	= DATAORIGIN+$002F

@VarData	= A
@VarDataSize	= 3

	rts						; ret
.endl

.local	STR_044C					; PROCEDURE | ASSEMBLER | OVERLOAD

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta S
	lda :STACKORIGIN+STACKWIDTH,x
	sta S+1
	dex

; ------------------------------------------------------------

; Generate Assignment for CARDINAL / INTEGER / REAL / SINGLE
; as Pointer
	lda :STACKORIGIN,x
	sta A
	lda :STACKORIGIN+STACKWIDTH,x
	sta A+1
	lda :STACKORIGIN+STACKWIDTH*2,x
	sta A+2
	lda :STACKORIGIN+STACKWIDTH*3,x
	sta A+3
	dex

; ---------------------  ASM Block 016  ---------------------

	txa:pha

	inx

	@ValueToStr #@printCARD

	@move #@buf s #16	; !!! koniecznie przez wskaznik

	pla:tax


; ------------------------------------------------------------

A	= DATAORIGIN+$0030
S	= DATAORIGIN+$0034

@VarData	= A
@VarDataSize	= 6

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	POKE						; PROCEDURE | ASSEMBLER | REGISTER

; ------------------------------------------------------------

; Generate Assignment for BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer
	lda :STACKORIGIN,x
	sta VALUE
	dex

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta A
	lda :STACKORIGIN+STACKWIDTH,x
	sta A+1
	dex

; ---------------------  ASM Block 017  ---------------------

	ldy #0
	mva value (edx),y


; ------------------------------------------------------------

A	= edx
VALUE	= ecx
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	FILLBYTE_045A					; PROCEDURE | ASSEMBLER | OVERLOAD | REGISTER | INLINE

	.MACRO m@INLINE

; ---------------------  ASM Block 025  ---------------------

	jsr @fill

	.ENDM

; ------------------------------------------------------------

A	= edx
COUNT	= ecx
VALUE	= eax
@exit
.endl

.local	MOVE_045B					; PROCEDURE | ASSEMBLER | OVERLOAD | REGISTER | INLINE

	.MACRO m@INLINE

; ---------------------  ASM Block 027  ---------------------

	jsr @move

	.ENDM

; ------------------------------------------------------------

SOURCE	= edx
DEST	= ecx
COUNT	= eax
@exit
.endl

.local	MOVE_045C					; PROCEDURE | ASSEMBLER | OVERLOAD | REGISTER | INLINE

	.MACRO m@INLINE

; ---------------------  ASM Block 028  ---------------------

	jsr @move

	.ENDM

; ------------------------------------------------------------

SOURCE	= edx
DEST	= ecx
COUNT	= eax
@exit
.endl

.local	MOVE_045D					; PROCEDURE | ASSEMBLER | OVERLOAD | REGISTER | INLINE

	.MACRO m@INLINE

; ---------------------  ASM Block 029  ---------------------

	jsr @move

	.ENDM

; ------------------------------------------------------------

SOURCE	= edx
DEST	= ecx
COUNT	= eax
@exit
.endl

.local	PAUSE_0472					; PROCEDURE | ASSEMBLER | OVERLOAD

; ---------------------  ASM Block 035  ---------------------

	lda:cmp:req :rtclok+2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

; ------------------------------------------------------------

__PORTB_BANKS	= $0101
M_PI_2	= $0648
D_PI_2	= $0192
D_PI_180	= $04
MGTIA	= $00
MVBXE	= $80
VBXE_XDLADR	= $00
VBXE_BCBADR	= $0100
VBXE_MAPADR	= $1000
VBXE_CHBASE	= $1000
VBXE_OVRADR	= $5000
VBXE_WINDOW	= $B000
IDLI	= $00
IVBL	= $01
CH_DELCHR	= $FE
CH_ENTER	= $9B
CH_ESC	= $1B
CH_CURS_UP	= $1C
CH_CURS_DOWN	= $1D
CH_CURS_LEFT	= $1E
CH_CURS_RIGHT	= $1F
CH_TAB	= $7F
CH_EOL	= $9B
CH_CLR	= $7D
CH_BELL	= $FD
CH_DEL	= $7E
CH_DELLINE	= $9C
CH_INSLINE	= $9D
COLOR_BLACK	= $00
COLOR_WHITE	= $0E
COLOR_RED	= $32
COLOR_CYAN	= $96
COLOR_VIOLET	= $68
COLOR_GREEN	= $C4
COLOR_BLUE	= $74
COLOR_YELLOW	= $EE
COLOR_ORANGE	= $28
COLOR_BROWN	= $E4
COLOR_LIGHTRED	= $3C
COLOR_GRAY1	= $04
COLOR_GRAY2	= $06
COLOR_GRAY3	= $0A
COLOR_LIGHTGREEN	= $CC
COLOR_LIGHTBLUE	= $7C
FMOPENREAD	= $04
FMOPENWRITE	= $08
FMOPENAPPEND	= $09
FMOPENREADWRITE	= $0C
SCREENWIDTH	= DATAORIGIN+$0000
SCREENHEIGHT	= DATAORIGIN+$0002
DATESEPARATOR	= DATAORIGIN+$0004
RND	= $D20A
adr.PALETTE	= $02C0
.var PALETTE	= adr.PALETTE .word
adr.HPALETTE	= $D012
.var HPALETTE	= adr.HPALETTE .word
FILEMODE	= DATAORIGIN+$0005
GRAPHMODE	= DATAORIGIN+$0006
IORESULT	= DATAORIGIN+$0007
EOLN	= DATAORIGIN+$0008
RNDSEED	= DATAORIGIN+$0009

.endl							; UNIT SYSTEM

; ------------------------------------------------------------

.local	ATARI						; UNIT

; ------------------------------------------------------------

IRQENS	= $10
RTCLOK	= $12
ATRACT	= $4D
LMARGIN	= $52
RMARGIN	= $53
ROWCRS	= $54
COLCRS	= $55
DINDEX	= $57
SAVMSC	= $58
PALNTS	= $62
RAMTOP	= $6A
VDSLST	= $0200
SDLSTL	= $0230
TXTROW	= $0290
TXTCOL	= $0291
TINDEX	= $0293
TXTMSC	= $0294
SDMCTL	= $022F
GPRIOR	= $026F
CRSINH	= $02F0
CHACT	= $02F3
CHBAS	= $02F4
CH	= $02FC
PCOLR0	= $02C0
PCOLR1	= $02C1
PCOLR2	= $02C2
PCOLR3	= $02C3
COLOR0	= $02C4
COLOR1	= $02C5
COLOR2	= $02C6
COLOR3	= $02C7
COLOR4	= $02C8
COLBAKS	= $02C8
HPOSP0	= $D000
HPOSP1	= $D001
HPOSP2	= $D002
HPOSP3	= $D003
HPOSM0	= $D004
HPOSM1	= $D005
HPOSM2	= $D006
HPOSM3	= $D007
SIZEP0	= $D008
SIZEP1	= $D009
SIZEP2	= $D00A
SIZEP3	= $D00B
SIZEM	= $D00C
GRAFP0	= $D00D
GRAFP1	= $D00E
GRAFP2	= $D00F
GRAFP3	= $D010
GRAFM	= $D011
P0PF	= $D004
PAL	= $D014
COLPM0	= $D012
COLPM1	= $D013
COLPM2	= $D014
COLPM3	= $D015
COLPF0	= $D016
COLPF1	= $D017
COLPF2	= $D018
COLPF3	= $D019
COLBK	= $D01A
PRIOR	= $D01B
GRACTL	= $D01D
HITCLR	= $D01E
CONSOL	= $D01F
AUDF1	= $D200
AUDC1	= $D201
AUDF2	= $D202
AUDC2	= $D203
AUDF3	= $D204
AUDC3	= $D205
AUDF4	= $D206
AUDC4	= $D207
AUDCTL	= $D208
KBCODE	= $D209
IRQEN	= $D20E
SKSTAT	= $D20F
PORTA	= $D300
PORTB	= $D301
DMACTL	= $D400
CHACTL	= $D401
DLISTL	= $D402
HSCROL	= $D404
VSCROL	= $D405
PMBASE	= $D407
CHBASE	= $D409
WSYNC	= $D40A
VCOUNT	= $D40B
PENH	= $D40C
PENV	= $D40D
NMIEN	= $D40E
NMIVEC	= $FFFA
RESETVEC	= $FFFC
IRQVEC	= $FFFE

.endl							; UNIT ATARI

; ------------------------------------------------------------

.local	CRT						; UNIT

.local	READKEY						; FUNCTION | ASSEMBLER

; ---------------------  ASM Block 050  ---------------------

	m@call @GetKey
	sta Result

@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0037

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	KEYPRESSED					; FUNCTION | ASSEMBLER

; ---------------------  ASM Block 054  ---------------------

	ldy #$00	; false
	lda kbcodes
	cmp #$ff
	beq skp
	iny		; true

;	sty kbcodes

skp	sty Result

@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0038

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	TEXTMODE					; PROCEDURE | ASSEMBLER
	sta MODE

; ---------------------  ASM Block 060  ---------------------

	txa:pha

	@clrscr

	pla:tax


; ------------------------------------------------------------

MODE	= DATAORIGIN+$0039

@VarData	= MODE
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

; ------------------------------------------------------------

TEXTATTR	= DATAORIGIN+$0036
CONSOL	= $D01F
CN_START_SELECT_OPTION	= $00
CN_SELECT_OPTION	= $01
CN_START_OPTION	= $02
CN_OPTION	= $03
CN_START_SELECT	= $04
CN_SELECT	= $05
CN_START	= $06
CN_NONE	= $07
BW40	= $00
CO40	= $01
BW80	= $02
CO80	= $03
MONO	= $07
C40	= $01
C80	= $03
BLACK	= $00
BLUE	= $01
GREEN	= $02
CYAN	= $03
RED	= $04
MAGENTA	= $05
BROWN	= $06
LIGHTGRAY	= $07
DARKGRAY	= $08
LIGHTBLUE	= $09
LIGHTGREEN	= $0A
LIGHTCYAN	= $0B
LIGHTRED	= $0C
LIGHTMAGENTA	= $0D
YELLOW	= $0E
WHITE	= $0F
BLINK	= $80

.endl							; UNIT CRT

; ------------------------------------------------------------

.local	DOS						; UNIT

; ------------------------------------------------------------

PALNTSC	= $D014

.endl							; UNIT DOS

; ------------------------------------------------------------

.local	STRUTILS					; UNIT

; ------------------------------------------------------------

.endl							; UNIT STRUTILS

; ------------------------------------------------------------

.local	SYSUTILS					; UNIT

.local	FINDFIRST					; FUNCTION

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta SEARCHRESULT
	lda :STACKORIGIN+STACKWIDTH,x
	sta SEARCHRESULT+1
	dex

; ------------------------------------------------------------

; Generate Assignment for BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer
	lda :STACKORIGIN,x
	sta ATTRIBUTES
	dex

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta :bp2
	lda :STACKORIGIN+STACKWIDTH,x
	sta :bp2+1
	ldy #$20
	mva:rpl (:bp2),y adr.FILEMASK,y-
	mwa #adr.FILEMASK FILEMASK
	dex

; AssignFile

; optimize OK (SYSUTILS), line = 178

	mwy F :bp2
	ldy #s@file.pfname
	lda FILEMASK
	sta (:bp2),y
	iny
	lda FILEMASK+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y

; ---------------------  ASM Block 066  ---------------------

	txa:pha

	clc			; iocheck off
	@openfile f #6
loop
	mwa SearchResult :bp2

	ldy #SearchResult.ExcludeAttr-DATAORIGIN
	lda Attributes
	sta (:bp2),y

	ldy #SearchResult.FindHandle-DATAORIGIN

	lda f
	sta (:bp2),y
	iny
	lda f+1
	sta (:bp2),y

	mwa f :bp2

	ldy #s@file.record
	mva <1 (:bp2),y
	iny
	mva >1 (:bp2),y

	ldy #s@file.nrecord
	mva <64 (:bp2),y
	iny
	mva >64 (:bp2),y

	ldy #s@file.buffer
	mva <@buf (:bp2),y
	iny
	mva >@buf (:bp2),y

	@ReadDirFileName f
	sta Result

	adw SearchResult #SearchResult.Name-DATAORIGIN :bp2

	jsr @DirFileName

	mwa SearchResult :bp2

	ldy #SearchResult.Attr-DATAORIGIN
	txa
	sta (:bp2),y

	and Attributes
	ora Result
	beq loop

	pla:tax

@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

adr.FILEMASK	= [DATAORIGIN+$003A] .array [33]
.var FILEMASK	= adr.FILEMASK .word
ATTRIBUTES	= DATAORIGIN+$005B
SEARCHRESULT	= DATAORIGIN+$005C
SEARCHRESULT.ATTR	= DATAORIGIN+$0000
SEARCHRESULT.EXCLUDEATTR	= DATAORIGIN+$0001
SEARCHRESULT.NAME	= DATAORIGIN+$0002
SEARCHRESULT.FINDHANDLE	= DATAORIGIN+$0023
RESULT	= DATAORIGIN+$005E
.var F	= DATAORIGIN+$005F .word

@VarData	= FILEMASK
@VarDataSize	= 37

	rts						; ret
.endl

.local	FINDNEXT					; FUNCTION | ASSEMBLER

; ---------------------  ASM Block 067  ---------------------

	txa:pha

loop	mwa f :bp2
	ldy #f.FindHandle-DATAORIGIN
	mva (:bp2),y edx
	iny
	mva (:bp2),y edx+1

	@ReadDirFileName edx
	sta Result

	adw f #f.Name-DATAORIGIN :bp2

	jsr @DirFileName

	mwa f :bp2

	ldy #f.Attr-DATAORIGIN
	txa
	sta (:bp2),y

	ldy #f.ExcludeAttr-DATAORIGIN
	and (:bp2),y
	ora Result
	beq loop

	pla:tax

@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

F	= DATAORIGIN+$006B
F.ATTR	= DATAORIGIN+$0000
F.EXCLUDEATTR	= DATAORIGIN+$0001
F.NAME	= DATAORIGIN+$0002
F.FINDHANDLE	= DATAORIGIN+$0023
RESULT	= DATAORIGIN+$006D

@VarData	= F
@VarDataSize	= 3

	rts						; ret
.endl

.local	FINDCLOSE					; PROCEDURE | ASSEMBLER

; ---------------------  ASM Block 068  ---------------------

	txa:pha

	mwa f :bp2
	ldy #f.FindHandle-DATAORIGIN
	mva (:bp2),y edx
	iny
	mva (:bp2),y edx+1

	clc			; iocheck off
	@closefile edx

	pla:tax


; ------------------------------------------------------------

F	= DATAORIGIN+$006E
F.ATTR	= DATAORIGIN+$0000
F.EXCLUDEATTR	= DATAORIGIN+$0001
F.NAME	= DATAORIGIN+$0002
F.FINDHANDLE	= DATAORIGIN+$0023

@VarData	= F
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	FILEEXISTS					; FUNCTION

; optimize OK (SYSUTILS), line = 433

	lda SYSTEM.FILEMODE
	sta FM
; AssignFile

; optimize OK (SYSUTILS), line = 436

	mwy F :bp2
	ldy #s@file.pfname
	lda NAME
	sta (:bp2),y
	iny
	lda NAME+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y

; optimize OK (SYSUTILS), line = 437

	lda #$04
	sta SYSTEM.FILEMODE
; Reset

; optimize OK (SYSUTILS), line = 438

	ldy #s@file.record
	lda #$80
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@openfile F, MAIN.SYSTEM.FileMode
	pla:tax

; optimize OK (SYSUTILS), line = 439

	lda SYSTEM.IORESULT
	jmi l_04E2s
	ldy NAME+1
	sty :bp+1
	ldy NAME
	lda (:bp),y
	jeq l_04E2s
	mva:sne #true RESULT
l_04E2s
	mva #false RESULT
; CloseFile

	txa:pha
	clc
	@closefile F
	pla:tax

; optimize OK (SYSUTILS), line = 443

	lda FM
	sta SYSTEM.FILEMODE
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

NAME	= DATAORIGIN+$0070
RESULT	= DATAORIGIN+$0072
.var F	= DATAORIGIN+$0073 .word
FM	= DATAORIGIN+$007F

@VarData	= NAME
@VarDataSize	= 4

	rts						; ret
.endl

.local	ANSIUPPERCASE					; FUNCTION | REGISTER

; optimize OK (SYSUTILS), line = 728

	lda A
	sta @move.src
	lda A+1
	sta @move.src+1
	mwy RESULT :bp2
	ldy #$00
	mva:rne (@move.src),y (:bp2),y+

; optimize OK (SYSUTILS), line = 730

	ldy A+1
	sty :bp+1
	ldy A
	lda (:bp),y
	sta J

l_050E
; --- ForToDoCondition
	lda J
	cmp #$01
	jcc l_051C
	inx
	mva J :STACKORIGIN,x
	ldy J
	lda adr.RESULT,y
	jsr SYSTEM.UPCASE
	ldy :STACKORIGIN-1,x
	lda :STACKORIGIN,x
	sta adr.RESULT,y
	dex
	dex

; --- ForToDoEpilog
	dec J
	jne l_050E
l_051C
@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

A	= edx
adr.RESULT	= [DATAORIGIN+$0080] .array [256]
.var RESULT	= adr.RESULT .word
J	= DATAORIGIN+$0180
@FORTMP_050B	= $01

@VarData	= RESULT
@VarDataSize	= 257

	rts						; ret
.endl

; ------------------------------------------------------------

FAREADONLY	= $01
FAHIDDEN	= $02
FASYSFILE	= $04
FAVOLUMEID	= $08
FADIRECTORY	= $10
FAARCHIVE	= $20
FAANYFILE	= $3F

.endl							; UNIT SYSUTILS

; ------------------------------------------------------------

.local	B_CRT						; UNIT

.local	ATASCII2ANTIC_053F				; FUNCTION | OVERLOAD
	sta C

; ---------------------  ASM Block 079  ---------------------


        lda c
        asl
        php
        cmp #2*$60
        bcs @+
        sbc #2*$20-1
        bcs @+
        adc #2*$60
@       plp
        ror
        sta result;
    
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

C	= DATAORIGIN+$018A
RESULT	= DATAORIGIN+$018B

@VarData	= C
@VarDataSize	= 2

	rts						; ret
.endl

.local	ANTIC2ATASCII_0546				; FUNCTION | OVERLOAD
	sta C

; ---------------------  ASM Block 080  ---------------------


        lda c
        asl
        php
        cmp #2*$60
        bcs @+
        sbc #2*$40-1
        bcs @+
        adc #2*$60
@       plp
        ror
        sta result;
    
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

C	= DATAORIGIN+$018C
RESULT	= DATAORIGIN+$018D

@VarData	= C
@VarDataSize	= 2

	rts						; ret
.endl

.local	ATASCII2ANTIC_054D				; FUNCTION | OVERLOAD

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta :bp2
	lda :STACKORIGIN+STACKWIDTH,x
	sta :bp2+1
	ldy #$00
	mva:rne (:bp2),y adr.S,y+
	mwa #adr.S S
	dex

; optimize OK (B_CRT), line = 468

	lda adr.S+$00
	sta adr.RESULT+$00

; optimize OK (B_CRT), line = 469

	lda #$01
	sta I
	mva adr.S+$00 :@FORTMP?0564_0

l_0567
; --- ForToDoCondition
.def :@FORTMP?0564_0 = *+1
	lda #$00
	cmp I
	jcc l_0575

; optimize FAIL (1, B_CRT), line = 470

	inx
	mva I :STACKORIGIN,x
	ldy I
	lda adr.S,y
	jsr ATASCII2ANTIC_053F
	ldy :STACKORIGIN-1,x
	lda :STACKORIGIN,x
	sta adr.RESULT,y
	dex
	dex

; --- ForToDoEpilog
	inc I
	jne l_0567
l_0575
@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

adr.S	= [DATAORIGIN+$018E] .array [256]
.var S	= adr.S .word
adr.RESULT	= [DATAORIGIN+$028E] .array [256]
.var RESULT	= adr.RESULT .word
I	= DATAORIGIN+$038E
@FORTMP_0564	= $00

@VarData	= S
@VarDataSize	= 513

	rts						; ret
.endl

.local	ANTIC2ATASCII_058A				; FUNCTION | OVERLOAD

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta :bp2
	lda :STACKORIGIN+STACKWIDTH,x
	sta :bp2+1
	ldy #$00
	mva:rne (:bp2),y adr.S,y+
	mwa #adr.S S
	dex

; optimize OK (B_CRT), line = 476

	lda adr.S+$00
	sta adr.RESULT+$00

; optimize OK (B_CRT), line = 477

	lda #$01
	sta I
	mva adr.S+$00 :@FORTMP?05A1_0

l_05A4
; --- ForToDoCondition
.def :@FORTMP?05A1_0 = *+1
	lda #$00
	cmp I
	jcc l_05B2

; optimize FAIL (1, B_CRT), line = 478

	inx
	mva I :STACKORIGIN,x
	ldy I
	lda adr.S,y
	jsr ANTIC2ATASCII_0546
	ldy :STACKORIGIN-1,x
	lda :STACKORIGIN,x
	sta adr.RESULT,y
	dex
	dex

; --- ForToDoEpilog
	inc I
	jne l_05A4
l_05B2
@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

adr.S	= [DATAORIGIN+$0390] .array [256]
.var S	= adr.S .word
adr.RESULT	= [DATAORIGIN+$0490] .array [256]
.var RESULT	= adr.RESULT .word
I	= DATAORIGIN+$0590
@FORTMP_05A1	= $00

@VarData	= S
@VarDataSize	= 513

	rts						; ret
.endl

.local	CRT_INIT_05C7					; PROCEDURE | OVERLOAD

; optimize OK (B_CRT), line = 483

	lda VRAM_ADDRESS
	sta CRT_VRAM
	lda VRAM_ADDRESS+1
	sta CRT_VRAM+1

; optimize OK (B_CRT), line = 484

	lda WIDTH
	sta CRT_SCREENWIDTH

; optimize OK (B_CRT), line = 485

	lda HEIGHT
	sta CRT_SCREENHEIGHT

; optimize OK (B_CRT), line = 486

	sta :ecx
	lda WIDTH
	sta :eax
	.ifdef fmulinit
	fmulu_8
	els
	imulCL
	eif
	sta CRT_SIZE+1
	lda :eax
	sta CRT_SIZE

; optimize OK (B_CRT), line = 487

	lda CRT_VRAM
	sta CRT_CURSOR
	lda CRT_VRAM+1
	sta CRT_CURSOR+1

; optimize OK (B_CRT), line = 488

	lda #$00
	sta CRT_LEFTMARGIN

; ------------------------------------------------------------

VRAM_ADDRESS	= DATAORIGIN+$0592
WIDTH	= DATAORIGIN+$0594
HEIGHT	= DATAORIGIN+$0595

@VarData	= VRAM_ADDRESS
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CRT_GOTOXY					; PROCEDURE

; optimize OK (B_CRT), line = 516

	lda CRT_SCREENWIDTH
	sta :ecx
	lda Y
	sta :eax
	.ifdef fmulinit
	fmulu_8
	els
	imulCL
	eif
	lda :eax
	add X
	sta :STACKORIGIN+9
	lda :eax+1
	adc #$00
	sta :STACKORIGIN+STACKWIDTH+9
	lda :STACKORIGIN+9
	add CRT_VRAM
	sta CRT_CURSOR
	lda :STACKORIGIN+STACKWIDTH+9
	adc CRT_VRAM+1
	sta CRT_CURSOR+1

; ------------------------------------------------------------

X	= DATAORIGIN+$0596
Y	= DATAORIGIN+$0597

@VarData	= X
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CRT_WRITE_060C					; PROCEDURE | OVERLOAD

; ------------------------------------------------------------

; Generate Assignment for WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer
	lda :STACKORIGIN,x
	sta :bp2
	lda :STACKORIGIN+STACKWIDTH,x
	sta :bp2+1
	ldy #$00
	mva:rne (:bp2),y adr.S,y+
	mwa #adr.S S
	dex

; optimize OK (B_CRT), line = 531

	lda <adr.S+$01
	sta SYSTEM.MOVE_045D.SOURCE
	lda >adr.S+$01
	sta SYSTEM.MOVE_045D.SOURCE+1
	lda adr.S+$00
	sta SYSTEM.MOVE_045D.COUNT
	lda #$00
	sta SYSTEM.MOVE_045D.COUNT+1
	lda CRT_CURSOR
	sta SYSTEM.MOVE_045D.DEST
	lda CRT_CURSOR+1
	sta SYSTEM.MOVE_045D.DEST+1
	.local +MAIN.SYSTEM.MOVE_045D
	m@INLINE
	.endl

; optimize OK (B_CRT), line = 532

	lda CRT_CURSOR
	add adr.S+$00
	sta CRT_CURSOR
	scc
	inc CRT_CURSOR+1

; ------------------------------------------------------------

adr.S	= [DATAORIGIN+$0598] .array [256]
.var S	= adr.S .word

@VarData	= S
@VarDataSize	= 256

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CRT_PUT_061F					; PROCEDURE | OVERLOAD
	sta B

; optimize OK (B_CRT), line = 574

	ldy CRT_CURSOR+1
	sty :bp+1
	ldy CRT_CURSOR
	lda B
	sta (:bp),y

; optimize FAIL (0, B_CRT), line = 575

	inc CRT_CURSOR
	sne
	inc CRT_CURSOR+1

; ------------------------------------------------------------

B	= DATAORIGIN+$0698

@VarData	= B
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CRT_KEYPRESSED					; FUNCTION

; optimize OK (B_CRT), line = 592

	lda #$00
	sta RESULT

; optimize OK (B_CRT), line = 593

	lda ATARI.SKSTAT
	and #$04
	jne l_064A
	lda #$01
	sta RESULT
l_064A
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0699

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_READKEY					; FUNCTION

; optimize OK (B_CRT), line = 598

	lda KBCODE
	sta RESULT

; --- RepeatUntilProlog
l_065F

; optimize FAIL ('CRT_KEYPRESSED', B_CRT), line = 599

	jsr CRT_KEYPRESSED
	jsr notBOOLEAN
	dex
	ldy #1
	lda RESULT
	cmp KBCODE
	bne @+
	dey
@
	tya
	ora :STACKORIGIN+1,x
	jeq l_065F

; --- RepeatUntilProlog
l_0676

; optimize FAIL ('CRT_KEYPRESSED', B_CRT), line = 600

	jsr CRT_KEYPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_0676

; optimize OK (B_CRT), line = 601

	lda KBCODE
	sta RESULT
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$069A

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_READCHAR					; FUNCTION

; --- RepeatUntilProlog
l_0689

; optimize FAIL (0, B_CRT), line = 607

	jsr CRT_READKEY
	ldy :STACKORIGIN,x
	lda adr.CRT_KEYCODE,y
	sta RESULT
	dex

; optimize OK (B_CRT), line = 608

	lda RESULT
	cmp #$FF
	jeq l_0689
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$069B

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_READCHARI					; FUNCTION

; optimize FAIL ('CRT_READCHAR', B_CRT), line = 613

	jsr CRT_READCHAR
	lda :STACKORIGIN,x
	dex
	jsr ATASCII2ANTIC_053F
	lda :STACKORIGIN,x
	sta RESULT
	dex
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$069C

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_READSTRINGI_06AD				; FUNCTION | OVERLOAD
	sta LIMIT

	mva #$00 adr.RESULT

; --- RepeatUntilProlog
l_06B1

; optimize FAIL ('CRT_READCHARI', B_CRT), line = 621

	jsr CRT_READCHARI
	lda :STACKORIGIN,x
	sta A
	dex

; optimize OK (B_CRT), line = 622

	lda A
	cmp #$DB
	jne l_06C7
	jmp @exit					; exit
l_06C7

; optimize OK (B_CRT), line = 623

	lda A
	cmp #$7E
	jne l_06EE
	lda adr.RESULT+$00
	jeq l_06EE

; optimize FAIL (0, B_CRT), line = 624

	dew CRT_CURSOR

; optimize OK (B_CRT), line = 625

	ldy CRT_CURSOR+1
	sty :bp+1
	ldy CRT_CURSOR
	lda #$00
	sta (:bp),y

; optimize OK (B_CRT), line = 626

	dec adr.RESULT+$00
	jmp l_0702
l_06EE

; optimize OK (B_CRT), line = 628

	lda A
	cmp #$C2
	jeq l_0753
	cmp #$C1
	jeq l_0753
	cmp #$7F
	jeq l_0753
	cmp #$5B
	jeq l_0753
	cmp #$7E
	jeq l_0753
	lda adr.RESULT+$00
	cmp LIMIT
	jcs l_0753

; optimize OK (B_CRT), line = 634

	lda A
	jsr CRT_PUT_061F

; optimize OK (B_CRT), line = 635

	inc adr.RESULT+$00

; optimize OK (B_CRT), line = 636

	ldy adr.RESULT+$00
	lda A
	sta adr.RESULT,y
l_0753
l_0702

; optimize OK (B_CRT), line = 638

	jmp l_06B1
@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

LIMIT	= DATAORIGIN+$069D
adr.RESULT	= [DATAORIGIN+$069E] .array [256]
.var RESULT	= adr.RESULT .word
A	= DATAORIGIN+$079E

@VarData	= LIMIT
@VarDataSize	= 258

	rts						; ret
.endl

.local	CRT_READSTRING_076E				; FUNCTION | OVERLOAD
	sta LIMIT

; optimize OK (B_CRT), line = 648

	lda LIMIT
	jsr CRT_READSTRINGI_06AD
	jsr ANTIC2ATASCII_058A
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	mwy RESULT :bp2
	ldy #$00
	mva:rne (@move.src),y (:bp2),y+
	dex
@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

LIMIT	= DATAORIGIN+$079F
adr.RESULT	= [DATAORIGIN+$07A0] .array [256]
.var RESULT	= adr.RESULT .word

@VarData	= LIMIT
@VarDataSize	= 257

	rts						; ret
.endl

.local	CRT_STARTPRESSED				; FUNCTION

; optimize OK (B_CRT), line = 749

	lda CONSOL
	ldy #1
	and #$01
	beq @+
	dey
@
	tya
	sta RESULT
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$08A0

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_SELECTPRESSED				; FUNCTION

; optimize OK (B_CRT), line = 754

	lda CONSOL
	ldy #1
	and #$02
	beq @+
	dey
@
	tya
	sta RESULT
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$08A1

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_OPTIONPRESSED				; FUNCTION

; optimize OK (B_CRT), line = 759

	lda CONSOL
	ldy #1
	and #$04
	beq @+
	dey
@
	tya
	sta RESULT
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$08A2

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	CRT_HELPPRESSED					; FUNCTION

; optimize FAIL ('CRT_KEYPRESSED', B_CRT), line = 764

	jsr CRT_KEYPRESSED
	lda KBCODE
	ldy #1
	and #$3F
	cmp #$11
	beq @+
	dey
@
	tya
	and :STACKORIGIN+1,x
	sta RESULT
	dex
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$08A3

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

; ------------------------------------------------------------

DEFAULT_SCREENWIDTH	= $28
DEFAULT_SCREENHEIGHT	= $18
CHAR_RETURN	= $9B
CHAR_ESCAPE	= $1B
CHAR_BACKSPACE	= $7E
CHAR_TAB	= $7F
CHAR_INVERSE	= $81
CHAR_CAPS	= $82
ICHAR_RETURN	= $DB
ICHAR_ESCAPE	= $5B
ICHAR_BACKSPACE	= $7E
ICHAR_TAB	= $7F
ICHAR_INVERSE	= $C1
ICHAR_CAPS	= $C2
adr.CRT_KEYCODE	= CODEORIGIN+$03DA
.var CRT_KEYCODE	= adr.CRT_KEYCODE .word
CRT_VRAM	= DATAORIGIN+$0181
CRT_SIZE	= DATAORIGIN+$0183
CRT_SCREENWIDTH	= DATAORIGIN+$0185
CRT_SCREENHEIGHT	= DATAORIGIN+$0186
CRT_CURSOR	= DATAORIGIN+$0187
CRT_LEFTMARGIN	= DATAORIGIN+$0189
KBCODE	= $D209
CONSOL	= $D01F

.endl							; UNIT B_CRT

; ------------------------------------------------------------

.local	B_SYSTEM					; UNIT

; ------------------------------------------------------------

__NMIEN	= DATAORIGIN+$08A4
PORTB_SELFTEST_OFF	= $80
PORTB_BASIC_OFF	= $02
PORTB_SYSTEM_ON	= $01

.endl							; UNIT B_SYSTEM

; ------------------------------------------------------------

.local	B_PMG						; UNIT

.local	PMG_INIT_07E2					; PROCEDURE | OVERLOAD

; optimize OK (B_PMG), line = 171

	lda BASE
	sta PMG_PMBASE

; optimize OK (B_PMG), line = 172

	lda #$00
	sta PMG_BASE
	lda BASE
	sta PMG_BASE+1

; optimize OK (B_PMG), line = 173

	lda GRACTL
	sta PMG_GRACTL

; optimize OK (B_PMG), line = 174

	lda PMG_SDMCTL_S
	and #$E0
	ora SDMCTL
	sta SDMCTL_FLAGS

; optimize OK (B_PMG), line = 175

	sta PMG_SDMCTL

; optimize OK (B_PMG), line = 176

	sta PMG_SDMCTL_S

; optimize OK (B_PMG), line = 177

	lda SDMCTL
	and #$10
	jeq l_082D

; optimize OK (B_PMG), line = 178

	lda #$01
	sta PMG_ONELINE

; optimize OK (B_PMG), line = 179

	lda #$00
	sta PMG_SIZE
	lda #$08
	sta PMG_SIZE+1
	jmp l_083F
l_082D

; optimize OK (B_PMG), line = 181

	lda #$00
	sta PMG_ONELINE

; optimize OK (B_PMG), line = 182

	sta PMG_SIZE
	lda #$04
	sta PMG_SIZE+1
l_083F

; ------------------------------------------------------------

BASE	= DATAORIGIN+$08AA
SDMCTL	= DATAORIGIN+$08AB
GRACTL	= DATAORIGIN+$08AC
SDMCTL_FLAGS	= DATAORIGIN+$08AD

@VarData	= BASE
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	PMG_INIT_0848					; PROCEDURE | OVERLOAD

; optimize OK (B_PMG), line = 189

	lda GRACTL
	sta PMG_INIT_07E2.GRACTL
	lda SDMCTL
	sta PMG_INIT_07E2.SDMCTL
	lda BASE
	sta PMG_INIT_07E2.BASE
	jsr PMG_INIT_07E2

; ------------------------------------------------------------

BASE	= DATAORIGIN+$08AE
SDMCTL	= DATAORIGIN+$08AF
GRACTL	= DATAORIGIN+$08B0

@VarData	= BASE
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	PMG_INIT_0856					; PROCEDURE | OVERLOAD
	sta BASE

; optimize OK (B_PMG), line = 195

	lda SDMCTL
	sta PMG_INIT_0848.SDMCTL
	lda BASE
	sta PMG_INIT_0848.BASE
	jsr PMG_INIT_0848

; ------------------------------------------------------------

BASE	= DATAORIGIN+$08B1
SDMCTL	= DATAORIGIN+$08B2

@VarData	= BASE
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	PMG_DISABLE					; PROCEDURE

; optimize OK (B_PMG), line = 206

	lda #$00
	sta PMG_GRACTL

; optimize OK (B_PMG), line = 207

	lda PMG_SDMCTL_S
	and #$C3
	sta SDMCTL_FLAGS

; optimize OK (B_PMG), line = 208

	sta PMG_SDMCTL

; optimize OK (B_PMG), line = 209

	sta PMG_SDMCTL_S

; ------------------------------------------------------------

SDMCTL_FLAGS	= DATAORIGIN+$08B3

@VarData	= SDMCTL_FLAGS
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

; ------------------------------------------------------------

PMG_VDELAY_M0	= $01
PMG_VDELAY_M1	= $02
PMG_VDELAY_M2	= $04
PMG_VDELAY_M3	= $08
PMG_VDELAY_P0	= $10
PMG_VDELAY_P1	= $20
PMG_VDELAY_P2	= $40
PMG_VDELAY_P3	= $80
PMG_SIZE_NORMAL	= $00
PMG_SIZE_X2	= $01
PMG_SIZE_X4	= $03
PMG_MSIZE0_X2	= $01
PMG_MSIZE0_X4	= $03
PMG_MSIZE1_X2	= $04
PMG_MSIZE1_X4	= $0C
PMG_MSIZE2_X2	= $10
PMG_MSIZE2_X4	= $30
PMG_MSIZE3_X2	= $40
PMG_MSIZE4_X4	= $C0
PMG_GRACTL_MISSILES	= $01
PMG_GRACTL_PLAYERS	= $02
PMG_GRACTL_LATCH	= $04
PMG_GRACTL_DEFAULT	= $03
PMG_SDMCTL_DMA_MISSILE	= $04
PMG_SDMCTL_DMA_PLAYER	= $08
PMG_SDMCTL_DMA_BOTH	= $0C
PMG_SDMCTL_ONELINE	= $10
PMG_SDMCTL_SCREEN_DISABLED	= $00
PMG_SDMCTL_SCREEN_NARROW	= $01
PMG_SDMCTL_SCREEN_NORMAL	= $02
PMG_SDMCTL_SCREEN_WIDE	= $03
PMG_SDMCTL_DEFAULT	= $0E
PMG_COLLISION_PLAYER_TO_P0	= $01
PMG_COLLISION_PLAYER_TO_P1	= $02
PMG_COLLISION_PLAYER_TO_P2	= $04
PMG_COLLISION_PLAYER_TO_P3	= $08
PMG_5PLAYER	= $10
PMG_OVERLAP	= $20
PMG_SDMCTL	= $D400
PMG_SDMCTL_S	= $022F
PMG_GPRIOR	= $D01B
PMG_GPRIOR_S	= $026F
PMG_PCOLR0	= $D012
PMG_PCOLR1	= $D013
PMG_PCOLR2	= $D014
PMG_PCOLR3	= $D015
adr.PMG_PCOLR	= $D012
.var PMG_PCOLR	= adr.PMG_PCOLR .word
PMG_PCOLR0_S	= $02C0
PMG_PCOLR1_S	= $02C1
PMG_PCOLR2_S	= $02C2
PMG_PCOLR3_S	= $02C3
adr.PMG_PCOLR_S	= $02C0
.var PMG_PCOLR_S	= adr.PMG_PCOLR_S .word
PMG_HPOS0	= $D000
PMG_HPOS1	= $D001
PMG_HPOS2	= $D002
PMG_HPOS3	= $D003
adr.PMG_HPOS	= $D000
.var PMG_HPOS	= adr.PMG_HPOS .word
PMG_HPOSM0	= $D004
PMG_HPOSM1	= $D005
PMG_HPOSM2	= $D006
PMG_HPOSM3	= $D007
adr.PMG_HPOSM	= $D004
.var PMG_HPOSM	= adr.PMG_HPOSM .word
PMG_SIZEP0	= $D008
PMG_SIZEP1	= $D009
PMG_SIZEP2	= $D00A
PMG_SIZEP3	= $D00B
adr.PMG_SIZEP	= $D008
.var PMG_SIZEP	= adr.PMG_SIZEP .word
PMG_SIZEM	= $D00C
PMG_GRAFP0	= $D00D
PMG_GRAFP1	= $D00E
PMG_GRAFP2	= $D00F
PMG_GRAFP3	= $D010
adr.PMG_GRAFP	= $D00D
.var PMG_GRAFP	= adr.PMG_GRAFP .word
PMG_GRAFM	= $D011
PMG_P0PL	= $D00C
PMG_P1PL	= $D00D
PMG_P2PL	= $D00E
PMG_P3PL	= $D00F
adr.PMG_PPL	= $D00C
.var PMG_PPL	= adr.PMG_PPL .word
PMG_VDELAY	= $D01C
PMG_GRACTL	= $D01D
PMG_HITCLR	= $D01E
PMG_PMBASE	= $D407
PMG_ONELINE	= DATAORIGIN+$08A5
PMG_BASE	= DATAORIGIN+$08A6
PMG_SIZE	= DATAORIGIN+$08A8

.endl							; UNIT B_PMG

; ------------------------------------------------------------

.local	JOYSTICK					; UNIT

; ------------------------------------------------------------

JOY_NONE	= $0F
JOY_UP	= $0E
JOY_DOWN	= $0D
JOY_LEFT	= $0B
JOY_LEFT_UP	= $0A
JOY_LEFT_DOWN	= $09
JOY_RIGHT	= $07
JOY_RIGHT_UP	= $06
JOY_RIGHT_DOWN	= $05
JOY_1	= $0278
JOY_2	= $0279
adr.STICK	= $0278
.var STICK	= adr.STICK .word
STICK0	= $0278
STICK1	= $0279
adr.STRIG	= $0284
.var STRIG	= adr.STRIG .word
STRIG0	= $0284
STRIG1	= $0285
adr.PADDL	= $0270
.var PADDL	= adr.PADDL .word
PADDL0	= $0270
PADDL1	= $0271
PADDL2	= $0272
PADDL3	= $0273
PADDL4	= $0274
PADDL5	= $0275
PADDL6	= $0276
PADDL7	= $0277
adr.PTRIG	= $027C
.var PTRIG	= adr.PTRIG .word
PTRIG0	= $027C
PTRIG1	= $027D
PTRIG2	= $027E
PTRIG3	= $027F
PTRIG4	= $0280
PTRIG5	= $0281
PTRIG6	= $0282
PTRIG7	= $0283
TRIG0	= $D010
TRIG1	= $D011

.endl							; UNIT JOYSTICK

.local	DLI						; PROCEDURE | ASSEMBLER | INTERRUPT

; ---------------------  ASM Block 091  ---------------------


    pha ; store registers
    mva #2 atari.colpf2
    mva #8 atari.colpf1
    mva >DEFAULT_CHARSET chbase
    mva #176 hposp3
    mva #3 sizep3

    
    mwa #dli2 atari.vdslst
    pla ; restore registers

	rti						; ret
.endl

.local	DLI2						; PROCEDURE | ASSEMBLER | INTERRUPT

; ---------------------  ASM Block 092  ---------------------


    pha ; store registers
    mva config.editorBackgroundColor atari.colpf2
    mva config.editorForegroundColor atari.colpf1
    mva editorCharset chbase

    
    
    mwa #dli3 atari.vdslst
    pla ; restore registers

	rti						; ret
.endl

.local	DLI3						; PROCEDURE | ASSEMBLER | INTERRUPT

; ---------------------  ASM Block 093  ---------------------


    pha ; store registers
    sta wsync
    mva #2 atari.colpf2
    mva #8 atari.colpf1
    lda statusCustomCharset
    sne
    mva >DEFAULT_CHARSET chbase
    
    mva brushFramePosX hposp3
    mva #0 sizep3
    
    pla ; restore registers

	rti						; ret
.endl

.local	VBL						; PROCEDURE | ASSEMBLER | INTERRUPT

; ---------------------  ASM Block 094  ---------------------


    phr ; store registers
    
    
    mwa #dli atari.vdslst

    ; cursor blink
    lda rtclok+2
    lsr
    and #$0f
    tax 
    lda cursorBrightness,x
    sta atari.pcolr0
    sta atari.pcolr1
    sta atari.pcolr2
    sta atari.pcolr3

    
    lda keyRepeatCounter
    seq
    dec keyRepeatCounter
    

    plr ; restore registers
    jmp $E462 ; jump to system VBL handler
cursorBrightness    
    dta 4, 5, 6, 7, 8, 9, 10, 11, 12, 11, 10, 9, 8, 7, 6, 5

	rti						; ret
.endl

.local	ADJUSTBRUSHFRAME				; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 77

	lda BRUSHINDEX
	asl @
	asl @
	sta :STACKORIGIN+10
	lda #$C9
	sub :STACKORIGIN+10
	sta BRUSHFRAMEPOSX
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SWAP						; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 83

	mwy A :bp2
	ldy #$00
	lda (:bp2),y
	sta C

; optimize OK (test\tools\artur\artur.pas), line = 84

	mwy B :bp2
	ldy #$00
	lda (:bp2),y
	mvy A+1 :bp+1
	ldy A
	sta (:bp),y

; optimize OK (test\tools\artur\artur.pas), line = 85

	ldy #$00
	lda C
	sta (:bp2),y

; ------------------------------------------------------------

A	= DATAORIGIN+$0A29
B	= DATAORIGIN+$0A2B
C	= DATAORIGIN+$0A2D

@VarData	= A
@VarDataSize	= 5

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	ADDDRIVETOS					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 91

	lda adr.S+$00
	add #$02
	sta L

; optimize OK (test\tools\artur\artur.pas), line = 92

	sta adr.S+$00

; optimize OK (test\tools\artur\artur.pas), line = 93

	lda <adr.S+$01
	sta SYSTEM.MOVE_045C.SOURCE
	lda >adr.S+$01
	sta SYSTEM.MOVE_045C.SOURCE+1
	lda <adr.S+$03
	sta SYSTEM.MOVE_045C.DEST
	lda >adr.S+$03
	sta SYSTEM.MOVE_045C.DEST+1
	lda L
	sta SYSTEM.MOVE_045C.COUNT
	lda #$00
	sta SYSTEM.MOVE_045C.COUNT+1
	.local +MAIN.SYSTEM.MOVE_045C
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 94

	lda #$44
	sta adr.S+$01

; optimize OK (test\tools\artur\artur.pas), line = 95

	lda #$3A
	sta adr.S+$02

; ------------------------------------------------------------

L	= DATAORIGIN+$0A2E

@VarData	= L
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	HEX2DECDIGIT					; FUNCTION
	sta C

; optimize OK (test\tools\artur\artur.pas), line = 100

	lda #$FF
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 101

	lda C
	sta @CASETMP_0005
	clc						; clear carry for add
	adc #$FF-$19					; make m = $FF
	adc #$19-$10+1					; carry set if in range n to m
	jcc l_08E3
@

; optimize OK (test\tools\artur\artur.pas), line = 102

	lda C
	sub #$10
	sta RESULT

	jmp a_0005
l_08E3
	lda @CASETMP_0005
	clc						; clear carry for add
	adc #$FF-$66					; make m = $FF
	adc #$66-$61+1					; carry set if in range n to m
	jcc l_08F6
@

; optimize OK (test\tools\artur\artur.pas), line = 103

	lda C
	sub #$57
	sta RESULT

	jmp a_0005
l_08F6
	lda @CASETMP_0005
	clc						; clear carry for add
	adc #$FF-$26					; make m = $FF
	adc #$26-$21+1					; carry set if in range n to m
	jcc l_0909
@

; optimize OK (test\tools\artur\artur.pas), line = 104

	lda C
	sub #$17
	sta RESULT

l_0909
a_0005
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

C	= DATAORIGIN+$0A2F
RESULT	= DATAORIGIN+$0A30
@CASETMP_0005	= DATAORIGIN+$0A31

@VarData	= C
@VarDataSize	= 3

	rts						; ret
.endl

.local	PARSEHEX					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 111

	mwy ERR :bp2
	ldy #$00
	tya
	sta (:bp2),y

; optimize OK (test\tools\artur\artur.pas), line = 112

	mwy I :bp2
	ldy #$00
	sta (:bp2),y

; optimize OK (test\tools\artur\artur.pas), line = 113

	sta BASE

; optimize OK (test\tools\artur\artur.pas), line = 114

	lda adr.S+$00
	sta POS

; --- RepeatUntilProlog
l_0935

; optimize OK (test\tools\artur\artur.pas), line = 116

	ldy POS
	lda adr.S,y
	jsr HEX2DECDIGIT
	lda :STACKORIGIN,x
	sta DIGIT
	dex

; optimize OK (test\tools\artur\artur.pas), line = 117

	lda DIGIT
	cmp #$FF
	jne l_0951

; optimize OK (test\tools\artur\artur.pas), line = 118

	mwy ERR :bp2
	ldy #$00
	lda #$01
	sta (:bp2),y
	jmp @exit					; exit
l_0951

; optimize FAIL (50, test\tools\artur\artur.pas), line = 121

	inx
	mwy I :bp2
	ldy #$00
	mva (:bp2),y :STACKORIGIN,x
	inx
	mva DIGIT :STACKORIGIN,x
	inx
	mva BASE :STACKORIGIN,x
	jsr shlEAX_CL.BYTE
	dex
	jsr @expandToCARD1.BYTE
	jsr addAL_CL
	dex
	mwy I :bp2
	ldy #$00
	lda :STACKORIGIN,x
	sta (:bp2),y
	dex

; optimize OK (test\tools\artur\artur.pas), line = 122

	lda BASE
	add #$04
	sta BASE

; optimize FAIL (0, test\tools\artur\artur.pas), line = 123

	dec POS

; optimize OK (test\tools\artur\artur.pas), line = 124

	jne l_0935

; ------------------------------------------------------------

I	= DATAORIGIN+$0A32
ERR	= DATAORIGIN+$0A34
POS	= DATAORIGIN+$0A36
DIGIT	= DATAORIGIN+$0A37
BASE	= DATAORIGIN+$0A38

@VarData	= I
@VarDataSize	= 7

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	READJOYSTICK					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 129

	lda #$00
	sta JOYX

; optimize OK (test\tools\artur\artur.pas), line = 130

	sta JOYY

; optimize OK (test\tools\artur\artur.pas), line = 131

	lda JOYSTICK.STICK0
	and #$01
	jne l_099E
	lda #$FF
	sta JOYY
l_099E

; optimize OK (test\tools\artur\artur.pas), line = 132

	lda JOYSTICK.STICK0
	and #$02
	jne l_09BB
	lda #$01
	sta JOYY
l_09BB

; optimize OK (test\tools\artur\artur.pas), line = 133

	lda JOYSTICK.STICK0
	and #$04
	jne l_09D8
	lda #$FF
	sta JOYX
l_09D8

; optimize OK (test\tools\artur\artur.pas), line = 134

	lda JOYSTICK.STICK0
	and #$08
	jne l_09F5
	lda #$01
	sta JOYX
l_09F5

; optimize OK (test\tools\artur\artur.pas), line = 135

	lda JOYSTICK.STRIG0
	sta JOYFIRE
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	INITPMG						; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 163

	lda #$70
	jsr B_PMG.PMG_INIT_0856

; optimize OK (test\tools\artur\artur.pas), line = 164

	lda #$01
	sta B_PMG.PMG_GPRIOR_S

; optimize OK (test\tools\artur\artur.pas), line = 165

	lda #$0D
	sta SYSTEM.MOVE_045B.COUNT
	lda #$00
	sta SYSTEM.MOVE_045B.COUNT+1
	sta SYSTEM.MOVE_045B.DEST
	lda #$D0
	sta SYSTEM.MOVE_045B.DEST+1
	lda PMGSETTINGS
	sta SYSTEM.MOVE_045B.SOURCE
	lda PMGSETTINGS+1
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 166

	lda FRAME
	sta :bp2
	lda FRAME+1
	sta :bp2+1
	ldy #$05
	mva:rpl (:bp2),y $73F0,y-

; ------------------------------------------------------------

adr.FRAME	= [DATAORIGIN+$0A39] .array [6]
.var FRAME	= adr.FRAME .word
adr.PMGSETTINGS	= [DATAORIGIN+$0A3F] .array [13]
.var PMGSETTINGS	= adr.PMGSETTINGS .word

@VarData	= FRAME
@VarDataSize	= 19

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	NEXTACTION					; FUNCTION

; optimize OK (test\tools\artur\artur.pas), line = 176

	ldy UNDOACTIONSIDX
	iny
	sty RESULT

; optimize OK (test\tools\artur\artur.pas), line = 177

	lda RESULT
	cmp #$40
	jne l_0A36
	lda #$00
	sta RESULT
l_0A36
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0A4C

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	PREVACTION					; FUNCTION

; optimize OK (test\tools\artur\artur.pas), line = 182

	lda UNDOACTIONSIDX
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 183

	jne l_0A5C
	lda #$40
	sta RESULT
l_0A5C

; optimize FAIL (0, test\tools\artur\artur.pas), line = 184

	dec RESULT
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0A4D

@VarData	= RESULT
@VarDataSize	= 1

	rts						; ret
.endl

.local	INITUNDOSTORAGE					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 190

	lda #$00
	sta UNDOACTIONSIDX

; optimize OK (test\tools\artur\artur.pas), line = 191

	lda #$FF
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda #$C0
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$00
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda UNDOACTIONS
	sta SYSTEM.FILLBYTE_045A.A
	lda UNDOACTIONS+1
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 192

	lda #$08
	sta UNDOBUFFERIDX

; optimize OK (test\tools\artur\artur.pas), line = 193

	lda #$00
	sta UNDOPTR
	lda #$81
	sta UNDOPTR+1

; --- RepeatUntilProlog
l_0A80

; optimize FAIL (0, test\tools\artur\artur.pas), line = 195

	dec UNDOBUFFERIDX

; optimize OK (test\tools\artur\artur.pas), line = 196

	lda UNDOBUFFERIDX
	asl @
	tay
	lda UNDOPTR
	sta adr.UNDOBUFFERS,y
	lda UNDOPTR+1
	sta adr.UNDOBUFFERS+1,y

; optimize OK (test\tools\artur\artur.pas), line = 197

	lda UNDOPTR
	add #$C0
	sta UNDOPTR
	lda UNDOPTR+1
	adc #$03
	sta UNDOPTR+1

; optimize OK (test\tools\artur\artur.pas), line = 198

	lda UNDOBUFFERIDX
	jne l_0A80

; ------------------------------------------------------------

UNDOPTR	= DATAORIGIN+$0A4E

@VarData	= UNDOPTR
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SETUNDOFROMXY					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 203

	lda IDX
	asl @
	add IDX
	tay
	lda X
	sta adr.UNDOACTIONS,y

; optimize OK (test\tools\artur\artur.pas), line = 204

	lda Y
	sta adr.UNDOACTIONS+$01,y

; optimize OK (test\tools\artur\artur.pas), line = 205

	lda IDX
	asl @
	add IDX
	sta :STACKORIGIN+9
	lda Y
	asl @
	tay
	lda X
	add adr.LINEOFFSET,y
	sta :STACKORIGIN+10
	lda #$7C
	adc adr.LINEOFFSET+1,y
	sta :bp+1
	ldy :STACKORIGIN+10
	lda (:bp),y
	ldy :STACKORIGIN+9
	sta adr.UNDOACTIONS+$02,y

; ------------------------------------------------------------

IDX	= DATAORIGIN+$0A50
X	= DATAORIGIN+$0A51
Y	= DATAORIGIN+$0A52

@VarData	= IDX
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	STOREUNDOFROMXY					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 210

	lda Y
	sta SETUNDOFROMXY.Y
	lda X
	sta SETUNDOFROMXY.X
	lda UNDOACTIONSIDX
	sta SETUNDOFROMXY.IDX
	jsr SETUNDOFROMXY

; ------------------------------------------------------------

X	= DATAORIGIN+$0A53
Y	= DATAORIGIN+$0A54

@VarData	= X
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	STORESCREENTOUNDOBUFFER				; PROCEDURE
	sta BUFNUM

; optimize OK (test\tools\artur\artur.pas), line = 215

	lda BUFNUM
	asl @
	tay
	lda adr.UNDOBUFFERS,y
	sta SYSTEM.MOVE_045B.DEST
	lda adr.UNDOBUFFERS+1,y
	sta SYSTEM.MOVE_045B.DEST+1
	lda #$C0
	sta SYSTEM.MOVE_045B.COUNT
	lda #$03
	sta SYSTEM.MOVE_045B.COUNT+1
	lda #$00
	sta SYSTEM.MOVE_045B.SOURCE
	lda #$7C
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl

; ------------------------------------------------------------

BUFNUM	= DATAORIGIN+$0A55

@VarData	= BUFNUM
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	RESTORESCREENFROMUNDOBUFFER			; PROCEDURE
	sta BUFNUM

; optimize OK (test\tools\artur\artur.pas), line = 220

	lda BUFNUM
	asl @
	tay
	lda adr.UNDOBUFFERS,y
	sta SYSTEM.MOVE_045B.SOURCE
	lda adr.UNDOBUFFERS+1,y
	sta SYSTEM.MOVE_045B.SOURCE+1
	lda #$C0
	sta SYSTEM.MOVE_045B.COUNT
	lda #$03
	sta SYSTEM.MOVE_045B.COUNT+1
	lda #$00
	sta SYSTEM.MOVE_045B.DEST
	lda #$7C
	sta SYSTEM.MOVE_045B.DEST+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl

; ------------------------------------------------------------

BUFNUM	= DATAORIGIN+$0A56

@VarData	= BUFNUM
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	REMOVEBUFFERFROMUNDOACTIONS			; PROCEDURE
	sta BUFNUM

; optimize OK (test\tools\artur\artur.pas), line = 226

	lda UNDOACTIONSIDX
	sta UNDOPTR

; --- RepeatUntilProlog
l_0B17

; optimize OK (test\tools\artur\artur.pas), line = 228

	lda UNDOPTR
	jne l_0B29
	lda #$40
	sta UNDOPTR
l_0B29

; optimize FAIL (0, test\tools\artur\artur.pas), line = 229

	dec UNDOPTR

; optimize OK (test\tools\artur\artur.pas), line = 230

	lda UNDOPTR
	asl @
	add UNDOPTR
	tay
	lda adr.UNDOACTIONS,y
	sta ACTION

; optimize OK (test\tools\artur\artur.pas), line = 231

	cmp #$FE
	jne l_0B57

; optimize OK (test\tools\artur\artur.pas), line = 232

	lda adr.UNDOACTIONS+$01,y
	cmp BUFNUM
	jne l_0B77

; optimize OK (test\tools\artur\artur.pas), line = 233

	lda #$FF
	sta adr.UNDOACTIONS,y

; optimize OK (test\tools\artur\artur.pas), line = 234

	sta ACTION
l_0B77
l_0B57

; optimize OK (test\tools\artur\artur.pas), line = 236

	lda ACTION
	cmp #$FF
	jeq l_0B17x
	lda UNDOPTR
	cmp UNDOACTIONSIDX
	jne l_0B17
l_0B17x

; ------------------------------------------------------------

BUFNUM	= DATAORIGIN+$0A57
UNDOPTR	= DATAORIGIN+$0A58
ACTION	= DATAORIGIN+$0A59

@VarData	= BUFNUM
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	STOREUNDOBUFFER					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 241

	lda UNDOBUFFERIDX
	jsr STORESCREENTOUNDOBUFFER

; optimize OK (test\tools\artur\artur.pas), line = 242

	lda UNDOBUFFERIDX
	jsr REMOVEBUFFERFROMUNDOACTIONS

; optimize OK (test\tools\artur\artur.pas), line = 243

	lda UNDOACTIONSIDX
	asl @
	add UNDOACTIONSIDX
	tay
	lda #$FE
	sta adr.UNDOACTIONS,y

; optimize OK (test\tools\artur\artur.pas), line = 244

	lda UNDOBUFFERIDX
	sta adr.UNDOACTIONS+$01,y

; optimize FAIL (0, test\tools\artur\artur.pas), line = 245

	inc UNDOBUFFERIDX

; optimize OK (test\tools\artur\artur.pas), line = 246

	lda UNDOBUFFERIDX
	cmp #$08
	jne l_0BEC
	lda #$00
	sta UNDOBUFFERIDX
l_0BEC
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	RESTORECHARFROMUNDO				; PROCEDURE
	sta IDX

; optimize OK (test\tools\artur\artur.pas), line = 252

	lda IDX
	asl @
	add IDX
	tay
	lda adr.UNDOACTIONS,y
	sta RX

; optimize OK (test\tools\artur\artur.pas), line = 253

	lda adr.UNDOACTIONS+$01,y
	sta RY

; optimize OK (test\tools\artur\artur.pas), line = 254

	lda adr.UNDOACTIONS+$02,y
	sta RC

; optimize OK (test\tools\artur\artur.pas), line = 255

	lda RY
	asl @
	tay
	lda RX
	add adr.LINEOFFSET,y
	sta :STACKORIGIN+9
	lda #$7C
	adc adr.LINEOFFSET+1,y
	sta :bp+1
	ldy :STACKORIGIN+9
	lda RC
	sta (:bp),y

; ------------------------------------------------------------

IDX	= DATAORIGIN+$0A5A
RX	= DATAORIGIN+$0A5B
RY	= DATAORIGIN+$0A5C
RC	= DATAORIGIN+$0A5D

@VarData	= IDX
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	RESTORE						; PROCEDURE
	sta ACTIONIDX

; optimize OK (test\tools\artur\artur.pas), line = 260

	lda ACTIONIDX
	asl @
	add ACTIONIDX
	tay
	lda adr.UNDOACTIONS,y
	cmp #$FE
	jne l_0C5E

; optimize FAIL ('STOREUNDOBUFFER', test\tools\artur\artur.pas), line = 261

	jsr STOREUNDOBUFFER

; optimize OK (test\tools\artur\artur.pas), line = 262

	lda ACTIONIDX
	sta UNDOACTIONSIDX

; optimize OK (test\tools\artur\artur.pas), line = 263

	asl @
	add ACTIONIDX
	tay
	lda adr.UNDOACTIONS+$01,y
	jsr RESTORESCREENFROMUNDOBUFFER
	jmp l_0C7E
l_0C5E

; optimize OK (test\tools\artur\artur.pas), line = 265

	lda ACTIONIDX
	asl @
	add ACTIONIDX
	tay
	lda adr.UNDOACTIONS,y
	sta STOREUNDOFROMXY.X
	lda adr.UNDOACTIONS+$01,y
	sta STOREUNDOFROMXY.Y
	jsr STOREUNDOFROMXY

; optimize OK (test\tools\artur\artur.pas), line = 266

	lda ACTIONIDX
	sta UNDOACTIONSIDX

; optimize OK (test\tools\artur\artur.pas), line = 267

	jsr RESTORECHARFROMUNDO
l_0C7E

; ------------------------------------------------------------

ACTIONIDX	= DATAORIGIN+$0A5E

@VarData	= ACTIONIDX
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	STOREUNDOACTION					; PROCEDURE
	sta WHOLESCREEN

; optimize OK (test\tools\artur\artur.pas), line = 273

	lda #$00
	sta REDOCOUNT

; optimize OK (test\tools\artur\artur.pas), line = 274

	lda WHOLESCREEN
	jeq l_0CB9

; optimize FAIL ('STOREUNDOBUFFER', test\tools\artur\artur.pas), line = 275

	jsr STOREUNDOBUFFER
	jmp l_0CC4
l_0CB9
	lda CURSORY
	sta STOREUNDOFROMXY.Y
	lda CURSORX
	sta STOREUNDOFROMXY.X
	jsr STOREUNDOFROMXY
l_0CC4

; optimize FAIL ('NEXTACTION', test\tools\artur\artur.pas), line = 276

	jsr NEXTACTION
	lda :STACKORIGIN,x
	sta UNDOACTIONSIDX
	dex

; ------------------------------------------------------------

WHOLESCREEN	= DATAORIGIN+$0A5F

@VarData	= WHOLESCREEN
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	TRYUNDO						; PROCEDURE

; optimize FAIL ('PREVACTION', test\tools\artur\artur.pas), line = 282

	jsr PREVACTION
	lda :STACKORIGIN,x
	sta PREV
	dex

; optimize OK (test\tools\artur\artur.pas), line = 283

	lda PREV
	asl @
	add PREV
	tay
	lda adr.UNDOACTIONS,y
	cmp #$FF
	jeq l_0CF4

; optimize OK (test\tools\artur\artur.pas), line = 284

	lda PREV
	jsr RESTORE

; optimize OK (test\tools\artur\artur.pas), line = 285

	lda PREV
	asl @
	add PREV
	tay
	lda adr.UNDOACTIONS,y
	cmp #$FE
	jne l_0D16
	lda adr.UNDOACTIONS+$01,y
	sta UNDOBUFFERIDX
l_0D16

; optimize FAIL (0, test\tools\artur\artur.pas), line = 286

	inc REDOCOUNT
l_0CF4

; ------------------------------------------------------------

PREV	= DATAORIGIN+$0A60

@VarData	= PREV
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	TRYREDO						; PROCEDURE

; optimize FAIL ('NEXTACTION', test\tools\artur\artur.pas), line = 293

	jsr NEXTACTION
	lda :STACKORIGIN,x
	sta NEXT
	dex

; optimize OK (test\tools\artur\artur.pas), line = 294

	lda REDOCOUNT
	jeq l_0D4A

; optimize OK (test\tools\artur\artur.pas), line = 295

	lda NEXT
	asl @
	add NEXT
	tay
	lda adr.UNDOACTIONS,y
	cmp #$FF
	jeq l_0D68

; optimize OK (test\tools\artur\artur.pas), line = 296

	lda NEXT
	jsr RESTORE

; optimize FAIL (0, test\tools\artur\artur.pas), line = 297

	dec REDOCOUNT
l_0D68
l_0D4A

; ------------------------------------------------------------

NEXT	= DATAORIGIN+$0A61

@VarData	= NEXT
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CLEAREDIT					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 309

	lda #$00
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda #$C0
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$03
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda #$00
	sta SYSTEM.FILLBYTE_045A.A
	lda #$7C
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CLEARBUFFER					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 314

	lda #$00
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda #$C0
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$03
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda #$00
	sta SYSTEM.FILLBYTE_045A.A
	lda #$78
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	STOREEDITINBUFFER				; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 319

	lda #$C0
	sta SYSTEM.MOVE_045B.COUNT
	lda #$03
	sta SYSTEM.MOVE_045B.COUNT+1
	lda #$00
	sta SYSTEM.MOVE_045B.DEST
	lda #$78
	sta SYSTEM.MOVE_045B.DEST+1
	lda #$00
	sta SYSTEM.MOVE_045B.SOURCE
	lda #$7C
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	RESTOREEDITFROMBUFFER				; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 324

	lda #$C0
	sta SYSTEM.MOVE_045B.COUNT
	lda #$03
	sta SYSTEM.MOVE_045B.COUNT+1
	lda #$00
	sta SYSTEM.MOVE_045B.DEST
	lda #$7C
	sta SYSTEM.MOVE_045B.DEST+1
	lda #$00
	sta SYSTEM.MOVE_045B.SOURCE
	lda #$78
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	DRAWRECT					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 330

	lda Y
	asl @
	tay
	lda adr.LINEOFFSET,y
	add X
	sta CARRET
	lda adr.LINEOFFSET+1,y
	adc #$7C
	sta CARRET+1

; --- RepeatUntilProlog
l_0DAC

; optimize OK (test\tools\artur\artur.pas), line = 332

	lda C
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda W
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$00
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda CARRET
	sta SYSTEM.FILLBYTE_045A.A
	lda CARRET+1
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 333

	lda CARRET
	add #$28
	sta CARRET
	scc
	inc CARRET+1

; optimize FAIL (0, test\tools\artur\artur.pas), line = 334

	dec H

; optimize OK (test\tools\artur\artur.pas), line = 335

	jne l_0DAC

; ------------------------------------------------------------

X	= DATAORIGIN+$0A62
Y	= DATAORIGIN+$0A63
W	= DATAORIGIN+$0A64
H	= DATAORIGIN+$0A65
C	= DATAORIGIN+$0A66
CARRET	= DATAORIGIN+$0A67

@VarData	= X
@VarDataSize	= 7

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	READCURSORCHAR					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 340

	ldy CURSOR
	lda #$7C
	add CURSOR+1
	sta :bp+1
	lda (:bp),y
	sta CURSORCHAR

; optimize OK (test\tools\artur\artur.pas), line = 341

	lda CONFIG.KEYCODEDISPLAY
	cmp #$02
	jne l_0DEF
	lda CURSORCHAR
	jsr B_CRT.ANTIC2ATASCII_0546
	lda :STACKORIGIN,x
	sta CURSORCHAR
	dex
l_0DEF
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	UPDATEXYK					; PROCEDURE

; optimize FAIL ('SYSTEM.STR_044C', test\tools\artur\artur.pas), line = 346

	inx
	mva CURSORX :STACKORIGIN,x
	jsr @expandToCARD.BYTE
	inx
	mva S :STACKORIGIN,x
	mva S+1 :STACKORIGIN+STACKWIDTH,x
	jsr SYSTEM.STR_044C

; optimize FAIL ('B_CRT.ATASCII2ANTIC_054D', test\tools\artur\artur.pas), line = 347

	inx
	mva S :STACKORIGIN,x
	mva S+1 :STACKORIGIN+STACKWIDTH,x
	jsr B_CRT.ATASCII2ANTIC_054D
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 348

	lda #$00
	sta $7FCC

; optimize OK (test\tools\artur\artur.pas), line = 349

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7FCA,y-

; optimize FAIL ('SYSTEM.STR_044C', test\tools\artur\artur.pas), line = 351

	inx
	mva CURSORY :STACKORIGIN,x
	jsr @expandToCARD.BYTE
	inx
	mva S :STACKORIGIN,x
	mva S+1 :STACKORIGIN+STACKWIDTH,x
	jsr SYSTEM.STR_044C

; optimize FAIL ('B_CRT.ATASCII2ANTIC_054D', test\tools\artur\artur.pas), line = 352

	inx
	mva S :STACKORIGIN,x
	mva S+1 :STACKORIGIN+STACKWIDTH,x
	jsr B_CRT.ATASCII2ANTIC_054D
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 353

	lda #$00
	sta $7FD0

; optimize OK (test\tools\artur\artur.pas), line = 354

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7FCE,y-

; optimize OK (test\tools\artur\artur.pas), line = 356

	lda CONFIG.KEYCODEDISPLAY
	jeq l_0E35

; optimize OK (test\tools\artur\artur.pas), line = 357

	lda #$AB
	sta $7FD2

; optimize OK (test\tools\artur\artur.pas), line = 358

	lda #$02
	sta SYSTEM.HEXSTR.DIGITS
	lda CURSORCHAR
	sta SYSTEM.HEXSTR.VALUE
	lda #$00
	sta SYSTEM.HEXSTR.VALUE+1
	sta SYSTEM.HEXSTR.VALUE+2
	sta SYSTEM.HEXSTR.VALUE+3
	jsr SYSTEM.HEXSTR
	jsr B_CRT.ATASCII2ANTIC_054D
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 359

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7FD2,y-
l_0E35
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SHOWSTATUS					; PROCEDURE

; optimize FAIL ('SYSTEM.PAUSE_0472', test\tools\artur\artur.pas), line = 365

	jsr SYSTEM.PAUSE_0472

; optimize OK (test\tools\artur\artur.pas), line = 366

	lda #$00
	ldy #$27
	sta:rpl $7FC0,y-
	ldy #256-19
	mva:rne CODEORIGIN+$0015+19-256,y adr.S+19-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 368

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7FBF,y-
	ldy #256-6
	mva:rne CODEORIGIN+$0029+6-256,y adr.S+6-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 371

	lda MODE
	cmp #$01
	jne l_0E6A
	ldy #256-6
	mva:rne CODEORIGIN+$0030+6-256,y adr.S+6-256,y+
l_0E6A

; optimize OK (test\tools\artur\artur.pas), line = 372

	lda MODE
	cmp #$02
	jne l_0E7F
	ldy #256-6
	mva:rne CODEORIGIN+$0037+6-256,y adr.S+6-256,y+
l_0E7F

; optimize OK (test\tools\artur\artur.pas), line = 373

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7FC3,y-

; optimize FAIL ('UPDATEXYK', test\tools\artur\artur.pas), line = 375

	jsr UPDATEXYK

; optimize OK (test\tools\artur\artur.pas), line = 377

	lda #$11
	sta B

l_0E93
; --- ForToDoCondition
	lda #$E7
	sub B
	sta :STACKORIGIN+9
	lda #$7F
	sbc #$00
	sta :bp+1
	ldy B
	lda adr.BRUSHHISTORY,y
	ldy :STACKORIGIN+9
	sta (:bp),y
	dec B
	jpl l_0E93
l_0EA1

; optimize OK (test\tools\artur\artur.pas), line = 378

	lda BRUSH
	sta $7FE7

; ------------------------------------------------------------

@FORTMP_0E90	= $00
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SHOWMENUBAR					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 383

	lda #$00
	ldy #$27
	sta:rpl $7BC0,y-

; optimize OK (test\tools\artur\artur.pas), line = 384

	lda MODE
	jne l_0EDB
	ldy #256-41
	mva:rne CODEORIGIN+$003E+41-256,y adr.S+41-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 386

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BBF,y-

; optimize OK (test\tools\artur\artur.pas), line = 387

	lda CURSORFORWARD
	jeq l_0EEF
	ldy #256-7
	mva:rne CODEORIGIN+$0068+7-256,y adr.S+7-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 389

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BD9,y-
l_0EEF

; optimize OK (test\tools\artur\artur.pas), line = 391

	lda INVERT
	jeq l_0F05
	ldy #256-8
	mva:rne CODEORIGIN+$0070+8-256,y adr.S+8-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 393

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BE0,y-
l_0F05
l_0EDB

; optimize OK (test\tools\artur\artur.pas), line = 396

	lda MODE
	cmp #$01
	jne l_0F23
	ldy #256-41
	mva:rne CODEORIGIN+$0079+41-256,y adr.S+41-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 402

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BBF,y-

; optimize OK (test\tools\artur\artur.pas), line = 403

	lda DRAWTOOL
	jne l_0F3D
	ldy #256-5
	mva:rne CODEORIGIN+$00A3+5-256,y adr.S+5-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 405

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BCC,y-
l_0F3D

; optimize OK (test\tools\artur\artur.pas), line = 407

	lda DRAWTOOL
	cmp #$01
	jne l_0F59
	ldy #256-5
	mva:rne CODEORIGIN+$00A9+5-256,y adr.S+5-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 409

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BD3,y-
l_0F59

; optimize OK (test\tools\artur\artur.pas), line = 411

	lda DRAWTOOL
	cmp #$02
	jne l_0F75
	ldy #256-6
	mva:rne CODEORIGIN+$00AF+6-256,y adr.S+6-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 413

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BDA,y-
l_0F75

; optimize OK (test\tools\artur\artur.pas), line = 415

	lda DRAWTOOL
	cmp #$03
	jne l_0F91
	ldy #256-6
	mva:rne CODEORIGIN+$00B6+6-256,y adr.S+6-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 417

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BE2,y-
l_0F91
l_0F23

; optimize OK (test\tools\artur\artur.pas), line = 420

	lda MODE
	cmp #$02
	jne l_0FAF

; optimize OK (test\tools\artur\artur.pas), line = 421

	lda P2X
	cmp #$FF
	jne l_0FC2
	ldy #256-32
	mva:rne CODEORIGIN+$00BD+32-256,y adr.S+32-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 423

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BBF,y-
	jmp l_0FD3
l_0FC2
	ldy #256-33
	mva:rne CODEORIGIN+$00DE+33-256,y adr.S+33-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 430

	ldy adr.S+$00
	mva:rne adr.S+$01-$01,y $7BBF,y-
l_0FD3
l_0FAF
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	XORCURSOR					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 444

	lda X
	lsr @
	lsr @
	lsr @
	sta PX

; optimize OK (test\tools\artur\artur.pas), line = 445

	sta :eax+1
	lda #$00
	lsr :eax+1
	ror @
	add #$80
	sta :STACKORIGIN+9
	lda #$71
	adc :eax+1
	sta :STACKORIGIN+STACKWIDTH+9
	lda #$00
	sta :STACKORIGIN+STACKWIDTH+10
	lda Y
	asl @
	rol :STACKORIGIN+STACKWIDTH+10
	asl @
	rol :STACKORIGIN+STACKWIDTH+10
	add :STACKORIGIN+9
	tay
	lda :STACKORIGIN+STACKWIDTH+9
	adc :STACKORIGIN+STACKWIDTH+10
	sta CURSOR_PMG+1
	tya
	add #$0F
	sta CURSOR_PMG
	scc
	inc CURSOR_PMG+1

; optimize OK (test\tools\artur\artur.pas), line = 446

	lda X
	and #$07
	sta PX

; optimize FAIL (50, test\tools\artur\artur.pas), line = 447

	inx
	mva #$80 :STACKORIGIN,x
	inx
	mva PX :STACKORIGIN,x
	jsr shrAL_CL.BYTE
	dex
	lda :STACKORIGIN,x
	sta CURSOR_MASK
	dex

; optimize OK (test\tools\artur\artur.pas), line = 448

	lda #$04
	sta PX

; --- RepeatUntilProlog
l_1023

; optimize OK (test\tools\artur\artur.pas), line = 450

	ldy CURSOR_PMG+1
	sty :bp+1
	ldy CURSOR_PMG
	lda (:bp),y
	eor CURSOR_MASK
	sta (:bp),y

; optimize FAIL (0, test\tools\artur\artur.pas), line = 451

	inc CURSOR_PMG
	sne
	inc CURSOR_PMG+1

; optimize FAIL (0, test\tools\artur\artur.pas), line = 452

	dec PX

; optimize OK (test\tools\artur\artur.pas), line = 453

	jne l_1023

; ------------------------------------------------------------

X	= DATAORIGIN+$0A69
Y	= DATAORIGIN+$0A6A
PX	= DATAORIGIN+$0A6B
CURSOR_MASK	= DATAORIGIN+$0A6C
CURSOR_PMG	= DATAORIGIN+$0A6D

@VarData	= X
@VarDataSize	= 6

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	ERASEALLCURSORS					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 458

	lda #$00
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda #$70
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$02
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda #$80
	sta SYSTEM.FILLBYTE_045A.A
	lda #$71
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	INITCURSOR					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 463

	lda #$00
	sta CURSORX

; optimize OK (test\tools\artur\artur.pas), line = 464

	sta CURSORY

; optimize OK (test\tools\artur\artur.pas), line = 465

	sta CURSOR
	sta CURSOR+1

; optimize OK (test\tools\artur\artur.pas), line = 466

	lda CURSORY
	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	DRAWSELECTION					; PROCEDURE

; optimize FAIL ('ERASEALLCURSORS', test\tools\artur\artur.pas), line = 472

	jsr ERASEALLCURSORS

; optimize OK (test\tools\artur\artur.pas), line = 473

	lda PC2X
	cmp PC1X
	jcs l_107C
	lda <PC2X
	sta SWAP.B
	lda >PC2X
	sta SWAP.B+1
	lda <PC1X
	sta SWAP.A
	lda >PC1X
	sta SWAP.A+1
	jsr SWAP
l_107C

; optimize OK (test\tools\artur\artur.pas), line = 474

	lda PC2Y
	cmp PC1Y
	jcs l_1096
	lda <PC2Y
	sta SWAP.B
	lda >PC2Y
	sta SWAP.B+1
	lda <PC1Y
	sta SWAP.A
	lda >PC1Y
	sta SWAP.A+1
	jsr SWAP
l_1096

; optimize OK (test\tools\artur\artur.pas), line = 475

	lda PC1X
	sta X
	lda PC2X
	sta :@FORTMP?10A6_0

l_10A9
; --- ForToDoCondition
.def :@FORTMP?10A6_0 = *+1
	lda #$00
	cmp X
	jcc l_10B7

; optimize OK (test\tools\artur\artur.pas), line = 476

	lda PC1Y
	sta XORCURSOR.Y
	lda X
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 477

	lda PC1Y
	cmp PC2Y
	jeq l_10D2
	lda PC2Y
	sta XORCURSOR.Y
	lda X
	sta XORCURSOR.X
	jsr XORCURSOR
l_10D2

; --- ForToDoEpilog
	inc X
	jne l_10A9
l_10B7

; optimize OK (test\tools\artur\artur.pas), line = 479

	ldy PC1Y
	iny
	sty Y
	ldy PC2Y
	dey
	sty :@FORTMP?10F3_0

l_10F6
; --- ForToDoCondition
.def :@FORTMP?10F3_0 = *+1
	lda #$00
	cmp Y
	jcc l_1104

; optimize OK (test\tools\artur\artur.pas), line = 480

	lda Y
	sta XORCURSOR.Y
	lda PC1X
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 481

	lda PC1X
	cmp PC2X
	jeq l_111F
	lda Y
	sta XORCURSOR.Y
	lda PC2X
	sta XORCURSOR.X
	jsr XORCURSOR
l_111F

; --- ForToDoEpilog
	inc Y
	jne l_10F6
l_1104

; ------------------------------------------------------------

PC1X	= DATAORIGIN+$0A6F
PC1Y	= DATAORIGIN+$0A70
PC2X	= DATAORIGIN+$0A71
PC2Y	= DATAORIGIN+$0A72
X	= DATAORIGIN+$0A73
Y	= DATAORIGIN+$0A74
@FORTMP_10A6	= $00
@FORTMP_10F3	= $00

@VarData	= PC1X
@VarDataSize	= 6

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	DRAWLINE					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 493

	ldy #1
	lda P2X
	cmp #$FF
	beq @+
	dey
@
	tya
	sta CUR

; optimize OK (test\tools\artur\artur.pas), line = 495

	jne l_114D
	lda #$01
	jsr STOREUNDOACTION
l_114D

; optimize OK (test\tools\artur\artur.pas), line = 497

	lda CURSORX
	sta P2X

; optimize OK (test\tools\artur\artur.pas), line = 498

	lda CURSORY
	sta P2Y

; optimize OK (test\tools\artur\artur.pas), line = 499

	lda P2X
	sub P1X
	sta DELTAX

; optimize OK (test\tools\artur\artur.pas), line = 500

	jpl l_117C
	lda #$00
	sub DELTAX
	sta DELTAX
l_117C

; optimize OK (test\tools\artur\artur.pas), line = 501

	lda P2Y
	sub P1Y
	sta DELTAY

; optimize OK (test\tools\artur\artur.pas), line = 502

	jpl l_11A6
	lda #$00
	sub DELTAY
	sta DELTAY
l_11A6

; optimize OK (test\tools\artur\artur.pas), line = 504

	lda DELTAX
	sub DELTAY
	svc
	eor #$80
	jmi l_11C6

; optimize OK (test\tools\artur\artur.pas), line = 506

	ldy DELTAX
	iny
	sty NUMPIXELS

; optimize OK (test\tools\artur\artur.pas), line = 507

	lda DELTAY
	asl @
	sub DELTAX
	sta D

; optimize OK (test\tools\artur\artur.pas), line = 508

	lda DELTAY
	asl @
	sta DINC1

; optimize OK (test\tools\artur\artur.pas), line = 509

	lda DELTAY
	sub DELTAX
	asl @
	sta DINC2

; optimize OK (test\tools\artur\artur.pas), line = 510

	lda #$01
	sta XINC1

; optimize OK (test\tools\artur\artur.pas), line = 511

	sta XINC2

; optimize OK (test\tools\artur\artur.pas), line = 512

	lda #$00
	sta YINC1

; optimize OK (test\tools\artur\artur.pas), line = 513

	lda #$01
	sta YINC2
	jmp l_1214
l_11C6

; optimize OK (test\tools\artur\artur.pas), line = 516

	ldy DELTAY
	iny
	sty NUMPIXELS

; optimize OK (test\tools\artur\artur.pas), line = 517

	lda DELTAX
	asl @
	sub DELTAY
	sta D

; optimize OK (test\tools\artur\artur.pas), line = 518

	lda DELTAX
	asl @
	sta DINC1

; optimize OK (test\tools\artur\artur.pas), line = 519

	lda DELTAX
	sub DELTAY
	asl @
	sta DINC2

; optimize OK (test\tools\artur\artur.pas), line = 520

	lda #$00
	sta XINC1

; optimize OK (test\tools\artur\artur.pas), line = 521

	lda #$01
	sta XINC2

; optimize OK (test\tools\artur\artur.pas), line = 522

	sta YINC1

; optimize OK (test\tools\artur\artur.pas), line = 523

	sta YINC2
l_1214

; optimize OK (test\tools\artur\artur.pas), line = 526

	lda P2X
	cmp P1X
	jcs l_126C

; optimize OK (test\tools\artur\artur.pas), line = 527

	lda #$00
	sub XINC1
	sta XINC1

; optimize OK (test\tools\artur\artur.pas), line = 528

	lda #$00
	sub XINC2
	sta XINC2
l_126C

; optimize OK (test\tools\artur\artur.pas), line = 530

	lda P2Y
	cmp P1Y
	jcs l_1295

; optimize OK (test\tools\artur\artur.pas), line = 531

	lda #$00
	sub YINC1
	sta YINC1

; optimize OK (test\tools\artur\artur.pas), line = 532

	lda #$00
	sub YINC2
	sta YINC2
l_1295

; optimize OK (test\tools\artur\artur.pas), line = 535

	lda P1X
	sta X

; optimize OK (test\tools\artur\artur.pas), line = 536

	lda P1Y
	sta Y

; optimize OK (test\tools\artur\artur.pas), line = 538

	lda #$01
	sta I
	lda NUMPIXELS
	sta :@FORTMP?12BE_0

l_12C1
; --- ForToDoCondition
.def :@FORTMP?12BE_0 = *+1
	lda #$00
	cmp I
	jcc l_12CF

; optimize OK (test\tools\artur\artur.pas), line = 539

	lda CUR
	jeq l_12DB

; optimize OK (test\tools\artur\artur.pas), line = 540

	lda I
	cmp NUMPIXELS
	jcs l_12F0
	lda Y
	sta XORCURSOR.Y
	lda X
	sta XORCURSOR.X
	jsr XORCURSOR
l_12F0
	jmp l_1303
l_12DB

; optimize OK (test\tools\artur\artur.pas), line = 541

	lda Y
	asl @
	tay
	lda adr.LINEOFFSET,y
	add X
	sta :STACKORIGIN+9
	lda adr.LINEOFFSET+1,y
	adc #$7C
	sta :bp+1
	ldy :STACKORIGIN+9
	lda BRUSH
	sta (:bp),y
l_1303

; optimize OK (test\tools\artur\artur.pas), line = 542

	lda D
	jpl l_1328

; optimize OK (test\tools\artur\artur.pas), line = 543

	add DINC1
	sta D

; optimize OK (test\tools\artur\artur.pas), line = 544

	lda X
	add XINC1
	sta X

; optimize OK (test\tools\artur\artur.pas), line = 545

	lda Y
	add YINC1
	sta Y
	jmp l_1356
l_1328

; optimize OK (test\tools\artur\artur.pas), line = 548

	lda D
	add DINC2
	sta D

; optimize OK (test\tools\artur\artur.pas), line = 549

	lda X
	add XINC2
	sta X

; optimize OK (test\tools\artur\artur.pas), line = 550

	lda Y
	add YINC2
	sta Y
l_1356

; --- ForToDoEpilog
	inc I
	jne l_12C1
l_12CF

; optimize OK (test\tools\artur\artur.pas), line = 553

	lda CUR
	jeq l_138B
	lda #$FF
	sta P2X
l_138B

; ------------------------------------------------------------

DELTAX	= DATAORIGIN+$0A77
DELTAY	= DATAORIGIN+$0A78
D	= DATAORIGIN+$0A79
DINC1	= DATAORIGIN+$0A7A
DINC2	= DATAORIGIN+$0A7B
XINC1	= DATAORIGIN+$0A7C
XINC2	= DATAORIGIN+$0A7D
YINC1	= DATAORIGIN+$0A7E
YINC2	= DATAORIGIN+$0A7F
NUMPIXELS	= DATAORIGIN+$0A80
X	= DATAORIGIN+$0A81
Y	= DATAORIGIN+$0A82
I	= DATAORIGIN+$0A83
CUR	= DATAORIGIN+$0A84
@FORTMP_12BE	= $00

@VarData	= DELTAX
@VarDataSize	= 14

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	MOVECURSOR					; PROCEDURE

; optimize FAIL ('SYSTEM.PAUSE_0472', test\tools\artur\artur.pas), line = 559

	jsr SYSTEM.PAUSE_0472

; optimize OK (test\tools\artur\artur.pas), line = 560

	lda #$00
	sta SELECTIONMODE

; optimize OK (test\tools\artur\artur.pas), line = 561

	lda CURSORY
	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 563

	lda CURSORX
	add DX
	sta CURSORX

; optimize OK (test\tools\artur\artur.pas), line = 564

	cmp #$FF
	jne l_13C0
	lda #$27
	sta CURSORX
l_13C0

; optimize OK (test\tools\artur\artur.pas), line = 565

	lda CURSORX
	cmp #$28
	jne l_13D9
	lda #$00
	sta CURSORX
l_13D9

; optimize OK (test\tools\artur\artur.pas), line = 566

	lda CURSORY
	add DY
	sta CURSORY

; optimize OK (test\tools\artur\artur.pas), line = 567

	cmp #$FF
	jne l_13FE
	lda #$17
	sta CURSORY
l_13FE

; optimize OK (test\tools\artur\artur.pas), line = 568

	lda CURSORY
	cmp #$18
	jne l_1417
	lda #$00
	sta CURSORY
l_1417

; optimize OK (test\tools\artur\artur.pas), line = 569

	lda CURSORY
	asl @
	tay
	lda adr.LINEOFFSET,y
	add CURSORX
	sta CURSOR
	lda adr.LINEOFFSET+1,y
	adc #$00
	sta CURSOR+1

; optimize OK (test\tools\artur\artur.pas), line = 573

	lda MODE
	cmp #$01
	jeq l_144Ax
	cmp #$02
	jne l_144A
l_144Ax

; optimize OK (test\tools\artur\artur.pas), line = 574

	lda P1X
	cmp #$FF
	jeq l_1469
	lda P2X
	cmp #$FF
	jne l_1469

; optimize FAIL ('ERASEALLCURSORS', test\tools\artur\artur.pas), line = 575

	jsr ERASEALLCURSORS

; optimize OK (test\tools\artur\artur.pas), line = 576

	lda MODE
	cmp #$01
	jne l_1489
	lda DRAWTOOL
	cmp #$01
	jne l_1489

; optimize FAIL ('DRAWLINE', test\tools\artur\artur.pas), line = 577

	jsr DRAWLINE
	jmp l_1494
l_1489

; optimize OK (test\tools\artur\artur.pas), line = 578

	lda CURSORY
	sta DRAWSELECTION.PC2Y
	lda CURSORX
	sta DRAWSELECTION.PC2X
	lda P1Y
	sta DRAWSELECTION.PC1Y
	lda P1X
	sta DRAWSELECTION.PC1X
	jsr DRAWSELECTION

; optimize OK (test\tools\artur\artur.pas), line = 579

	lda #$01
	sta SELECTIONMODE
l_1494
l_1469
l_144A

; optimize OK (test\tools\artur\artur.pas), line = 583

	lda SELECTIONMODE
	jne l_14B8
	lda CURSORY
	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR
l_14B8

; optimize FAIL ('READCURSORCHAR', test\tools\artur\artur.pas), line = 584

	jsr READCURSORCHAR

; optimize FAIL ('UPDATEXYK', test\tools\artur\artur.pas), line = 585

	jsr UPDATEXYK

; optimize OK (test\tools\artur\artur.pas), line = 586

	lda #$00
	sta KEYDOWN

; ------------------------------------------------------------

DX	= DATAORIGIN+$0A86
DY	= DATAORIGIN+$0A87
SELECTIONMODE	= DATAORIGIN+$0A88

@VarData	= DX
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CLEARSELECTION					; PROCEDURE

; optimize FAIL ('ERASEALLCURSORS', test\tools\artur\artur.pas), line = 591

	jsr ERASEALLCURSORS

; optimize OK (test\tools\artur\artur.pas), line = 592

	lda #$FF
	sta P1X
	sta P2X

; optimize OK (test\tools\artur\artur.pas), line = 593

	lda CURSORY
	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CHECKCURSORKEYS					; PROCEDURE
	sta OFFSET

; optimize OK (test\tools\artur\artur.pas), line = 598

	lda #$06
	add OFFSET
	cmp KEY
	jne l_14F8
	lda #$00
	sta MOVECURSOR.DY
	lda #$FF
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_14F8

; optimize OK (test\tools\artur\artur.pas), line = 599

	lda #$07
	add OFFSET
	cmp KEY
	jne l_1516
	lda #$00
	sta MOVECURSOR.DY
	lda #$01
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_1516

; optimize OK (test\tools\artur\artur.pas), line = 600

	lda #$0E
	add OFFSET
	cmp KEY
	jne l_1534
	lda #$FF
	sta MOVECURSOR.DY
	lda #$00
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_1534

; optimize OK (test\tools\artur\artur.pas), line = 601

	lda #$0F
	add OFFSET
	cmp KEY
	jne l_1552
	lda #$01
	sta MOVECURSOR.DY
	lda #$00
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_1552

; ------------------------------------------------------------

OFFSET	= DATAORIGIN+$0A89

@VarData	= OFFSET
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	WRITESXY					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 613

	lda Y
	asl @
	tay
	lda adr.LINEOFFSET,y
	add X
	sta CARRET
	lda adr.LINEOFFSET+1,y
	adc #$7C
	sta CARRET+1

; optimize OK (test\tools\artur\artur.pas), line = 614

	lda <adr.S+$01
	sta SYSTEM.MOVE_045D.SOURCE
	lda >adr.S+$01
	sta SYSTEM.MOVE_045D.SOURCE+1
	lda adr.S+$00
	sta SYSTEM.MOVE_045D.COUNT
	lda #$00
	sta SYSTEM.MOVE_045D.COUNT+1
	lda CARRET
	sta SYSTEM.MOVE_045D.DEST
	lda CARRET+1
	sta SYSTEM.MOVE_045D.DEST+1
	.local +MAIN.SYSTEM.MOVE_045D
	m@INLINE
	.endl

; ------------------------------------------------------------

X	= DATAORIGIN+$0A8A
Y	= DATAORIGIN+$0A8B
CARRET	= DATAORIGIN+$0A8C

@VarData	= X
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	GETHEXVAL					; FUNCTION

; optimize OK (test\tools\artur\artur.pas), line = 620

	lda DEFAULT
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 621

	lda Y
	sta B_CRT.CRT_GOTOXY.Y
	lda X
	sta B_CRT.CRT_GOTOXY.X
	jsr B_CRT.CRT_GOTOXY

; optimize FAIL ('B_CRT.CRT_WRITE_060C', test\tools\artur\artur.pas), line = 622

	inx
	mva #$00 :STACKORIGIN,x
	mva #$21 :STACKORIGIN+STACKWIDTH,x
	jsr B_CRT.CRT_WRITE_060C

; optimize OK (test\tools\artur\artur.pas), line = 623

	lda Y
	sta XORCURSOR.Y
	lda X
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 624

	lda X
	add #$01
	sta XORCURSOR.X
	lda Y
	sta XORCURSOR.Y
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 625

	lda Y
	sta B_CRT.CRT_GOTOXY.Y
	lda X
	sta B_CRT.CRT_GOTOXY.X
	jsr B_CRT.CRT_GOTOXY

; optimize OK (test\tools\artur\artur.pas), line = 626

	lda #$02
	jsr B_CRT.CRT_READSTRINGI_06AD
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 627

	lda <ERR
	sta PARSEHEX.ERR
	lda >ERR
	sta PARSEHEX.ERR+1
	lda <I
	sta PARSEHEX.I
	lda >I
	sta PARSEHEX.I+1
	jsr PARSEHEX

; optimize OK (test\tools\artur\artur.pas), line = 628

	lda ERR
	jne l_15B9
	lda I
	sta RESULT
l_15B9

; optimize OK (test\tools\artur\artur.pas), line = 629

	lda Y
	sta XORCURSOR.Y
	lda X
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 630

	lda X
	add #$01
	sta XORCURSOR.X
	lda Y
	sta XORCURSOR.Y
	jsr XORCURSOR
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

X	= DATAORIGIN+$0A8E
Y	= DATAORIGIN+$0A8F
DEFAULT	= DATAORIGIN+$0A90
RESULT	= DATAORIGIN+$0A91
ERR	= DATAORIGIN+$0A92
I	= DATAORIGIN+$0A93

@VarData	= X
@VarDataSize	= 6

	rts						; ret
.endl

.local	GETFILENAME					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 639

	lda #$00
	sta DRAWRECT.C
	lda #$06
	sta DRAWRECT.H
	lda #$17
	sta DRAWRECT.W
	lda Y
	sta DRAWRECT.Y
	lda X
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-16
	mva:rne CODEORIGIN+$0104+16-256,y adr.S+16-256,y+

; optimize FAIL (0, test\tools\artur\artur.pas), line = 641

	inc X
	inc X
	inc Y

; optimize OK (test\tools\artur\artur.pas), line = 642

	lda Y
	sta WRITESXY.Y
	lda X
	sta WRITESXY.X
	jsr WRITESXY

; optimize FAIL (0, test\tools\artur\artur.pas), line = 643

	inc Y
	inc Y

; optimize OK (test\tools\artur\artur.pas), line = 644

	lda X
	sta I
	add #$0D
	sta :@FORTMP?160E_0

l_1611
; --- ForToDoCondition
.def :@FORTMP?160E_0 = *+1
	lda #$00
	cmp I
	jcc l_161F
	lda Y
	sta XORCURSOR.Y
	lda I
	sta XORCURSOR.X
	jsr XORCURSOR

; --- ForToDoEpilog
	inc I
	jne l_1611
l_161F

; optimize OK (test\tools\artur\artur.pas), line = 645

	lda Y
	sta B_CRT.CRT_GOTOXY.Y
	lda X
	sta B_CRT.CRT_GOTOXY.X
	jsr B_CRT.CRT_GOTOXY
	ldy #256-13
	mva:rne CODEORIGIN+$0115+13-256,y adr.S+13-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 647

	lda #$0C
	jsr B_CRT.CRT_READSTRING_076E
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 648

	lda X
	sta I
	add #$0D
	sta :@FORTMP?1642_0

l_1645
; --- ForToDoCondition
.def :@FORTMP?1642_0 = *+1
	lda #$00
	cmp I
	jcc l_1653
	lda Y
	sta XORCURSOR.Y
	lda I
	sta XORCURSOR.X
	jsr XORCURSOR

; --- ForToDoEpilog
	inc I
	jne l_1645
l_1653

; optimize FAIL (0, test\tools\artur\artur.pas), line = 649

	inc Y

; optimize OK (test\tools\artur\artur.pas), line = 650

	lda Y
	sta B_CRT.CRT_GOTOXY.Y
	lda X
	sta B_CRT.CRT_GOTOXY.X
	jsr B_CRT.CRT_GOTOXY

; optimize FAIL ('CRT.KEYPRESSED', test\tools\artur\artur.pas), line = 651

	jsr CRT.KEYPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_1674
	jsr CRT.READKEY
	dex
l_1674

; optimize OK (test\tools\artur\artur.pas), line = 652

	lda S
	sta SYSUTILS.ANSIUPPERCASE.A
	lda S+1
	sta SYSUTILS.ANSIUPPERCASE.A+1
	jsr SYSUTILS.ANSIUPPERCASE
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize FAIL ('ADDDRIVETOS', test\tools\artur\artur.pas), line = 653

	jsr ADDDRIVETOS

; ------------------------------------------------------------

X	= DATAORIGIN+$0A94
Y	= DATAORIGIN+$0A95
FIL_W	= $17
FIL_H	= $06
I	= DATAORIGIN+$0A96
@FORTMP_160E	= $00
@FORTMP_1642	= $00

@VarData	= X
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SELECTTOOL					; PROCEDURE
	sta TOOL

; optimize OK (test\tools\artur\artur.pas), line = 658

	lda TOOL
	sta DRAWTOOL

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 659

	jsr SHOWMENUBAR

; optimize OK (test\tools\artur\artur.pas), line = 660

	lda #$00
	sta KEYDOWN

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 661

	jsr CLEARSELECTION

; ------------------------------------------------------------

TOOL	= DATAORIGIN+$0A99

@VarData	= TOOL
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	NEXTMODE					; PROCEDURE

; optimize FAIL (0, test\tools\artur\artur.pas), line = 666

	inc MODE

; optimize OK (test\tools\artur\artur.pas), line = 667

	lda MODE
	cmp #$03
	jne l_16A6
	lda #$00
	sta MODE
l_16A6

; optimize OK (test\tools\artur\artur.pas), line = 668

	lda #$0A
	sta KEYREPEATCOUNTER

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 669

	jsr CLEARSELECTION

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 670

	jsr SHOWSTATUS

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 671

	jsr SHOWMENUBAR
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	OPENMODAL					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 676

	lda #$0A
	sta KEYREPEATCOUNTER

; optimize FAIL ('ERASEALLCURSORS', test\tools\artur\artur.pas), line = 677

	jsr ERASEALLCURSORS

; optimize OK (test\tools\artur\artur.pas), line = 678

	lda #$E0
	sta EDITORCHARSET

; optimize FAIL ('STOREEDITINBUFFER', test\tools\artur\artur.pas), line = 679

	jsr STOREEDITINBUFFER
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CLOSEMODAL					; PROCEDURE

; optimize FAIL ('RESTOREEDITFROMBUFFER', test\tools\artur\artur.pas), line = 684

	jsr RESTOREEDITFROMBUFFER

; optimize FAIL ('ERASEALLCURSORS', test\tools\artur\artur.pas), line = 685

	jsr ERASEALLCURSORS

; optimize OK (test\tools\artur\artur.pas), line = 686

	lda #$00
	sta MOVECURSOR.DY
	sta MOVECURSOR.DX
	jsr MOVECURSOR

; optimize OK (test\tools\artur\artur.pas), line = 687

	lda P2X
	cmp #$FF
	jeq l_16DD
	lda P2Y
	sta DRAWSELECTION.PC2Y
	lda P2X
	sta DRAWSELECTION.PC2X
	lda P1Y
	sta DRAWSELECTION.PC1Y
	lda P1X
	sta DRAWSELECTION.PC1X
	jsr DRAWSELECTION
l_16DD

; optimize OK (test\tools\artur\artur.pas), line = 688

	lda CURSORY
	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 689

	lda #$74
	sta EDITORCHARSET

; optimize OK (test\tools\artur\artur.pas), line = 690

	lda #$0A
	sta KEYREPEATCOUNTER
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	HISTORYBACK					; PROCEDURE

; optimize FAIL (0, test\tools\artur\artur.pas), line = 700

	inc BRUSHINDEX

; optimize OK (test\tools\artur\artur.pas), line = 701

	lda BRUSHINDEX
	cmp #$12
	jcc l_1716
	lda #$00
	sta BRUSHINDEX
l_1716

; optimize OK (test\tools\artur\artur.pas), line = 702

	ldy BRUSHINDEX
	lda adr.BRUSHHISTORY,y
	sta BRUSH

; optimize FAIL ('ADJUSTBRUSHFRAME', test\tools\artur\artur.pas), line = 703

	jsr ADJUSTBRUSHFRAME
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	HISTORYFWD					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 708

	lda BRUSHINDEX
	jne l_173D
	lda #$12
	sta BRUSHINDEX
l_173D

; optimize FAIL (0, test\tools\artur\artur.pas), line = 709

	dec BRUSHINDEX

; optimize OK (test\tools\artur\artur.pas), line = 710

	ldy BRUSHINDEX
	lda adr.BRUSHHISTORY,y
	sta BRUSH

; optimize FAIL ('ADJUSTBRUSHFRAME', test\tools\artur\artur.pas), line = 711

	jsr ADJUSTBRUSHFRAME
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	INJECTBRUSH					; PROCEDURE
	sta C

; optimize OK (test\tools\artur\artur.pas), line = 717

	lda #$00
	sta I

; optimize OK (test\tools\artur\artur.pas), line = 718

	tay
	lda adr.BRUSHHISTORY,y
	sta PREV

; optimize OK (test\tools\artur\artur.pas), line = 719

	lda C
	sta adr.BRUSHHISTORY,y

; --- RepeatUntilProlog
l_176D

; optimize OK (test\tools\artur\artur.pas), line = 721

	lda PREV
	cmp C
	jne l_1781
	jmp @exit					; exit
l_1781

; optimize FAIL (0, test\tools\artur\artur.pas), line = 722

	inc I

; optimize OK (test\tools\artur\artur.pas), line = 723

	ldy I
	lda adr.BRUSHHISTORY,y
	sta B

; optimize OK (test\tools\artur\artur.pas), line = 724

	lda PREV
	sta adr.BRUSHHISTORY,y

; optimize OK (test\tools\artur\artur.pas), line = 725

	lda B
	sta PREV

; optimize OK (test\tools\artur\artur.pas), line = 726

	lda I
	cmp #$12
	jcc l_176D

; ------------------------------------------------------------

C	= DATAORIGIN+$0A9A
I	= DATAORIGIN+$0A9B
PREV	= DATAORIGIN+$0A9C

@VarData	= C
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	USEBRUSH					; PROCEDURE
	sta C

; optimize OK (test\tools\artur\artur.pas), line = 731

	lda C
	cmp adr.BRUSHHISTORY+$00
	jne l_17C6
	jmp @exit					; exit
l_17C6

; optimize OK (test\tools\artur\artur.pas), line = 732

	lda C
	jsr INJECTBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 733

	lda #$00
	sta BRUSHINDEX

; optimize OK (test\tools\artur\artur.pas), line = 734

	lda C
	sta BRUSH

; optimize FAIL ('ADJUSTBRUSHFRAME', test\tools\artur\artur.pas), line = 735

	jsr ADJUSTBRUSHFRAME

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 736

	jsr SHOWSTATUS

; ------------------------------------------------------------

C	= DATAORIGIN+$0A9D

@VarData	= C
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	POKEBRUSH					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 741

	lda #$00
	jsr STOREUNDOACTION

; optimize OK (test\tools\artur\artur.pas), line = 742

	ldy CURSOR
	lda #$7C
	add CURSOR+1
	sta :bp+1
	lda BRUSH
	sta (:bp),y

; optimize FAIL ('READCURSORCHAR', test\tools\artur\artur.pas), line = 743

	jsr READCURSORCHAR
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SETBRUSHFROMKEY					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 748

	mwy KEYCHARS :bp2
	ldy KEY
	lda (:bp2),y
	jsr B_CRT.ATASCII2ANTIC_053F
	lda :STACKORIGIN,x
	sta B
	dex

; optimize OK (test\tools\artur\artur.pas), line = 749

	lda INVERT
	jeq l_1804
	lda B
	eor #$80
	sta B
l_1804

; optimize OK (test\tools\artur\artur.pas), line = 750

	lda B
	sta BRUSH
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	WRITESPACE					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 755

	lda BRUSH
	sta B

; optimize OK (test\tools\artur\artur.pas), line = 756

	lda #$00
	sta BRUSH

; optimize OK (test\tools\artur\artur.pas), line = 757

	lda INVERT
	jeq l_1831
	lda #$80
	sta BRUSH
l_1831

; optimize OK (test\tools\artur\artur.pas), line = 758

	lda #$00
	jsr STOREUNDOACTION

; optimize FAIL ('POKEBRUSH', test\tools\artur\artur.pas), line = 759

	jsr POKEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 760

	lda B
	sta BRUSH

; optimize OK (test\tools\artur\artur.pas), line = 761

	lda #$00
	sta KEYDOWN
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	BRUSHSELECTOR					; FUNCTION

	jmp l_1849

.local	UPDATEBRUSHCURSOR				; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 777

	lda CY
	sta XORCURSOR.Y
	lda CX
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 778

	lda CBRUSH
	and #$0F
	add #$0C
	sta CX

; optimize OK (test\tools\artur\artur.pas), line = 779

	lda CBRUSH
	lsr @
	lsr @
	lsr @
	lsr @
	add #$05
	sta CY

; optimize OK (test\tools\artur\artur.pas), line = 780

	sta XORCURSOR.Y
	lda CX
	sta XORCURSOR.X
	jsr XORCURSOR
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl
l_1849

; optimize FAIL ('ERASEALLCURSORS', test\tools\artur\artur.pas), line = 784

	jsr ERASEALLCURSORS

; optimize OK (test\tools\artur\artur.pas), line = 785

	lda BRUSH
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 786

	sta CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 787

	lda #$0A
	sta KEYREPEATCOUNTER

; optimize FAIL ('STOREEDITINBUFFER', test\tools\artur\artur.pas), line = 788

	jsr STOREEDITINBUFFER

; optimize OK (test\tools\artur\artur.pas), line = 789

	lda #$80
	sta DRAWRECT.C
	lda #$14
	sta DRAWRECT.H
	lda #$12
	sta DRAWRECT.W
	lda #$02
	sta DRAWRECT.Y
	lda #$0B
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-13
	mva:rne CODEORIGIN+$0123+13-256,y adr.S+13-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 791

	lda #$03
	sta WRITESXY.Y
	lda #$0C
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 794

	lda #$0C
	add adr.LINEOFFSET+$0A
	sta VRAM
	lda #$7C
	adc adr.LINEOFFSET+1+$0A
	sta VRAM+1

; optimize OK (test\tools\artur\artur.pas), line = 795

	lda #$00
	sta B

; --- RepeatUntilProlog
l_18B1

; optimize OK (test\tools\artur\artur.pas), line = 797

	ldy VRAM+1
	sty :bp+1
	ldy VRAM
	lda B
	sta (:bp),y

; optimize FAIL (0, test\tools\artur\artur.pas), line = 798

	inc B

; optimize FAIL (0, test\tools\artur\artur.pas), line = 799

	inc VRAM
	sne
	inc VRAM+1

; optimize OK (test\tools\artur\artur.pas), line = 800

	lda B
	and #$0F
	jne l_18D5
	lda VRAM
	add #$18
	sta VRAM
	scc
	inc VRAM+1
l_18D5

; optimize OK (test\tools\artur\artur.pas), line = 801

	lda B
	jne l_18B1

; optimize OK (test\tools\artur\artur.pas), line = 803

	lda BRUSH
	sta CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 804

	and #$0F
	add #$0C
	sta CX

; optimize OK (test\tools\artur\artur.pas), line = 805

	lda CBRUSH
	lsr @
	lsr @
	lsr @
	lsr @
	add #$05
	sta CY

; optimize OK (test\tools\artur\artur.pas), line = 806

	sta XORCURSOR.Y
	lda CX
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 808

	lda #$00
	sta DONE

; --- RepeatUntilProlog
l_191C

; optimize FAIL ('READJOYSTICK', test\tools\artur\artur.pas), line = 811

	jsr READJOYSTICK

; optimize OK (test\tools\artur\artur.pas), line = 813

	lda KEYREPEATCOUNTER
	jne l_192F

; optimize FAIL ('CRT.KEYPRESSED', test\tools\artur\artur.pas), line = 814

	jsr CRT.KEYPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_193A

; optimize FAIL ('CRT.READKEY', test\tools\artur\artur.pas), line = 815

	jsr CRT.READKEY
	lda :STACKORIGIN,x
	sta C
	dex

; optimize OK (test\tools\artur\artur.pas), line = 816

	lda C
	cmp #$1B
	jne l_1951
	lda #$01
	sta DONE
l_1951

; optimize OK (test\tools\artur\artur.pas), line = 817

	lda ATARI.KBCODE
	cmp #$0C
	jeq l_1976x
	cmp #$3C
	jne l_1976
l_1976x

; optimize OK (test\tools\artur\artur.pas), line = 818

	lda CBRUSH
	jpl l_1989
	lda #$01
	sta INVERT
l_1989

; optimize OK (test\tools\artur\artur.pas), line = 819

	lda CBRUSH
	jsr USEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 820

	lda CBRUSH
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 821

	lda #$01
	sta DONE
l_1976

; optimize OK (test\tools\artur\artur.pas), line = 823

	lda #$00
	sta MOVED

; optimize OK (test\tools\artur\artur.pas), line = 824

	lda ATARI.KBCODE
	cmp #$21
	jne l_19B6

; optimize OK (test\tools\artur\artur.pas), line = 825

	lda CBRUSH
	jsr USEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 826

	lda #$01
	sta MOVED
l_19B6

; optimize OK (test\tools\artur\artur.pas), line = 828

	lda #$80
	sta KOFFSET

; optimize OK (test\tools\artur\artur.pas), line = 829

	lda CONFIG.ARROWSRAW
	jeq l_19D1
	lda #$00
	sta KOFFSET
l_19D1

; optimize OK (test\tools\artur\artur.pas), line = 830

	lda #$06
	add KOFFSET
	cmp ATARI.KBCODE
	jne l_19F0

; optimize FAIL (0, test\tools\artur\artur.pas), line = 831

	dec CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 832

	lda #$01
	sta MOVED
l_19F0

; optimize OK (test\tools\artur\artur.pas), line = 834

	lda #$07
	add KOFFSET
	cmp ATARI.KBCODE
	jne l_1A13

; optimize FAIL (0, test\tools\artur\artur.pas), line = 835

	inc CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 836

	lda #$01
	sta MOVED
l_1A13

; optimize OK (test\tools\artur\artur.pas), line = 838

	lda #$0E
	add KOFFSET
	cmp ATARI.KBCODE
	jne l_1A36

; optimize OK (test\tools\artur\artur.pas), line = 839

	lda CBRUSH
	sub #$10
	sta CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 840

	lda #$01
	sta MOVED
l_1A36

; optimize OK (test\tools\artur\artur.pas), line = 842

	lda #$0F
	add KOFFSET
	cmp ATARI.KBCODE
	jne l_1A56

; optimize OK (test\tools\artur\artur.pas), line = 843

	lda CBRUSH
	add #$10
	sta CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 844

	lda #$01
	sta MOVED
l_1A56

; optimize OK (test\tools\artur\artur.pas), line = 846

	lda MOVED
	jeq l_1A6A

; optimize FAIL ('UPDATEBRUSHCURSOR', test\tools\artur\artur.pas), line = 847

	jsr UPDATEBRUSHCURSOR
	jmp l_1A75
l_1A6A

; optimize OK (test\tools\artur\artur.pas), line = 848

	mwy KEYCHARS :bp2
	ldy ATARI.KBCODE
	lda (:bp2),y
	jsr B_CRT.ATASCII2ANTIC_053F
	lda :STACKORIGIN,x
	sta B
	dex

; optimize OK (test\tools\artur\artur.pas), line = 849

	lda INVERT
	jeq l_1A8B
	lda B
	eor #$80
	sta B
l_1A8B

; optimize OK (test\tools\artur\artur.pas), line = 850

	lda B
	sta BRUSH

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 851

	jsr SHOWSTATUS
l_1A75

; optimize OK (test\tools\artur\artur.pas), line = 853

	lda #$0A
	sta KEYREPEATCOUNTER
l_193A

; optimize OK (test\tools\artur\artur.pas), line = 856

	lda JOYX
	jne l_1AC3x
	lda JOYY
	jeq l_1AC3
l_1AC3x

; optimize OK (test\tools\artur\artur.pas), line = 857

	lda JOYY
	asl @
	asl @
	asl @
	asl @
	sta JOYY

; optimize OK (test\tools\artur\artur.pas), line = 858

	lda CBRUSH
	add JOYY
	sta CBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 859

	add JOYX
	sta CBRUSH

; optimize FAIL ('UPDATEBRUSHCURSOR', test\tools\artur\artur.pas), line = 860

	jsr UPDATEBRUSHCURSOR

; optimize OK (test\tools\artur\artur.pas), line = 861

	lda #$04
	sta KEYREPEATCOUNTER
l_1AC3

; optimize OK (test\tools\artur\artur.pas), line = 863

	lda JOYFIRE
	jne l_1AFF

; optimize OK (test\tools\artur\artur.pas), line = 864

	lda CBRUSH
	jpl l_1B12
	lda #$01
	sta INVERT
l_1B12

; optimize OK (test\tools\artur\artur.pas), line = 865

	lda CBRUSH
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 866

	lda #$14
	sta KEYREPEATCOUNTER

; optimize OK (test\tools\artur\artur.pas), line = 867

	lda #$01
	sta DONE
l_1AFF
l_192F

; optimize OK (test\tools\artur\artur.pas), line = 873

	lda DONE
	jeq l_191C

; optimize OK (test\tools\artur\artur.pas), line = 875

	lda CY
	sta XORCURSOR.Y
	lda CX
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize FAIL ('CLOSEMODAL', test\tools\artur\artur.pas), line = 876

	jsr CLOSEMODAL
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0A9E
BRS_X	= $0B
BRS_Y	= $02
BRS_W	= $12
BRS_H	= $14
VRAM	= DATAORIGIN+$0A9F
CBRUSH	= DATAORIGIN+$0AA1
CX	= DATAORIGIN+$0AA2
CY	= DATAORIGIN+$0AA3
KOFFSET	= DATAORIGIN+$0AA4
MOVED	= DATAORIGIN+$0AA5
DONE	= DATAORIGIN+$0AA6

@VarData	= RESULT
@VarDataSize	= 9

	rts						; ret
.endl

.local	SORTPOINTSANDGETCORNER				; FUNCTION

; optimize OK (test\tools\artur\artur.pas), line = 886

	lda P2X
	cmp P1X
	jcs l_1B55
	lda <P2X
	sta SWAP.B
	lda >P2X
	sta SWAP.B+1
	lda <P1X
	sta SWAP.A
	lda >P1X
	sta SWAP.A+1
	jsr SWAP
l_1B55

; optimize OK (test\tools\artur\artur.pas), line = 887

	lda P2Y
	cmp P1Y
	jcs l_1B6F
	lda <P2Y
	sta SWAP.B
	lda >P2Y
	sta SWAP.B+1
	lda <P1Y
	sta SWAP.A
	lda >P1Y
	sta SWAP.A+1
	jsr SWAP
l_1B6F

; optimize OK (test\tools\artur\artur.pas), line = 888

	lda P1Y
	asl @
	tay
	lda adr.LINEOFFSET,y
	add P1X
	sta RESULT
	lda adr.LINEOFFSET+1,y
	adc #$7C
	sta RESULT+1
@exit

; ------------------------------------------------------------

; Push WORD / SMALLINT / SHORTREAL / POINTER
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x
	mva RESULT+1 :STACKORIGIN+STACKWIDTH,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

RESULT	= DATAORIGIN+$0AA7

@VarData	= RESULT
@VarDataSize	= 2

	rts						; ret
.endl

.local	INVERTBLOCK					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 895

	lda #$01
	jsr STOREUNDOACTION

; optimize FAIL ('SORTPOINTSANDGETCORNER', test\tools\artur\artur.pas), line = 896

	jsr SORTPOINTSANDGETCORNER
	inx
	lda :STACKORIGIN-1,x
	sub P1X
	sta VRAM
	lda :STACKORIGIN-1+STACKWIDTH,x
	sbc #$00
	sta VRAM+1
	dex
	dex

; optimize OK (test\tools\artur\artur.pas), line = 897

	lda P1Y
	sta Y
	lda P2Y
	sta :@FORTMP?1BA3_0

l_1BA6
; --- ForToDoCondition
.def :@FORTMP?1BA3_0 = *+1
	lda #$00
	cmp Y
	jcc l_1BB4

; optimize OK (test\tools\artur\artur.pas), line = 898

	lda P1X
	sta X
	lda P2X
	sta :@FORTMP?1BBE_0

l_1BC1
; --- ForToDoCondition
.def :@FORTMP?1BBE_0 = *+1
	lda #$00
	cmp X
	jcc l_1BCF

; optimize OK (test\tools\artur\artur.pas), line = 899

	lda VRAM
	add X
	sta :STACKORIGIN+9
	lda VRAM+1
	adc #$00
	sta :bp+1
	mwy VRAM :bp2
	ldy X
	lda (:bp2),y
	eor #$80
	ldy :STACKORIGIN+9
	sta (:bp),y

; --- ForToDoEpilog
	inc X
	jne l_1BC1
l_1BCF

; optimize OK (test\tools\artur\artur.pas), line = 901

	lda VRAM
	add #$28
	sta VRAM
	scc
	inc VRAM+1

; --- ForToDoEpilog
	inc Y
	jne l_1BA6
l_1BB4

; ------------------------------------------------------------

X	= DATAORIGIN+$0AA9
Y	= DATAORIGIN+$0AAA
VRAM	= DATAORIGIN+$0AAB
@FORTMP_1BA3	= $00
@FORTMP_1BBE	= $00

@VarData	= X
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	CALCULATEWIDTHANDHEIGHT				; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 907

	lda P2X
	sub P1X
	add #$01
	sta W

; optimize OK (test\tools\artur\artur.pas), line = 908

	lda P2Y
	sub P1Y
	add #$01
	sta H
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	DRAWBLOCK					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 914

	lda #$01
	jsr STOREUNDOACTION

; optimize FAIL ('SORTPOINTSANDGETCORNER', test\tools\artur\artur.pas), line = 915

	jsr SORTPOINTSANDGETCORNER
	lda :STACKORIGIN,x
	sta VRAM
	lda :STACKORIGIN+STACKWIDTH,x
	sta VRAM+1
	dex

; optimize FAIL ('CALCULATEWIDTHANDHEIGHT', test\tools\artur\artur.pas), line = 916

	jsr CALCULATEWIDTHANDHEIGHT

; optimize OK (test\tools\artur\artur.pas), line = 917

	lda BRUSH
	sta DRAWRECT.C
	lda H
	sta DRAWRECT.H
	lda W
	sta DRAWRECT.W
	lda P1Y
	sta DRAWRECT.Y
	lda P1X
	sta DRAWRECT.X
	jsr DRAWRECT

; ------------------------------------------------------------

VRAM	= DATAORIGIN+$0AAF

@VarData	= VRAM
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	COPYBLOCK					; PROCEDURE
	sta MOVEBLOCK

; optimize OK (test\tools\artur\artur.pas), line = 923

	lda #$01
	jsr STOREUNDOACTION

; optimize FAIL ('SORTPOINTSANDGETCORNER', test\tools\artur\artur.pas), line = 924

	jsr SORTPOINTSANDGETCORNER
	inx
	mva #$00 :STACKORIGIN,x
	mva #$7C :STACKORIGIN+STACKWIDTH,x
	jsr subAX_CX
	lda :STACKORIGIN-1,x
	sta BRAM
	lda :STACKORIGIN-1+STACKWIDTH,x
	add #$78
	sta BRAM+1
	dex
	dex

; optimize OK (test\tools\artur\artur.pas), line = 925

	lda CURSOR
	sta VRAM
	lda #$7C
	add CURSOR+1
	sta VRAM+1

; optimize FAIL ('CALCULATEWIDTHANDHEIGHT', test\tools\artur\artur.pas), line = 926

	jsr CALCULATEWIDTHANDHEIGHT

; optimize OK (test\tools\artur\artur.pas), line = 927

	lda CURSORX
	add W
	cmp #$28
	jcc l_1C63
	lda #$28
	sub CURSORX
	sta W
l_1C63

; optimize OK (test\tools\artur\artur.pas), line = 928

	lda CURSORY
	add H
	cmp #$18
	jcc l_1C88
	lda #$18
	sub CURSORY
	sta H
l_1C88

; optimize FAIL ('STOREEDITINBUFFER', test\tools\artur\artur.pas), line = 929

	jsr STOREEDITINBUFFER

; optimize OK (test\tools\artur\artur.pas), line = 930

	lda MOVEBLOCK
	jeq l_1CA2

; optimize OK (test\tools\artur\artur.pas), line = 931

	lda #$00
	sta DRAWRECT.C
	lda H
	sta DRAWRECT.H
	lda W
	sta DRAWRECT.W
	lda P1Y
	sta DRAWRECT.Y
	lda P1X
	sta DRAWRECT.X
	jsr DRAWRECT

; optimize OK (test\tools\artur\artur.pas), line = 932

	lda CURSORX
	sta P1X

; optimize OK (test\tools\artur\artur.pas), line = 933

	lda CURSORY
	sta P1Y

; optimize OK (test\tools\artur\artur.pas), line = 934

	lda CURSORX
	add W
	sub #$01
	sta P2X

; optimize OK (test\tools\artur\artur.pas), line = 935

	lda CURSORY
	add H
	sub #$01
	sta P2Y

; optimize OK (test\tools\artur\artur.pas), line = 936

	sta DRAWSELECTION.PC2Y
	lda P2X
	sta DRAWSELECTION.PC2X
	lda P1Y
	sta DRAWSELECTION.PC1Y
	lda P1X
	sta DRAWSELECTION.PC1X
	jsr DRAWSELECTION

; optimize OK (test\tools\artur\artur.pas), line = 937

	lda CURSORY
	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR
l_1CA2

; --- RepeatUntilProlog
l_1CF4

; optimize OK (test\tools\artur\artur.pas), line = 940

	lda W
	sta SYSTEM.MOVE_045B.COUNT
	lda #$00
	sta SYSTEM.MOVE_045B.COUNT+1
	lda VRAM
	sta SYSTEM.MOVE_045B.DEST
	lda VRAM+1
	sta SYSTEM.MOVE_045B.DEST+1
	lda BRAM
	sta SYSTEM.MOVE_045B.SOURCE
	lda BRAM+1
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 941

	lda VRAM
	add #$28
	sta VRAM
	scc
	inc VRAM+1

; optimize OK (test\tools\artur\artur.pas), line = 942

	lda BRAM
	add #$28
	sta BRAM
	scc
	inc BRAM+1

; optimize OK (test\tools\artur\artur.pas), line = 943

	lda VRAM+1
	cmp #$7F
	jcc l_1D0F\ bne @+
	lda VRAM
	cmp #$C0
	jcc l_1D0F
@
	lda VRAM
	sub #$C0
	sta VRAM
	lda VRAM+1
	sbc #$03
	sta VRAM+1
l_1D0F

; optimize FAIL (0, test\tools\artur\artur.pas), line = 944

	dec H

; optimize OK (test\tools\artur\artur.pas), line = 945

	jne l_1CF4

; ------------------------------------------------------------

MOVEBLOCK	= DATAORIGIN+$0AB1
VRAM	= DATAORIGIN+$0AB2
BRAM	= DATAORIGIN+$0AB4

@VarData	= MOVEBLOCK
@VarDataSize	= 5

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	DRAWFRAME					; PROCEDURE

; optimize OK (test\tools\artur\artur.pas), line = 951

	lda #$01
	jsr STOREUNDOACTION

; optimize FAIL ('SORTPOINTSANDGETCORNER', test\tools\artur\artur.pas), line = 952

	jsr SORTPOINTSANDGETCORNER
	lda :STACKORIGIN,x
	sta VRAM
	lda :STACKORIGIN+STACKWIDTH,x
	sta VRAM+1
	dex

; optimize FAIL ('CALCULATEWIDTHANDHEIGHT', test\tools\artur\artur.pas), line = 953

	jsr CALCULATEWIDTHANDHEIGHT

; optimize OK (test\tools\artur\artur.pas), line = 954

	lda BRUSH
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda W
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$00
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda VRAM
	sta SYSTEM.FILLBYTE_045A.A
	lda VRAM+1
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl

; optimize FAIL (0, test\tools\artur\artur.pas), line = 955

	dec H

; --- WhileProlog
	jmp l_1D3E
l_1D3F

; optimize OK (test\tools\artur\artur.pas), line = 957

	ldy VRAM+1
	sty :bp+1
	ldy VRAM
	lda BRUSH
	sta (:bp),y

; optimize OK (test\tools\artur\artur.pas), line = 958

	tya
	add W
	tay
	lda VRAM+1
	adc #$00
	sta :bp+1
	tya
	sne
	dec :bp+1
	dey
	lda BRUSH
	sta (:bp),y

; optimize OK (test\tools\artur\artur.pas), line = 959

	lda VRAM
	add #$28
	sta VRAM
	scc
	inc VRAM+1

; optimize FAIL (0, test\tools\artur\artur.pas), line = 960

	dec H
l_1D3E

; optimize OK (test\tools\artur\artur.pas), line = 956

	lda H
	jne l_1D3F

; optimize OK (test\tools\artur\artur.pas), line = 962

	lda BRUSH
	sta SYSTEM.FILLBYTE_045A.VALUE
	lda W
	sta SYSTEM.FILLBYTE_045A.COUNT
	lda #$00
	sta SYSTEM.FILLBYTE_045A.COUNT+1
	lda VRAM
	sta SYSTEM.FILLBYTE_045A.A
	lda VRAM+1
	sta SYSTEM.FILLBYTE_045A.A+1
	.local +MAIN.SYSTEM.FILLBYTE_045A
	m@INLINE
	.endl

; ------------------------------------------------------------

VRAM	= DATAORIGIN+$0AB6

@VarData	= VRAM
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	IOSTATUS					; PROCEDURE

	mva #$00 adr.S

; optimize OK (test\tools\artur\artur.pas), line = 973

	lda SYSTEM.IORESULT
	sta @CASETMP_0006
	cmp #$85
	jne l_1D7E
@
	ldy #256-14
	mva:rne CODEORIGIN+$0131+14-256,y adr.S+14-256,y+

	jmp a_0006
l_1D7E
	cmp #$88
	beq @+
	cmp #$8B
	jne l_1D89
@
	ldy #256-14
	mva:rne CODEORIGIN+$0140+14-256,y adr.S+14-256,y+

	jmp a_0006
l_1D89
	cmp #$A8
	jne l_1D92
@
	ldy #256-14
	mva:rne CODEORIGIN+$0140+14-256,y adr.S+14-256,y+

	jmp a_0006
l_1D92
	cmp #$01
	beq @+
	cmp #$03
	jne l_1D9D
@
	ldy #256-9
	mva:rne CODEORIGIN+$014F+9-256,y adr.S+9-256,y+

l_1D9D
a_0006

; optimize FAIL ('B_CRT.CRT_WRITE_060C', test\tools\artur\artur.pas), line = 982

	inx
	mva S :STACKORIGIN,x
	mva S+1 :STACKORIGIN+STACKWIDTH,x
	jsr B_CRT.CRT_WRITE_060C

; optimize FAIL ('CRT.READKEY', test\tools\artur\artur.pas), line = 983

	jsr CRT.READKEY
	dex
; CloseFile

	txa:pha
	clc
	@closefile AFILE
	pla:tax

; ------------------------------------------------------------

@CASETMP_0006	= DATAORIGIN+$0AB8

@VarData	= @CASETMP_0006
@VarDataSize	= 1

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	LOADDATA					; PROCEDURE

; AssignFile

; optimize OK (test\tools\artur\artur.pas), line = 989

	mwy AFILE :bp2
	ldy #s@file.pfname
	lda S
	sta (:bp2),y
	iny
	lda S+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y
; Reset

; optimize OK (test\tools\artur\artur.pas), line = 990

	ldy #s@file.record
	lda #$01
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@openfile AFILE, MAIN.SYSTEM.FileMode
	pla:tax

; BlockRead

; optimize OK (test\tools\artur\artur.pas), line = 991

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda BUF
	sta (:bp2),y
	iny
	lda BUF+1
	sta (:bp2),y
	ldy #s@file.nrecord
	lda SIZE
	sta (:bp2),y
	iny
	lda SIZE+1
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #7
	pla:tax

; optimize FAIL ('IOSTATUS', test\tools\artur\artur.pas), line = 992

	jsr IOSTATUS

; ------------------------------------------------------------

BUF	= DATAORIGIN+$0AB9
SIZE	= DATAORIGIN+$0ABB

@VarData	= BUF
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SAVEDATA					; PROCEDURE

; AssignFile

; optimize OK (test\tools\artur\artur.pas), line = 997

	mwy AFILE :bp2
	ldy #s@file.pfname
	lda S
	sta (:bp2),y
	iny
	lda S+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y
; Rewrite

; optimize OK (test\tools\artur\artur.pas), line = 998

	ldy #s@file.record
	lda #$01
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@openfile AFILE, #8
	pla:tax

; BlockWrite

; optimize OK (test\tools\artur\artur.pas), line = 999

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda BUF
	sta (:bp2),y
	iny
	lda BUF+1
	sta (:bp2),y
	ldy #s@file.nrecord
	lda SIZE
	sta (:bp2),y
	iny
	lda SIZE+1
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #11
	pla:tax

; optimize FAIL ('IOSTATUS', test\tools\artur\artur.pas), line = 1000

	jsr IOSTATUS

; ------------------------------------------------------------

BUF	= DATAORIGIN+$0ABD
SIZE	= DATAORIGIN+$0ABF

@VarData	= BUF
@VarDataSize	= 4

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	LOADCONFIG					; PROCEDURE

	ldy #256-13
	mva:rne CODEORIGIN+$0159+13-256,y adr.S+13-256,y+

; optimize FAIL ('ADDDRIVETOS', test\tools\artur\artur.pas), line = 1006

	jsr ADDDRIVETOS

; optimize OK (test\tools\artur\artur.pas), line = 1007

	lda S
	sta SYSUTILS.FILEEXISTS.NAME
	lda S+1
	sta SYSUTILS.FILEEXISTS.NAME+1
	jsr SYSUTILS.FILEEXISTS
	dex
	lda :STACKORIGIN+1,x
	jeq l_1DF2
; AssignFile

; optimize OK (test\tools\artur\artur.pas), line = 1008

	mwy AFILE :bp2
	ldy #s@file.pfname
	lda S
	sta (:bp2),y
	iny
	lda S+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y
; Reset

; optimize OK (test\tools\artur\artur.pas), line = 1009

	ldy #s@file.record
	lda #$01
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@openfile AFILE, MAIN.SYSTEM.FileMode
	pla:tax

; BlockRead

; optimize OK (test\tools\artur\artur.pas), line = 1010

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda CONFIG
	sta (:bp2),y
	iny
	lda CONFIG+1
	sta (:bp2),y
	ldy #s@file.nrecord
	lda #$04
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #7
	pla:tax

; CloseFile

	txa:pha
	clc
	@closefile AFILE
	pla:tax

l_1DF2
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SAVECONFIG					; PROCEDURE

	ldy #256-13
	mva:rne CODEORIGIN+$0159+13-256,y adr.S+13-256,y+

; optimize FAIL ('ADDDRIVETOS', test\tools\artur\artur.pas), line = 1018

	jsr ADDDRIVETOS

; optimize OK (test\tools\artur\artur.pas), line = 1019

	lda #$04
	sta SAVEDATA.SIZE
	lda #$00
	sta SAVEDATA.SIZE+1
	lda CONFIG
	sta SAVEDATA.BUF
	lda CONFIG+1
	sta SAVEDATA.BUF+1
	jsr SAVEDATA
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SAVEBLOCK					; PROCEDURE

; optimize FAIL ('OPENMODAL', test\tools\artur\artur.pas), line = 1031

	jsr OPENMODAL

; optimize OK (test\tools\artur\artur.pas), line = 1032

	lda #$80
	sta DRAWRECT.C
	lda #$0C
	sta DRAWRECT.H
	lda #$1E
	sta DRAWRECT.W
	lda #$02
	sta DRAWRECT.Y
	lda #$05
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-18
	mva:rne CODEORIGIN+$0167+18-256,y adr.S+18-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1034

	lda #$03
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-29
	mva:rne CODEORIGIN+$017A+29-256,y adr.S+29-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1036

	lda #$04
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 1037

	lda #$06
	sta B_CRT.CRT_GOTOXY.Y
	sta B_CRT.CRT_GOTOXY.X
	jsr B_CRT.CRT_GOTOXY

; optimize OK (test\tools\artur\artur.pas), line = 1038

	lda #$06
	sta GETFILENAME.Y
	sta GETFILENAME.X
	jsr GETFILENAME
; AssignFile

; optimize OK (test\tools\artur\artur.pas), line = 1040

	mwy AFILE :bp2
	ldy #s@file.pfname
	lda S
	sta (:bp2),y
	iny
	lda S+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y
; Rewrite

; optimize OK (test\tools\artur\artur.pas), line = 1041

	ldy #s@file.record
	lda #$01
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@openfile AFILE, #8
	pla:tax

; optimize FAIL ('SORTPOINTSANDGETCORNER', test\tools\artur\artur.pas), line = 1043

	jsr SORTPOINTSANDGETCORNER
	inx
	lda :STACKORIGIN-1,x
	sub #$00
	sta PTR
	lda :STACKORIGIN-1+STACKWIDTH,x
	sbc #$7C
	sta PTR+1
	dex
	dex

; optimize FAIL ('CALCULATEWIDTHANDHEIGHT', test\tools\artur\artur.pas), line = 1044

	jsr CALCULATEWIDTHANDHEIGHT

; --- RepeatUntilProlog
l_1E42
; BlockWrite

; optimize OK (test\tools\artur\artur.pas), line = 1046

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda VRAM
	add PTR
	sta (:bp2),y
	iny
	lda VRAM+1
	adc PTR+1
	sta (:bp2),y
	ldy #s@file.nrecord
	lda W
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #11
	pla:tax

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1047

	dec H

; optimize OK (test\tools\artur\artur.pas), line = 1048

	lda PTR
	add #$28
	sta PTR
	scc
	inc PTR+1

; optimize OK (test\tools\artur\artur.pas), line = 1049

	lda H
	jne l_1E42

; optimize FAIL ('IOSTATUS', test\tools\artur\artur.pas), line = 1051

	jsr IOSTATUS

; optimize FAIL ('CLOSEMODAL', test\tools\artur\artur.pas), line = 1052

	jsr CLOSEMODAL

; ------------------------------------------------------------

adr.VRAM	= $7800
.var VRAM	= adr.VRAM .word
PTR	= DATAORIGIN+$0AC1
SVB_X	= $05
SVB_Y	= $02
SVB_W	= $1E
SVB_H	= $0C

@VarData	= VRAM
@VarDataSize	= 3

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SAVEBINARY					; PROCEDURE

; AssignFile

; optimize OK (test\tools\artur\artur.pas), line = 1060

	mwy AFILE :bp2
	ldy #s@file.pfname
	lda S
	sta (:bp2),y
	iny
	lda S+1
	sta (:bp2),y
	ldy #s@file.status
	lda #$00
	sta (:bp2),y
; Rewrite

; optimize OK (test\tools\artur\artur.pas), line = 1061

	ldy #s@file.record
	lda #$01
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@openfile AFILE, #8
	pla:tax

; BlockWrite

; optimize OK (test\tools\artur\artur.pas), line = 1063

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda HEADER
	sta (:bp2),y
	iny
	lda HEADER+1
	sta (:bp2),y
	ldy #s@file.nrecord
	lda #$69
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #11
	pla:tax

; BlockWrite

; optimize OK (test\tools\artur\artur.pas), line = 1064

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda CHARSET
	sta (:bp2),y
	iny
	lda CHARSET+1
	sta (:bp2),y
	ldy #s@file.nrecord
	lda #$C0
	sta (:bp2),y
	iny
	lda #$07
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #11
	pla:tax

; BlockWrite

; optimize OK (test\tools\artur\artur.pas), line = 1065

	mwy AFILE :bp2
	ldy #s@file.buffer
	lda <CONFIG.EDITORBACKGROUNDCOLOR
	sta (:bp2),y
	iny
	lda >CONFIG.EDITORBACKGROUNDCOLOR
	sta (:bp2),y
	ldy #s@file.nrecord
	lda #$02
	sta (:bp2),y
	iny
	lda #$00
	sta (:bp2),y

	txa:pha
	clc
	@readfile AFILE, #11
	pla:tax

; optimize FAIL ('IOSTATUS', test\tools\artur\artur.pas), line = 1067

	jsr IOSTATUS

; optimize FAIL ('CLOSEMODAL', test\tools\artur\artur.pas), line = 1069

	jsr CLOSEMODAL

; ------------------------------------------------------------

adr.HEADER	= $7100
.var HEADER	= adr.HEADER .word
adr.CHARSET	= $7400
.var CHARSET	= adr.CHARSET .word

@VarData	= HEADER
@VarDataSize	= 2

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SHOWHELP					; PROCEDURE

; optimize FAIL ('OPENMODAL', test\tools\artur\artur.pas), line = 1084

	jsr OPENMODAL

; optimize OK (test\tools\artur\artur.pas), line = 1085

	lda #$80
	sta DRAWRECT.C
	lda #$14
	sta DRAWRECT.H
	lda #$1E
	sta DRAWRECT.W
	lda #$02
	sta DRAWRECT.Y
	lda #$05
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-29
	mva:rne CODEORIGIN+$0198+29-256,y adr.S+29-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1087

	lda #$03
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 1088

	lda #$0A
	sta SYSTEM.MOVE_045C.COUNT
	lda #$00
	sta SYSTEM.MOVE_045C.COUNT+1
	lda S
	sta SYSTEM.MOVE_045C.DEST
	lda S+1
	sta SYSTEM.MOVE_045C.DEST+1
	lda VERSION
	sta SYSTEM.MOVE_045C.SOURCE
	lda VERSION+1
	sta SYSTEM.MOVE_045C.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045C
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 1089

	lda #$03
	sta WRITESXY.Y
	lda #$10
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-29
	mva:rne CODEORIGIN+$017A+29-256,y adr.S+29-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1091

	lda #$04
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-19
	mva:rne CODEORIGIN+$01B6+19-256,y adr.S+19-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1093

	lda #$05
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-18
	mva:rne CODEORIGIN+$01CA+18-256,y adr.S+18-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1095

	lda #$08
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-21
	mva:rne CODEORIGIN+$01DD+21-256,y adr.S+21-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1097

	lda #$0A
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-18
	mva:rne CODEORIGIN+$01F3+18-256,y adr.S+18-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1099

	lda #$0C
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-21
	mva:rne CODEORIGIN+$0206+21-256,y adr.S+21-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1101

	lda #$0E
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-14
	mva:rne CODEORIGIN+$021C+14-256,y adr.S+14-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1104

	lda #$14
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; --- RepeatUntilProlog
l_1EBB

; optimize FAIL ('B_CRT.CRT_HELPPRESSED', test\tools\artur\artur.pas), line = 1107

	jsr B_CRT.CRT_HELPPRESSED
	dex
	ldy #1
	lda KEYREPEATCOUNTER
	beq @+
	dey
@
	tya
	and :STACKORIGIN+1,x
	jeq l_1ED1
	jmp b_1EBB					; break
l_1ED1

; optimize FAIL ('CRT.KEYPRESSED', test\tools\artur\artur.pas), line = 1108

	jsr CRT.KEYPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_1EBB
b_1EBB

; optimize FAIL ('CLOSEMODAL', test\tools\artur\artur.pas), line = 1109

	jsr CLOSEMODAL

; optimize FAIL ('CRT.KEYPRESSED', test\tools\artur\artur.pas), line = 1110

	jsr CRT.KEYPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_1EE4
	jsr CRT.READKEY
	dex
l_1EE4

; ------------------------------------------------------------

HLP_X	= $05
HLP_Y	= $02
HLP_W	= $1E
HLP_H	= $14
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	HASEXT						; FUNCTION

; optimize OK (test\tools\artur\artur.pas), line = 1116

	lda #$00
	sta RESULT

; optimize OK (test\tools\artur\artur.pas), line = 1117

	lda #$01
	sta I

; optimize OK (test\tools\artur\artur.pas), line = 1118

	sta EI

; --- RepeatUntilProlog
l_1EF9

; optimize OK (test\tools\artur\artur.pas), line = 1120

	mwy S :bp2
	ldy I
	lda (:bp2),y
	cmp #$0E
	jne l_1F0E
	lda #$01
	sta RESULT
l_1F0E

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1121

	inc I

; optimize OK (test\tools\artur\artur.pas), line = 1122

	lda I
	cmp #$0A
	jeq l_1EF9x
	lda:sne RESULT
	jmp l_1EF9
l_1EF9x

; optimize OK (test\tools\artur\artur.pas), line = 1123

	lda RESULT
	jeq l_1F38

; --- RepeatUntilProlog
l_1F3A

; optimize OK (test\tools\artur\artur.pas), line = 1125

	mwy S :bp2
	ldy I
	lda (:bp2),y
	sta :STACKORIGIN+9
	mwy E :bp2
	ldy EI
	lda :STACKORIGIN+9
	cmp (:bp2),y
	jeq l_1F54
	lda #$00
	sta RESULT
l_1F54

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1126

	inc I

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1127

	inc EI

; optimize OK (test\tools\artur\artur.pas), line = 1128

	lda RESULT
	jeq l_1F3Ax
	lda EI
	cmp #$04
	jne l_1F3A
l_1F3Ax
l_1F38
@exit

; ------------------------------------------------------------

; Push BYTE / CHAR / SHORTINT / BOOLEAN
; as Pointer

	inx
	mva RESULT :STACKORIGIN,x

	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	eif

; ------------------------------------------------------------

S	= DATAORIGIN+$0AC3
E	= DATAORIGIN+$0AC5
RESULT	= DATAORIGIN+$0AC7
I	= DATAORIGIN+$0AC8
EI	= DATAORIGIN+$0AC9

@VarData	= S
@VarDataSize	= 7

	rts						; ret
.endl

.local	SHOWIOMENU					; PROCEDURE

	jmp l_1F82

.local	SHOWDIR						; PROCEDURE
	sta PAGE

; optimize OK (test\tools\artur\artur.pas), line = 1150

	lda PAGE
	asl @
	asl @
	asl @
	asl @
	sta SKIP

; optimize OK (test\tools\artur\artur.pas), line = 1151

	lda #$00
	sta DRAWRECT.C
	lda #$10
	sta DRAWRECT.H
	lda #$0C
	sta DRAWRECT.W
	lda #$04
	sta DRAWRECT.Y
	lda #$1A
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-13
	mva:rne CODEORIGIN+$022B+13-256,y adr.S+13-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1153

	lda #$15
	sta WRITESXY.Y
	lda #$1A
	sta WRITESXY.X
	jsr WRITESXY

; optimize FAIL ('SYSUTILS.FINDFIRST', test\tools\artur\artur.pas), line = 1154

	inx
	mva #$39 :STACKORIGIN,x
	mva #$22 :STACKORIGIN+STACKWIDTH,x
	inx
	mva #$3F :STACKORIGIN,x
	inx
	mva INFO :STACKORIGIN,x
	mva INFO+1 :STACKORIGIN+STACKWIDTH,x
	jsr SYSUTILS.FINDFIRST
	dex
	lda :STACKORIGIN+1,x
	jne l_1FAC
@

; optimize OK (test\tools\artur\artur.pas), line = 1155

	lda #$00
	sta ROW
	ldy #256-4
	mva:rne CODEORIGIN+$0240+4-256,y adr.EXT+4-256,y+

; --- RepeatUntilProlog
l_1FB2

; optimize FAIL ('B_CRT.ATASCII2ANTIC_054D', test\tools\artur\artur.pas), line = 1158

	inx
	mva INFO.NAME :STACKORIGIN,x
	mva INFO.NAME+1 :STACKORIGIN+STACKWIDTH,x
	jsr B_CRT.ATASCII2ANTIC_054D
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1159

	lda EXT
	sta HASEXT.E
	lda EXT+1
	sta HASEXT.E+1
	lda S
	sta HASEXT.S
	lda S+1
	sta HASEXT.S+1
	jsr HASEXT
	dex
	lda :STACKORIGIN+1,x
	jne l_1FC6

; optimize OK (test\tools\artur\artur.pas), line = 1160

	lda SKIP
	jne l_1FD9

; optimize OK (test\tools\artur\artur.pas), line = 1161

	lda #$04
	add ROW
	sta WRITESXY.Y
	lda #$1A
	sta WRITESXY.X
	jsr WRITESXY

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1162

	inc ROW
	jmp l_1FF4
l_1FD9

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1163

	dec SKIP
l_1FF4
l_1FC6

; optimize OK (test\tools\artur\artur.pas), line = 1165

	lda INFO
	sta SYSUTILS.FINDNEXT.F
	lda INFO+1
	sta SYSUTILS.FINDNEXT.F+1
	jsr SYSUTILS.FINDNEXT
	lda :STACKORIGIN,x
	sta NEXT
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1166

	lda NEXT
	jne l_1FB2x
	lda ROW
	cmp #$10
	jne l_1FB2
l_1FB2x

; optimize OK (test\tools\artur\artur.pas), line = 1167

	lda INFO
	sta SYSUTILS.FINDCLOSE.F
	lda INFO+1
	sta SYSUTILS.FINDCLOSE.F+1
	jsr SYSUTILS.FINDCLOSE
l_1FAC

; optimize OK (test\tools\artur\artur.pas), line = 1169

	lda NEXT
	jne l_2030
	mva #$01 adr.S
	mva #$1E adr.S+1

; optimize OK (test\tools\artur\artur.pas), line = 1171

	lda #$15
	sta WRITESXY.Y
	lda #$25
	sta WRITESXY.X
	jsr WRITESXY
l_2030

; optimize OK (test\tools\artur\artur.pas), line = 1173

	lda PAGE
	jeq l_2048
	mva #$01 adr.S
	mva #$1C adr.S+1

; optimize OK (test\tools\artur\artur.pas), line = 1175

	lda #$15
	sta WRITESXY.Y
	lda #$1A
	sta WRITESXY.X
	jsr WRITESXY
l_2048

; ------------------------------------------------------------

PAGE	= DATAORIGIN+$0AF2
ROW	= DATAORIGIN+$0AF3
adr.EXT	= [DATAORIGIN+$0AF4] .array [4]
.var EXT	= adr.EXT .word
SKIP	= DATAORIGIN+$0AF8

@VarData	= PAGE
@VarDataSize	= 7

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl
l_1F82

; optimize FAIL ('OPENMODAL', test\tools\artur\artur.pas), line = 1182

	jsr OPENMODAL

; optimize OK (test\tools\artur\artur.pas), line = 1183

	lda #$80
	sta DRAWRECT.C
	lda #$16
	sta DRAWRECT.H
	lda #$26
	sta DRAWRECT.W
	lda #$01
	sta DRAWRECT.Y
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-31
	mva:rne CODEORIGIN+$0245+31-256,y adr.S+31-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1185

	lda #$02
	sta WRITESXY.Y
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-37
	mva:rne CODEORIGIN+$0265+37-256,y adr.S+37-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1187

	lda #$03
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-18
	mva:rne CODEORIGIN+$028B+18-256,y adr.S+18-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1189

	lda #$05
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-19
	mva:rne CODEORIGIN+$029E+19-256,y adr.S+19-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1191

	lda #$07
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-19
	mva:rne CODEORIGIN+$02B2+19-256,y adr.S+19-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1193

	lda #$09
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-23
	mva:rne CODEORIGIN+$02C6+23-256,y adr.S+23-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1195

	lda #$0B
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-20
	mva:rne CODEORIGIN+$02DE+20-256,y adr.S+20-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1197

	lda #$0D
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-24
	mva:rne CODEORIGIN+$02F3+24-256,y adr.S+24-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1199

	lda #$0F
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-12
	mva:rne CODEORIGIN+$030C+12-256,y adr.S+12-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1201

	lda #$11
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-20
	mva:rne CODEORIGIN+$0319+20-256,y adr.S+20-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1203

	lda #$15
	sta WRITESXY.Y
	lda #$02
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 1205

	lda #$00
	sta DONE

; optimize OK (test\tools\artur\artur.pas), line = 1206

	sta DIRPAGE

; optimize OK (test\tools\artur\artur.pas), line = 1207

	sta NEXT

; optimize OK (test\tools\artur\artur.pas), line = 1208

	lda DIRPAGE
	jsr SHOWDIR

; --- RepeatUntilProlog
l_2085

; optimize FAIL ('CRT.READKEY', test\tools\artur\artur.pas), line = 1211

	jsr CRT.READKEY
	lda :STACKORIGIN,x
	sta C
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1212

	lda C
	cmp #$6E
	jne l_209B

; optimize FAIL ('CLEARBUFFER', test\tools\artur\artur.pas), line = 1213

	jsr CLEARBUFFER

; optimize OK (test\tools\artur\artur.pas), line = 1214

	lda #$01
	sta DONE
l_209B

; optimize OK (test\tools\artur\artur.pas), line = 1216

	lda C
	cmp #$6C
	jne l_20B5

; optimize OK (test\tools\artur\artur.pas), line = 1217

	lda #$08
	sta GETFILENAME.Y
	lda #$02
	sta GETFILENAME.X
	jsr GETFILENAME

; optimize OK (test\tools\artur\artur.pas), line = 1218

	lda #$C0
	sta LOADDATA.SIZE
	lda #$03
	sta LOADDATA.SIZE+1
	lda #$00
	sta LOADDATA.BUF
	lda #$78
	sta LOADDATA.BUF+1
	jsr LOADDATA

; optimize FAIL ('INITUNDOSTORAGE', test\tools\artur\artur.pas), line = 1219

	jsr INITUNDOSTORAGE

; optimize OK (test\tools\artur\artur.pas), line = 1220

	lda #$01
	sta DONE
l_20B5

; optimize OK (test\tools\artur\artur.pas), line = 1222

	lda C
	cmp #$73
	jne l_20D5

; optimize OK (test\tools\artur\artur.pas), line = 1223

	lda #$0A
	sta GETFILENAME.Y
	lda #$02
	sta GETFILENAME.X
	jsr GETFILENAME

; optimize OK (test\tools\artur\artur.pas), line = 1224

	lda #$C0
	sta SAVEDATA.SIZE
	lda #$03
	sta SAVEDATA.SIZE+1
	lda #$00
	sta SAVEDATA.BUF
	lda #$78
	sta SAVEDATA.BUF+1
	jsr SAVEDATA

; optimize OK (test\tools\artur\artur.pas), line = 1225

	lda #$01
	sta DONE
l_20D5

; optimize OK (test\tools\artur\artur.pas), line = 1227

	lda C
	cmp #$78
	jne l_20F4

; optimize OK (test\tools\artur\artur.pas), line = 1228

	lda #$0C
	sta GETFILENAME.Y
	lda #$02
	sta GETFILENAME.X
	jsr GETFILENAME

; optimize FAIL ('SAVEBINARY', test\tools\artur\artur.pas), line = 1229

	jsr SAVEBINARY

; optimize OK (test\tools\artur\artur.pas), line = 1230

	lda #$01
	sta DONE
l_20F4

; optimize OK (test\tools\artur\artur.pas), line = 1232

	lda C
	cmp #$63
	jne l_2111

; optimize OK (test\tools\artur\artur.pas), line = 1233

	lda #$0E
	sta GETFILENAME.Y
	lda #$02
	sta GETFILENAME.X
	jsr GETFILENAME

; optimize OK (test\tools\artur\artur.pas), line = 1234

	lda #$00
	sta LOADDATA.SIZE
	lda #$04
	sta LOADDATA.SIZE+1
	lda #$00
	sta LOADDATA.BUF
	lda #$74
	sta LOADDATA.BUF+1
	jsr LOADDATA

; optimize OK (test\tools\artur\artur.pas), line = 1235

	lda #$01
	sta DONE
l_2111

; optimize OK (test\tools\artur\artur.pas), line = 1237

	lda C
	cmp #$64
	jne l_2130

; optimize OK (test\tools\artur\artur.pas), line = 1238

	lda #$00
	sta SYSTEM.MOVE_045B.COUNT
	lda #$04
	sta SYSTEM.MOVE_045B.COUNT+1
	lda #$00
	sta SYSTEM.MOVE_045B.DEST
	lda #$74
	sta SYSTEM.MOVE_045B.DEST+1
	lda #$00
	sta SYSTEM.MOVE_045B.SOURCE
	lda #$E0
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 1239

	lda #$01
	sta DONE
l_2130

; optimize OK (test\tools\artur\artur.pas), line = 1241

	lda C
	cmp #$71
	jne l_214D

; optimize OK (test\tools\artur\artur.pas), line = 1242

	lda #$FF
	sta MODE

; optimize OK (test\tools\artur\artur.pas), line = 1243

	lda #$01
	sta DONE
l_214D

; optimize OK (test\tools\artur\artur.pas), line = 1245

	lda C
	cmp #$3E
	jne l_216A
	lda NEXT
	jne l_217D

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1246

	inc DIRPAGE

; optimize OK (test\tools\artur\artur.pas), line = 1247

	lda DIRPAGE
	jsr SHOWDIR
l_217D
l_216A

; optimize OK (test\tools\artur\artur.pas), line = 1249

	lda C
	cmp #$3C
	jne l_219C
	lda DIRPAGE
	jeq l_21AF

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1250

	dec DIRPAGE

; optimize OK (test\tools\artur\artur.pas), line = 1251

	lda DIRPAGE
	jsr SHOWDIR
l_21AF
l_219C

; optimize OK (test\tools\artur\artur.pas), line = 1253

	lda C
	cmp #$1B
	jne l_21CE
	lda #$01
	sta DONE
l_21CE

; optimize OK (test\tools\artur\artur.pas), line = 1254

	lda DONE
	jeq l_2085

; optimize FAIL ('CLOSEMODAL', test\tools\artur\artur.pas), line = 1255

	jsr CLOSEMODAL

; ------------------------------------------------------------

IO_X	= $01
IO_Y	= $01
IO_W	= $26
IO_H	= $16
DONE	= DATAORIGIN+$0ACA
adr.INFO	= [DATAORIGIN+$0ACB] .array [7]
.var INFO	= adr.INFO .word
INFO.ATTR	= DATAORIGIN+$0ACB
INFO.EXCLUDEATTR	= DATAORIGIN+$0ACC
adr.INFO.NAME	= [DATAORIGIN+$0ACD] .array [33]
.var INFO.NAME	= adr.INFO.NAME .word
INFO.FINDHANDLE	= DATAORIGIN+$0AEE
DIRPAGE	= DATAORIGIN+$0AF0
NEXT	= DATAORIGIN+$0AF1

@VarData	= DONE
@VarDataSize	= 40

@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl

.local	SHOWSETTINGS					; PROCEDURE

; optimize FAIL ('OPENMODAL', test\tools\artur\artur.pas), line = 1265

	jsr OPENMODAL

; optimize OK (test\tools\artur\artur.pas), line = 1266

	lda #$80
	sta DRAWRECT.C
	lda #$14
	sta DRAWRECT.H
	lda #$1E
	sta DRAWRECT.W
	lda #$02
	sta DRAWRECT.Y
	lda #$05
	sta DRAWRECT.X
	jsr DRAWRECT
	ldy #256-16
	mva:rne CODEORIGIN+$032E+16-256,y adr.S+16-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1268

	lda #$03
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-29
	mva:rne CODEORIGIN+$017A+29-256,y adr.S+29-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1270

	lda #$04
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; --- RepeatUntilProlog
l_21EF
	ldy #256-20
	mva:rne CODEORIGIN+$033F+20-256,y adr.S+20-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1274

	lda #$06
	sta WRITESXY.Y
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 1275

	lda #$02
	sta SYSTEM.HEXSTR.DIGITS
	lda CONFIG.EDITORBACKGROUNDCOLOR
	sta SYSTEM.HEXSTR.VALUE
	lda #$00
	sta SYSTEM.HEXSTR.VALUE+1
	sta SYSTEM.HEXSTR.VALUE+2
	sta SYSTEM.HEXSTR.VALUE+3
	jsr SYSTEM.HEXSTR
	jsr B_CRT.ATASCII2ANTIC_054D
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1276

	lda #$06
	sta WRITESXY.Y
	lda #$19
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-20
	mva:rne CODEORIGIN+$0354+20-256,y adr.S+20-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1279

	lda #$08
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 1280

	lda #$02
	sta SYSTEM.HEXSTR.DIGITS
	lda CONFIG.EDITORFOREGROUNDCOLOR
	sta SYSTEM.HEXSTR.VALUE
	lda #$00
	sta SYSTEM.HEXSTR.VALUE+1
	sta SYSTEM.HEXSTR.VALUE+2
	sta SYSTEM.HEXSTR.VALUE+3
	jsr SYSTEM.HEXSTR
	jsr B_CRT.ATASCII2ANTIC_054D
	lda :STACKORIGIN,x
	sta @move.src
	lda :STACKORIGIN+STACKWIDTH,x
	sta @move.src+1
	@moveSTRING S #41
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1281

	lda #$08
	sta WRITESXY.Y
	lda #$19
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-22
	mva:rne CODEORIGIN+$0369+22-256,y adr.S+22-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1284

	lda #$0A
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; optimize OK (test\tools\artur\artur.pas), line = 1285

	lda CONFIG.ARROWSRAW
	jeq l_2216
	ldy #256-4
	mva:rne CODEORIGIN+$0380+4-256,y adr.S+4-256,y+
	jmp l_2220
l_2216
	ldy #256-4
	mva:rne CODEORIGIN+$0385+4-256,y adr.S+4-256,y+
l_2220

; optimize OK (test\tools\artur\artur.pas), line = 1287

	lda #$0A
	sta WRITESXY.Y
	lda #$1B
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-19
	mva:rne CODEORIGIN+$038A+19-256,y adr.S+19-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1290

	lda #$0C
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-8
	mva:rne CODEORIGIN+$039E+8-256,y adr.S+8-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1292

	lda CONFIG.KEYCODEDISPLAY
	cmp #$02
	jne l_2238
	ldy #256-8
	mva:rne CODEORIGIN+$03A7+8-256,y adr.S+8-256,y+
l_2238

; optimize OK (test\tools\artur\artur.pas), line = 1293

	lda CONFIG.KEYCODEDISPLAY
	cmp #$01
	jne l_224D
	ldy #256-8
	mva:rne CODEORIGIN+$03B0+8-256,y adr.S+8-256,y+
l_224D

; optimize OK (test\tools\artur\artur.pas), line = 1294

	lda #$0C
	sta WRITESXY.Y
	lda #$18
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-12
	mva:rne CODEORIGIN+$03B9+12-256,y adr.S+12-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1297

	lda #$0E
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY
	ldy #256-19
	mva:rne CODEORIGIN+$03C6+19-256,y adr.S+19-256,y+

; optimize OK (test\tools\artur\artur.pas), line = 1300

	lda #$14
	sta WRITESXY.Y
	lda #$06
	sta WRITESXY.X
	jsr WRITESXY

; optimize FAIL ('CRT.READKEY', test\tools\artur\artur.pas), line = 1302

	jsr CRT.READKEY
	lda :STACKORIGIN,x
	sta C
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1303

	lda C
	cmp #$61
	jne l_226F
	ldy #1
	lda CONFIG.ARROWSRAW
	beq @+
	dey
@
	tya
	sta CONFIG.ARROWSRAW
l_226F

; optimize OK (test\tools\artur\artur.pas), line = 1304

	lda C
	cmp #$62
	jne l_228D
	lda CONFIG.EDITORBACKGROUNDCOLOR
	sta GETHEXVAL.DEFAULT
	lda #$06
	sta GETHEXVAL.Y
	lda #$19
	sta GETHEXVAL.X
	jsr GETHEXVAL
	lda :STACKORIGIN,x
	sta CONFIG.EDITORBACKGROUNDCOLOR
	dex
l_228D

; optimize OK (test\tools\artur\artur.pas), line = 1305

	lda C
	cmp #$66
	jne l_22AB
	lda CONFIG.EDITORFOREGROUNDCOLOR
	sta GETHEXVAL.DEFAULT
	lda #$08
	sta GETHEXVAL.Y
	lda #$19
	sta GETHEXVAL.X
	jsr GETHEXVAL
	lda :STACKORIGIN,x
	sta CONFIG.EDITORFOREGROUNDCOLOR
	dex
l_22AB

; optimize OK (test\tools\artur\artur.pas), line = 1306

	lda C
	cmp #$63
	jne l_22C9

; optimize FAIL (0, test\tools\artur\artur.pas), line = 1307

	inc CONFIG.KEYCODEDISPLAY

; optimize OK (test\tools\artur\artur.pas), line = 1308

	lda CONFIG.KEYCODEDISPLAY
	cmp #$03
	jne l_22E0
	lda #$00
	sta CONFIG.KEYCODEDISPLAY
l_22E0
l_22C9

; optimize OK (test\tools\artur\artur.pas), line = 1310

	lda C
	cmp #$73
	jne l_22FB

; optimize OK (test\tools\artur\artur.pas), line = 1311

	lda #$0E
	sta B_CRT.CRT_GOTOXY.Y
	lda #$06
	sta B_CRT.CRT_GOTOXY.X
	jsr B_CRT.CRT_GOTOXY

; optimize FAIL ('SAVECONFIG', test\tools\artur\artur.pas), line = 1312

	jsr SAVECONFIG

; optimize OK (test\tools\artur\artur.pas), line = 1313

	lda #$1B
	sta C
l_22FB

; optimize OK (test\tools\artur\artur.pas), line = 1315

	lda C
	cmp #$1B
	jne l_21EF

; optimize FAIL ('CLOSEMODAL', test\tools\artur\artur.pas), line = 1317

	jsr CLOSEMODAL

; ------------------------------------------------------------

OPT_X	= $05
OPT_Y	= $02
OPT_W	= $1E
OPT_H	= $14
@exit
	.ifdef @new
	lda <@VarData
	sta :ztmp
	lda >@VarData
	ldy #@VarDataSize-1
	jmp @FreeMem
	els
	rts						; ret
	eif
.endl
l_03E1

; optimize FAIL ('SYSTEM.PAUSE_0472', test\tools\artur\artur.pas), line = 1332

	jsr SYSTEM.PAUSE_0472

	lda VVBLKD
	sta OLDVBL
	lda VVBLKD+1
	sta OLDVBL+1

	lda VDSLST
	sta OLDDLI
	lda VDSLST+1
	sta OLDDLI+1

; optimize OK (test\tools\artur\artur.pas), line = 1335

	lda <VBL
	ldy #5
	sta wsync
	dey
	rne
	sta VVBLKD
	lda >VBL
	sta VVBLKD+1

; optimize OK (test\tools\artur\artur.pas), line = 1336

	mva <DLI VDSLST
	mva >DLI VDSLST+1

; optimize OK (test\tools\artur\artur.pas), line = 1337

	lda #$00
	sta ATARI.SDLSTL
	lda #$70
	sta ATARI.SDLSTL+1

; optimize OK (test\tools\artur\artur.pas), line = 1338

	lda #$C0
	sta ATARI.NMIEN

; optimize OK (test\tools\artur\artur.pas), line = 1339

	lda #$18
	sta B_CRT.CRT_INIT_05C7.HEIGHT
	lda #$28
	sta B_CRT.CRT_INIT_05C7.WIDTH
	lda #$00
	sta B_CRT.CRT_INIT_05C7.VRAM_ADDRESS
	lda #$7C
	sta B_CRT.CRT_INIT_05C7.VRAM_ADDRESS+1
	jsr B_CRT.CRT_INIT_05C7

; optimize OK (test\tools\artur\artur.pas), line = 1341

	lda #$00
	sta SYSTEM.MOVE_045B.COUNT
	lda #$04
	sta SYSTEM.MOVE_045B.COUNT+1
	lda #$00
	sta SYSTEM.MOVE_045B.DEST
	lda #$74
	sta SYSTEM.MOVE_045B.DEST+1
	lda #$00
	sta SYSTEM.MOVE_045B.SOURCE
	lda #$E0
	sta SYSTEM.MOVE_045B.SOURCE+1
	.local +MAIN.SYSTEM.MOVE_045B
	m@INLINE
	.endl

; optimize OK (test\tools\artur\artur.pas), line = 1342

	lda #$74
	sta EDITORCHARSET

; optimize OK (test\tools\artur\artur.pas), line = 1343

	lda #$0A
	sta $02D9

; optimize OK (test\tools\artur\artur.pas), line = 1344

	lda #$05
	sta $02DA

; optimize OK (test\tools\artur\artur.pas), line = 1346

	lda #$92
	sta CONFIG.EDITORBACKGROUNDCOLOR

; optimize OK (test\tools\artur\artur.pas), line = 1347

	lda #$9A
	sta CONFIG.EDITORFOREGROUNDCOLOR

; optimize FAIL ('CLEAREDIT', test\tools\artur\artur.pas), line = 1349

	jsr CLEAREDIT

; optimize FAIL ('INITPMG', test\tools\artur\artur.pas), line = 1350

	jsr INITPMG

; optimize FAIL ('INITCURSOR', test\tools\artur\artur.pas), line = 1351

	jsr INITCURSOR

; optimize FAIL ('INITUNDOSTORAGE', test\tools\artur\artur.pas), line = 1352

	jsr INITUNDOSTORAGE

; optimize FAIL ('LOADCONFIG', test\tools\artur\artur.pas), line = 1353

	jsr LOADCONFIG

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 1355

	jsr SHOWMENUBAR

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1356

	jsr SHOWSTATUS

; optimize FAIL ('SHOWHELP', test\tools\artur\artur.pas), line = 1357

	jsr SHOWHELP

; --- RepeatUntilProlog
l_2341

; optimize FAIL ('SYSTEM.PAUSE_0472', test\tools\artur\artur.pas), line = 1360

	jsr SYSTEM.PAUSE_0472

; optimize OK (test\tools\artur\artur.pas), line = 1364

	lda KEYREPEATCOUNTER
	jne l_2354

; optimize FAIL ('B_CRT.CRT_STARTPRESSED', test\tools\artur\artur.pas), line = 1365

	jsr B_CRT.CRT_STARTPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_235F
	jsr SHOWIOMENU
l_235F

; optimize FAIL ('B_CRT.CRT_SELECTPRESSED', test\tools\artur\artur.pas), line = 1366

	jsr B_CRT.CRT_SELECTPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_236D
	jsr NEXTMODE
l_236D

; optimize FAIL ('B_CRT.CRT_OPTIONPRESSED', test\tools\artur\artur.pas), line = 1367

	jsr B_CRT.CRT_OPTIONPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_237B
	jsr SHOWSETTINGS
l_237B

; optimize FAIL ('B_CRT.CRT_HELPPRESSED', test\tools\artur\artur.pas), line = 1368

	jsr B_CRT.CRT_HELPPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_2389
	jsr SHOWHELP
l_2389

; optimize OK (test\tools\artur\artur.pas), line = 1370

	lda KEYDOWN
	jeq l_2399

; optimize OK (test\tools\artur\artur.pas), line = 1372

	lda #$80
	jsr CHECKCURSORKEYS

; optimize OK (test\tools\artur\artur.pas), line = 1373

	lda CONFIG.ARROWSRAW
	jeq l_23A8
	lda #$00
	jsr CHECKCURSORKEYS
l_23A8

; optimize OK (test\tools\artur\artur.pas), line = 1375

	lda KEY
	cmp #$27
	jne l_23BF

; optimize OK (test\tools\artur\artur.pas), line = 1376

	ldy #1
	lda INVERT
	beq @+
	dey
@
	tya
	sta INVERT

; optimize OK (test\tools\artur\artur.pas), line = 1377

	lda BRUSH
	eor #$80
	sta BRUSH

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 1378

	jsr SHOWMENUBAR

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1379

	jsr SHOWSTATUS

; optimize OK (test\tools\artur\artur.pas), line = 1380

	lda #$00
	sta KEYDOWN
l_23BF

; optimize OK (test\tools\artur\artur.pas), line = 1383

	lda KEY
	cmp #$3C
	jne l_23ED

; optimize FAIL ('BRUSHSELECTOR', test\tools\artur\artur.pas), line = 1384

	jsr BRUSHSELECTOR
	lda :STACKORIGIN,x
	sta BRUSH
	dex

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1385

	jsr SHOWSTATUS

; optimize OK (test\tools\artur\artur.pas), line = 1386

	lda #$00
	sta KEYDOWN
l_23ED

; optimize OK (test\tools\artur\artur.pas), line = 1389

	lda KEY
	cmp #$7C
	jne l_240B

; optimize OK (test\tools\artur\artur.pas), line = 1390

	ldy CURSOR
	lda #$7C
	add CURSOR+1
	sta :bp+1
	lda (:bp),y
	sta BRUSH

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1391

	jsr SHOWSTATUS

; optimize OK (test\tools\artur\artur.pas), line = 1392

	lda #$00
	sta KEYDOWN
l_240B

; optimize OK (test\tools\artur\artur.pas), line = 1395

	lda KEY
	cmp #$2C
	jne l_242F

; optimize FAIL ('HISTORYBACK', test\tools\artur\artur.pas), line = 1396

	jsr HISTORYBACK

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1397

	jsr SHOWSTATUS

; optimize OK (test\tools\artur\artur.pas), line = 1398

	lda #$00
	sta KEYDOWN
l_242F

; optimize OK (test\tools\artur\artur.pas), line = 1401

	lda KEY
	cmp #$6C
	jne l_244A

; optimize FAIL ('HISTORYFWD', test\tools\artur\artur.pas), line = 1402

	jsr HISTORYFWD

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1403

	jsr SHOWSTATUS

; optimize OK (test\tools\artur\artur.pas), line = 1404

	lda #$00
	sta KEYDOWN
l_244A

; optimize OK (test\tools\artur\artur.pas), line = 1407

	lda KEY
	cmp #$5C
	jne l_2465

; optimize OK (test\tools\artur\artur.pas), line = 1408

	ldy #1
	lda STATUSCUSTOMCHARSET
	beq @+
	dey
@
	tya
	sta STATUSCUSTOMCHARSET

; optimize OK (test\tools\artur\artur.pas), line = 1409

	lda #$00
	sta KEYDOWN
l_2465

; optimize OK (test\tools\artur\artur.pas), line = 1412

	lda KEY
	cmp #$B4
	jne l_2487

; optimize FAIL ('TRYUNDO', test\tools\artur\artur.pas), line = 1413

	jsr TRYUNDO

; optimize FAIL ('READCURSORCHAR', test\tools\artur\artur.pas), line = 1414

	jsr READCURSORCHAR

; optimize OK (test\tools\artur\artur.pas), line = 1415

	lda #$00
	sta KEYDOWN
l_2487

; optimize OK (test\tools\artur\artur.pas), line = 1417

	lda KEY
	cmp #$F4
	jne l_24A2

; optimize FAIL ('TRYREDO', test\tools\artur\artur.pas), line = 1418

	jsr TRYREDO

; optimize FAIL ('READCURSORCHAR', test\tools\artur\artur.pas), line = 1419

	jsr READCURSORCHAR

; optimize OK (test\tools\artur\artur.pas), line = 1420

	lda #$00
	sta KEYDOWN
l_24A2
l_2399

; optimize FAIL ('READJOYSTICK', test\tools\artur\artur.pas), line = 1425

	jsr READJOYSTICK

; optimize OK (test\tools\artur\artur.pas), line = 1427

	lda JOYX
	jne l_24CCx
	lda JOYY
	jeq l_24CC
l_24CCx

; optimize OK (test\tools\artur\artur.pas), line = 1428

	lda JOYY
	sta MOVECURSOR.DY
	lda JOYX
	sta MOVECURSOR.DX
	jsr MOVECURSOR

; optimize OK (test\tools\artur\artur.pas), line = 1429

	lda #$04
	sta KEYREPEATCOUNTER
l_24CC
l_2354

; optimize OK (test\tools\artur\artur.pas), line = 1436

	lda MODE
	jne l_24EE

; optimize OK (test\tools\artur\artur.pas), line = 1437

	lda JOYFIRE
	jne l_2501

; optimize FAIL ('POKEBRUSH', test\tools\artur\artur.pas), line = 1438

	jsr POKEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1439

	lda BRUSH
	jsr USEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1440

	lda #$01
	sta JOYFIRE

; optimize OK (test\tools\artur\artur.pas), line = 1441

	lda #$00
	sta KEYDOWN
l_2501

; optimize OK (test\tools\artur\artur.pas), line = 1443

	lda KEYDOWN
	jeq l_251D

; optimize OK (test\tools\artur\artur.pas), line = 1444

	lda KEY
	cmp #$0C
	jne l_2530

; optimize FAIL ('POKEBRUSH', test\tools\artur\artur.pas), line = 1445

	jsr POKEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1446

	lda BRUSH
	jsr USEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1447

	lda CURSORFORWARD
	jeq l_2542
	lda #$00
	sta MOVECURSOR.DY
	lda #$01
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_2542

; optimize OK (test\tools\artur\artur.pas), line = 1448

	lda #$00
	sta KEYDOWN
l_2530

; optimize OK (test\tools\artur\artur.pas), line = 1450

	lda KEY
	cmp #$77
	jne l_2560

; optimize OK (test\tools\artur\artur.pas), line = 1451

	ldy #1
	lda CURSORFORWARD
	beq @+
	dey
@
	tya
	sta CURSORFORWARD

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 1452

	jsr SHOWMENUBAR

; optimize OK (test\tools\artur\artur.pas), line = 1453

	lda #$00
	sta KEYDOWN
l_2560

; optimize OK (test\tools\artur\artur.pas), line = 1455

	lda KEY
	cmp #$21
	jne l_2583

; optimize FAIL ('WRITESPACE', test\tools\artur\artur.pas), line = 1456

	jsr WRITESPACE

; optimize OK (test\tools\artur\artur.pas), line = 1457

	lda CURSORFORWARD
	jeq l_2591
	lda #$00
	sta MOVECURSOR.DY
	lda #$01
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_2591
l_2583

; optimize OK (test\tools\artur\artur.pas), line = 1459

	lda CURSORFORWARD
	jeq l_25A5

; optimize OK (test\tools\artur\artur.pas), line = 1460

	lda KEY
	cmp #$34
	jne l_25B8

; optimize OK (test\tools\artur\artur.pas), line = 1461

	lda #$00
	sta MOVECURSOR.DY
	lda #$FF
	sta MOVECURSOR.DX
	jsr MOVECURSOR

; optimize FAIL ('WRITESPACE', test\tools\artur\artur.pas), line = 1462

	jsr WRITESPACE
l_25B8
l_25A5
l_251D

; optimize OK (test\tools\artur\artur.pas), line = 1467

	lda KEYDOWN
	jeq l_25CF

; optimize FAIL ('SETBRUSHFROMKEY', test\tools\artur\artur.pas), line = 1468

	jsr SETBRUSHFROMKEY

; optimize FAIL ('POKEBRUSH', test\tools\artur\artur.pas), line = 1469

	jsr POKEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1470

	lda BRUSH
	jsr USEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1471

	lda CURSORFORWARD
	jeq l_25E2
	lda #$00
	sta MOVECURSOR.DY
	lda #$01
	sta MOVECURSOR.DX
	jsr MOVECURSOR
l_25E2

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1472

	jsr SHOWSTATUS
l_25CF
l_24EE

; optimize OK (test\tools\artur\artur.pas), line = 1479

	lda MODE
	cmp #$01
	jne l_25FF

; optimize OK (test\tools\artur\artur.pas), line = 1480

	lda JOYFIRE
	jne l_2612

; optimize OK (test\tools\artur\artur.pas), line = 1481

	lda #$01
	sta JOYFIRE

; optimize OK (test\tools\artur\artur.pas), line = 1482

	sta PENDOWN

; optimize OK (test\tools\artur\artur.pas), line = 1483

	lda #$14
	sta KEYREPEATCOUNTER
l_2612

; optimize OK (test\tools\artur\artur.pas), line = 1485

	lda KEYDOWN
	jeq l_262D

; optimize OK (test\tools\artur\artur.pas), line = 1486

	lda KEY
	cmp #$1C
	jne l_2640

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 1487

	jsr CLEARSELECTION

; optimize OK (test\tools\artur\artur.pas), line = 1488

	lda #$00
	sta KEYDOWN
l_2640

; optimize OK (test\tools\artur\artur.pas), line = 1490

	lda KEY
	cmp #$0C
	jne l_265A

; optimize OK (test\tools\artur\artur.pas), line = 1491

	lda #$01
	sta PENDOWN

; optimize OK (test\tools\artur\artur.pas), line = 1492

	lda #$00
	sta KEYDOWN
l_265A

; optimize OK (test\tools\artur\artur.pas), line = 1495

	lda KEY
	cmp #$21
	jne l_2677

; optimize FAIL ('WRITESPACE', test\tools\artur\artur.pas), line = 1496

	jsr WRITESPACE

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 1497

	jsr CLEARSELECTION

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1498

	jsr SHOWSTATUS
l_2677

; optimize OK (test\tools\artur\artur.pas), line = 1500

	lda C
	cmp #$64
	jne l_268F
	lda #$00
	jsr SELECTTOOL
l_268F

; optimize OK (test\tools\artur\artur.pas), line = 1501

	lda C
	cmp #$6C
	jne l_26A6
	lda #$01
	jsr SELECTTOOL
l_26A6

; optimize OK (test\tools\artur\artur.pas), line = 1502

	lda C
	cmp #$66
	jne l_26BD
	lda #$02
	jsr SELECTTOOL
l_26BD

; optimize OK (test\tools\artur\artur.pas), line = 1503

	lda C
	cmp #$62
	jne l_26D4
	lda #$03
	jsr SELECTTOOL
l_26D4
l_262D

; optimize OK (test\tools\artur\artur.pas), line = 1505

	lda KEYDOWN
	jeq l_26E7

; optimize FAIL ('SETBRUSHFROMKEY', test\tools\artur\artur.pas), line = 1506

	jsr SETBRUSHFROMKEY

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1507

	jsr SHOWSTATUS
l_26E7

; optimize OK (test\tools\artur\artur.pas), line = 1510

	lda PENDOWN
	jeq l_26F8

; optimize OK (test\tools\artur\artur.pas), line = 1511

	lda DRAWTOOL
	jne l_270B

; optimize FAIL ('POKEBRUSH', test\tools\artur\artur.pas), line = 1512

	jsr POKEBRUSH

; optimize OK (test\tools\artur\artur.pas), line = 1513

	lda BRUSH
	jsr USEBRUSH
	jmp l_271A
l_270B

; optimize OK (test\tools\artur\artur.pas), line = 1515

	lda P1X
	cmp #$FF
	jne l_272C

; optimize OK (test\tools\artur\artur.pas), line = 1516

	lda CURSORX
	sta P1X

; optimize OK (test\tools\artur\artur.pas), line = 1517

	lda CURSORY
	sta P1Y
	jmp l_2742
l_272C

; optimize OK (test\tools\artur\artur.pas), line = 1519

	lda P2X
	cmp #$FF
	jne l_2754

; optimize OK (test\tools\artur\artur.pas), line = 1520

	lda CURSORX
	sta P2X

; optimize OK (test\tools\artur\artur.pas), line = 1521

	lda CURSORY
	sta P2Y

; optimize OK (test\tools\artur\artur.pas), line = 1522

	lda DRAWTOOL
	cmp #$01
	jne l_2773
	jsr DRAWLINE
l_2773

; optimize OK (test\tools\artur\artur.pas), line = 1523

	lda DRAWTOOL
	cmp #$02
	jne l_2789
	jsr DRAWFRAME
l_2789

; optimize OK (test\tools\artur\artur.pas), line = 1524

	lda DRAWTOOL
	cmp #$03
	jne l_279F
	jsr DRAWBLOCK
l_279F

; optimize FAIL ('READCURSORCHAR', test\tools\artur\artur.pas), line = 1525

	jsr READCURSORCHAR

; optimize OK (test\tools\artur\artur.pas), line = 1526

	lda BRUSH
	jsr USEBRUSH

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 1527

	jsr CLEARSELECTION
l_2754
l_2742
l_271A

; optimize OK (test\tools\artur\artur.pas), line = 1530

	lda #$00
	sta PENDOWN
l_26F8
l_25FF

; optimize OK (test\tools\artur\artur.pas), line = 1537

	lda MODE
	cmp #$02
	jne l_27C5

; optimize OK (test\tools\artur\artur.pas), line = 1538

	lda JOYFIRE
	jne l_27D8

; optimize OK (test\tools\artur\artur.pas), line = 1539

	lda #$01
	sta JOYFIRE

; optimize OK (test\tools\artur\artur.pas), line = 1540

	sta PENDOWN

; optimize OK (test\tools\artur\artur.pas), line = 1541

	lda #$14
	sta KEYREPEATCOUNTER
l_27D8

; optimize OK (test\tools\artur\artur.pas), line = 1543

	lda KEYDOWN
	jeq l_27F3

; optimize OK (test\tools\artur\artur.pas), line = 1544

	lda KEY
	cmp #$1C
	jne l_2806

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 1545

	jsr CLEARSELECTION

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 1546

	jsr SHOWMENUBAR

; optimize OK (test\tools\artur\artur.pas), line = 1547

	lda #$00
	sta KEYDOWN
l_2806

; optimize OK (test\tools\artur\artur.pas), line = 1549

	lda KEY
	cmp #$0C
	jne l_2821

; optimize OK (test\tools\artur\artur.pas), line = 1550

	lda #$01
	sta PENDOWN

; optimize OK (test\tools\artur\artur.pas), line = 1551

	lda #$00
	sta KEYDOWN
l_2821

; optimize OK (test\tools\artur\artur.pas), line = 1553

	lda P2X
	cmp #$FF
	jeq l_283E

; optimize OK (test\tools\artur\artur.pas), line = 1554

	lda C
	cmp #$63
	jne l_2851
	lda #$00
	jsr COPYBLOCK
l_2851

; optimize OK (test\tools\artur\artur.pas), line = 1555

	lda C
	cmp #$6D
	jne l_2868
	lda #$01
	jsr COPYBLOCK
l_2868

; optimize OK (test\tools\artur\artur.pas), line = 1556

	lda C
	cmp #$73
	jne l_287F
	jsr SAVEBLOCK
l_287F

; optimize OK (test\tools\artur\artur.pas), line = 1557

	lda C
	cmp #$69
	jne l_2895
	jsr INVERTBLOCK
l_2895

; optimize OK (test\tools\artur\artur.pas), line = 1558

	lda C
	cmp #$66
	jne l_28AB
	jsr DRAWBLOCK
l_28AB

; optimize FAIL ('READCURSORCHAR', test\tools\artur\artur.pas), line = 1559

	jsr READCURSORCHAR

; optimize FAIL ('SHOWSTATUS', test\tools\artur\artur.pas), line = 1560

	jsr SHOWSTATUS
l_283E
l_27F3

; optimize OK (test\tools\artur\artur.pas), line = 1565

	lda PENDOWN
	jeq l_28C1

; optimize OK (test\tools\artur\artur.pas), line = 1566

	lda P1X
	cmp #$FF
	jne l_28D4

; optimize OK (test\tools\artur\artur.pas), line = 1567

	lda CURSORX
	sta P1X

; optimize OK (test\tools\artur\artur.pas), line = 1568

	lda CURSORY
	sta P1Y
	jmp l_28EA
l_28D4

; optimize OK (test\tools\artur\artur.pas), line = 1570

	lda P2X
	cmp #$FF
	jne l_28FC

; optimize OK (test\tools\artur\artur.pas), line = 1571

	lda CURSORX
	sta P2X

; optimize OK (test\tools\artur\artur.pas), line = 1572

	lda CURSORY
	sta P2Y

; optimize OK (test\tools\artur\artur.pas), line = 1573

	sta XORCURSOR.Y
	lda CURSORX
	sta XORCURSOR.X
	jsr XORCURSOR

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 1574

	jsr SHOWMENUBAR
	jmp l_291A
l_28FC

; optimize FAIL ('CLEARSELECTION', test\tools\artur\artur.pas), line = 1576

	jsr CLEARSELECTION

; optimize FAIL ('SHOWMENUBAR', test\tools\artur\artur.pas), line = 1577

	jsr SHOWMENUBAR
l_291A
l_28EA

; optimize OK (test\tools\artur\artur.pas), line = 1580

	lda #$00
	sta PENDOWN
l_28C1
l_27C5

; optimize OK (test\tools\artur\artur.pas), line = 1584

	lda KEYDOWN
	jeq l_2930
	lda #$00
	sta KEYDOWN
l_2930

; optimize FAIL ('CRT.KEYPRESSED', test\tools\artur\artur.pas), line = 1586

	jsr CRT.KEYPRESSED
	dex
	lda :STACKORIGIN+1,x
	jeq l_2941

; optimize FAIL ('CRT.READKEY', test\tools\artur\artur.pas), line = 1587

	jsr CRT.READKEY
	lda :STACKORIGIN,x
	sta C
	dex

; optimize OK (test\tools\artur\artur.pas), line = 1588

	lda ATARI.KBCODE
	sta KEY

; optimize OK (test\tools\artur\artur.pas), line = 1589

	lda #$01
	sta KEYDOWN
l_2941

; optimize OK (test\tools\artur\artur.pas), line = 1592

	lda MODE
	cmp #$FF
	jne l_2341

; optimize FAIL ('SYSTEM.PAUSE_0472', test\tools\artur\artur.pas), line = 1596

	jsr SYSTEM.PAUSE_0472

; optimize FAIL ('B_PMG.PMG_DISABLE', test\tools\artur\artur.pas), line = 1597

	jsr B_PMG.PMG_DISABLE

; optimize OK (test\tools\artur\artur.pas), line = 1598

	lda OLDVBL
	ldy #5
	sta wsync
	dey
	rne
	sta VVBLKD
	lda OLDVBL+1
	sta VVBLKD+1

; optimize OK (test\tools\artur\artur.pas), line = 1599

	mva OLDDLI VDSLST
	mva OLDDLI+1 VDSLST+1

; optimize OK (test\tools\artur\artur.pas), line = 1600

	lda #$40
	sta ATARI.NMIEN

; optimize OK (test\tools\artur\artur.pas), line = 1601

	lda #$00
	jsr CRT.TEXTMODE
	lda #$00
	jmp @halt

; ------------------------------------------------------------

SCREEN_WIDTH	= $28
SCREEN_HEIGHT	= $18
SCREEN_SIZE	= $03C0
FULLSCREEN_UNDO_COUNT	= $08
UNDO_ACTIONS_COUNT	= $40
BIN_HEADER_SIZE	= $69
FREE_BOTTOM	= $7000
PMG	= $7000
DISPLAY_LIST_ADDRESS	= $7000
BIN_HEADER	= $7100
CUSTOM_CHARSET	= $7400
VIDEO_BUFFER	= $7800
MENU_BAR	= $7BC0
VIDEO_RAM_ADDRESS	= $7C00
STATUS_BAR	= $7FC0
KEY_MAP	= $8000
UNDO_SCREENS	= $8100
DEFAULT_CHARSET	= $E000
NONE	= $FF
UNDO_NONE	= $FF
UNDO_FROM_BUFFER	= $FE
MODE_TYPE	= $00
MODE_DRAW	= $01
MODE_BLOCK	= $02
MODE_LAST	= $03
MODE_EXIT	= $FF
TOOL_DRAW	= $00
TOOL_LINE	= $01
TOOL_FRAME	= $02
TOOL_BLOCK	= $03
KEY_DELAY	= $0A
JOY_DELAY	= $04
FIRE_DELAY	= $14
OS_REPEAT_DELAY	= $0A
OS_REPEAT_RATE	= $05
PMG_XOFFSET	= $30
PMG_YOFFSET	= $0F
BG_DEFAULT	= $92
FG_DEFAULT	= $9A
MAX_BRUSH_HISTORY	= $11
CODE_DISPLAY_NONE	= $00
CODE_DISPLAY_ANTIC	= $01
CODE_DISPLAY_ATASCII	= $02
adr.VERSION	= [DATAORIGIN+$08B4] .array [6]
.var VERSION	= adr.VERSION .word
adr.CONFIG	= [DATAORIGIN+$08BA] .array [8]
.var CONFIG	= adr.CONFIG .word
CONFIG.EDITORBACKGROUNDCOLOR	= DATAORIGIN+$08BA
CONFIG.EDITORFOREGROUNDCOLOR	= DATAORIGIN+$08BB
CONFIG.ARROWSRAW	= DATAORIGIN+$08BC
CONFIG.KEYCODEDISPLAY	= DATAORIGIN+$08BD
B	= DATAORIGIN+$08BE
H	= DATAORIGIN+$08BF
W	= DATAORIGIN+$08C0
adr.S	= [DATAORIGIN+$08C1] .array [41]
.var S	= adr.S .word
C	= DATAORIGIN+$08EA
KEY	= DATAORIGIN+$08EB
.var AFILE	= DATAORIGIN+$08EC .word
JOYX	= DATAORIGIN+$08F8
JOYY	= DATAORIGIN+$08F9
JOYFIRE	= DATAORIGIN+$08FA
BRUSH	= DATAORIGIN+$08FB
KEYREPEATCOUNTER	= DATAORIGIN+$08FC
OLDVBL	= DATAORIGIN+$08FD
OLDDLI	= DATAORIGIN+$08FF
MODE	= DATAORIGIN+$0901
DRAWTOOL	= DATAORIGIN+$0902
CURSORX	= DATAORIGIN+$0903
CURSORY	= DATAORIGIN+$0904
CURSOR	= DATAORIGIN+$0905
CURSORCHAR	= DATAORIGIN+$0907
KEYDOWN	= DATAORIGIN+$0908
PENDOWN	= DATAORIGIN+$0909
INVERT	= DATAORIGIN+$090A
CURSORFORWARD	= DATAORIGIN+$090B
STATUSCUSTOMCHARSET	= DATAORIGIN+$090C
EDITORCHARSET	= DATAORIGIN+$090D
P1X	= DATAORIGIN+$090E
P2X	= DATAORIGIN+$090F
P1Y	= DATAORIGIN+$0910
P2Y	= DATAORIGIN+$0911
adr.BRUSHHISTORY	= [DATAORIGIN+$0912] .array [18]
.var BRUSHHISTORY	= adr.BRUSHHISTORY .word
BRUSHINDEX	= DATAORIGIN+$0924
BRUSHFRAMEPOSX	= DATAORIGIN+$0925
adr.KEYCHARS	= $8000
.var KEYCHARS	= adr.KEYCHARS .word
adr.UNDOBUFFERS	= [DATAORIGIN+$0926] .array [8] .word
.var UNDOBUFFERS	= adr.UNDOBUFFERS .word
adr.UNDOACTIONS	= [DATAORIGIN+$0936] .array [64] [64]
.var UNDOACTIONS	= adr.UNDOACTIONS .word
UNDOBUFFERIDX	= DATAORIGIN+$09F6
UNDOACTIONSIDX	= DATAORIGIN+$09F7
REDOCOUNT	= DATAORIGIN+$09F8
adr.LINEOFFSET	= [DATAORIGIN+$09F9] .array [24] .word
.var LINEOFFSET	= adr.LINEOFFSET .word
@exit

@halt	ldx #$00
	txs
	.ifdef MAIN.@DEFINES.ROMOFF
	inc portb
	.endif

	ldy #$01

	rts

; ------------------------------------------------------------

IOCB@COPY	:16 brk

; ------------------------------------------------------------

.local	@DEFINES
ATARI
.endl

.local	@RESOURCE
.endl

.endl							; MAIN

; ------------------------------------------------------------
; ------------------------------------------------------------

.macro	UNITINITIALIZATION

	.ifdef MAIN.SYSTEM.@UnitInit
	jsr MAIN.SYSTEM.@UnitInit
	eif

	.ifdef MAIN.ATARI.@UnitInit
	jsr MAIN.ATARI.@UnitInit
	eif

	.ifdef MAIN.CRT.@UnitInit
	jsr MAIN.CRT.@UnitInit
	eif

	.ifdef MAIN.DOS.@UnitInit
	jsr MAIN.DOS.@UnitInit
	eif

	.ifdef MAIN.STRUTILS.@UnitInit
	jsr MAIN.STRUTILS.@UnitInit
	eif

	.ifdef MAIN.SYSUTILS.@UnitInit
	jsr MAIN.SYSUTILS.@UnitInit
	eif

	.ifdef MAIN.B_CRT.@UnitInit
	jsr MAIN.B_CRT.@UnitInit
	eif

	.ifdef MAIN.B_SYSTEM.@UnitInit
	jsr MAIN.B_SYSTEM.@UnitInit
	eif

	.ifdef MAIN.B_PMG.@UnitInit
	jsr MAIN.B_PMG.@UnitInit
	eif

	.ifdef MAIN.JOYSTICK.@UnitInit
	jsr MAIN.JOYSTICK.@UnitInit
	eif
.endm

; ------------------------------------------------------------

	ift .SIZEOF(MAIN.SYSTEM) > 0
	.print 'SYSTEM: ',MAIN.SYSTEM,'..',MAIN.SYSTEM+.SIZEOF(MAIN.SYSTEM)-1
	eif

	ift .SIZEOF(MAIN.ATARI) > 0
	.print 'ATARI: ',MAIN.ATARI,'..',MAIN.ATARI+.SIZEOF(MAIN.ATARI)-1
	eif

	ift .SIZEOF(MAIN.CRT) > 0
	.print 'CRT: ',MAIN.CRT,'..',MAIN.CRT+.SIZEOF(MAIN.CRT)-1
	eif

	ift .SIZEOF(MAIN.DOS) > 0
	.print 'DOS: ',MAIN.DOS,'..',MAIN.DOS+.SIZEOF(MAIN.DOS)-1
	eif

	ift .SIZEOF(MAIN.STRUTILS) > 0
	.print 'STRUTILS: ',MAIN.STRUTILS,'..',MAIN.STRUTILS+.SIZEOF(MAIN.STRUTILS)-1
	eif

	ift .SIZEOF(MAIN.SYSUTILS) > 0
	.print 'SYSUTILS: ',MAIN.SYSUTILS,'..',MAIN.SYSUTILS+.SIZEOF(MAIN.SYSUTILS)-1
	eif

	ift .SIZEOF(MAIN.B_CRT) > 0
	.print 'B_CRT: ',MAIN.B_CRT,'..',MAIN.B_CRT+.SIZEOF(MAIN.B_CRT)-1
	eif

	ift .SIZEOF(MAIN.B_SYSTEM) > 0
	.print 'B_SYSTEM: ',MAIN.B_SYSTEM,'..',MAIN.B_SYSTEM+.SIZEOF(MAIN.B_SYSTEM)-1
	eif

	ift .SIZEOF(MAIN.B_PMG) > 0
	.print 'B_PMG: ',MAIN.B_PMG,'..',MAIN.B_PMG+.SIZEOF(MAIN.B_PMG)-1
	eif

	ift .SIZEOF(MAIN.JOYSTICK) > 0
	.print 'JOYSTICK: ',MAIN.JOYSTICK,'..',MAIN.JOYSTICK+.SIZEOF(MAIN.JOYSTICK)-1
	eif

	.print 'CODE: ',CODEORIGIN,'..',*-1

; ------------------------------------------------------------

	.align $0004

DATAORIGIN
.by  $28 $00 $18 $00 $2D $0C $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $03 $00 $0E $00 $04 $90 $8E $98
.by  $98 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $01 $80 $14 <[DATAORIGIN+$08FD] >[DATAORIGIN+$08FD] <[DATAORIGIN+$08FF]
.by  >[DATAORIGIN+$08FF] $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $FF $FF  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $28 $00 $50 $00 $78  $00 $A0 $00 $C8 $00 $F0 $00 $18
.by  $01 $40 $01 $68 $01 $90 $01 $B8  $01 $E0 $01 $08 $02 $30 $02 $58  $02 $80 $02 $A8 $02 $D0 $02 $F8
.by  $02 $20 $03 $48 $03 $70 $03 $98  $03 $00 $00 $00 $00 $00 $00 $00  $00 $00 $00 $00 $00 $00 $00 $00
.by  $00 $3F $21 $21 $21 $21 $3F $50  $70 $90 $B0 $48 $40 $38 $30 $03  $03 $03 $03 $FF

VARINITSIZE	= *-DATAORIGIN
VARDATASIZE	= 2809

PROGRAMSTACK	= DATAORIGIN+VARDATASIZE

	.print 'DATA: ',DATAORIGIN,'..',PROGRAMSTACK

	run START

; ------------------------------------------------------------

.macro	STATICDATA
.by  $04 $54 $52 $55 $45 $00 $05 $46  $41 $4C $53 $45 $00 $00 $00 $04  $90 $8E $98 $98 $00 $12 $AD $AF
.by  $A4 $A5 $00 $00 $00 $00 $00 $00  $B8 $00 $00 $00 $B9 $00 $00 $00  $00 $05 $74 $79 $70 $65 $00 $00
.by  $05 $64 $72 $61 $77 $00 $00 $05  $62 $6C $6F $63 $6B $00 $28 $A3  $A1 $B0 $B3 $9A $62 $72 $75 $73
.by  $68 $00 $00 $B2 $A5 $B4 $B5 $B2  $AE $9A $70 $61 $69 $6E $74 $00  $00 $29 $2E $33 $25 $32 $34 $00
.by  $29 $2E $36 $25 $32 $33 $25 $00  $06 $A9 $AE $B3 $A5 $B2 $B4 $00  $07 $A9 $AE $B6 $A5 $B2 $B3 $A5
.by  $00 $28 $A3 $A1 $B0 $B3 $9A $62  $72 $75 $73 $68 $00 $00 $00 $A4  $72 $61 $77 $00 $00 $00 $AC $69
.by  $6E $65 $00 $00 $00 $A6 $72 $61  $6D $65 $00 $00 $00 $A2 $6C $6F  $63 $6B $00 $04 $A4 $B2 $A1 $B7
.by  $00 $04 $AC $A9 $AE $A5 $00 $05  $A6 $B2 $A1 $AD $A5 $00 $05 $A2  $AC $AF $A3 $AB $00 $1F $33 $65
.by  $6C $65 $63 $74 $00 $61 $72 $65  $61 $00 $77 $69 $74 $68 $00 $B2  $A5 $B4 $B5 $B2 $AE $00 $6F $72
.by  $00 $A6 $A9 $B2 $A5 $00 $20 $A3  $6F $70 $79 $00 $00 $AD $6F $76  $65 $00 $00 $A6 $69 $6C $6C $00
.by  $00 $A9 $6E $76 $65 $72 $74 $00  $00 $B3 $61 $76 $65 $00 $00 $00  $02 $00 $00 $00 $0F $25 $6E $74
.by  $65 $72 $00 $26 $69 $6C $65 $6E  $61 $6D $65 $1A $00 $0C $20 $20  $20 $20 $20 $20 $20 $20 $20 $20
.by  $20 $20 $00 $0C $B3 $E5 $EC $E5  $E3 $F4 $80 $A2 $F2 $F5 $F3 $E8  $00 $0D $24 $65 $76 $69 $63 $65
.by  $00 $25 $72 $72 $6F $72 $01 $00  $0D $22 $61 $64 $00 $26 $69 $6C  $65 $6E $61 $6D $65 $01 $00 $08
.by  $33 $75 $63 $63 $65 $73 $73 $0E  $00 $0C $41 $52 $54 $55 $52 $43  $46 $47 $2E $53 $59 $53 $00 $11
.by  $B3 $A1 $B6 $E9 $AE $A7 $80 $A4  $A1 $B4 $A1 $80 $A2 $AC $AF $A3  $AB $00 $1C $8D $8D $8D $8D $8D
.by  $8D $8D $8D $8D $8D $8D $8D $8D  $8D $8D $8D $8D $8D $8D $8D $8D  $8D $8D $8D $8D $8D $8D $8D $00
.by  $1C $A1 $B2 $B4 $F5 $F2 $80 $8D  $80 $F6 $8E $80 $80 $80 $80 $80  $80 $E2 $EF $E3 $E9 $E1 $EE $F5
.by  $87 $92 $90 $92 $90 $00 $12 $A1  $B4 $A1 $B3 $A3 $A9 $A9 $80 $A1  $F2 $F4 $80 $A5 $E4 $E9 $F4 $EF
.by  $F2 $00 $11 $33 $34 $21 $32 $34  $80 $80 $8D $80 $A9 $8F $AF $80  $ED $E5 $EE $F5 $00 $14 $33 $25
.by  $2C $25 $23 $34 $80 $8D $80 $E3  $E8 $E1 $EE $E7 $E5 $80 $ED $EF  $E4 $E5 $00 $11 $2F $30 $34 $29
.by  $2F $2E $80 $8D $80 $F3 $E5 $F4  $F4 $E9 $EE $E7 $F3 $00 $14 $28  $25 $2C $30 $80 $80 $80 $8D $80
.by  $F4 $E8 $E9 $F3 $80 $F3 $E3 $F2  $E5 $E5 $EE $00 $0D $B0 $F2 $E5  $F3 $F3 $80 $61 $6E $79 $80 $EB
.by  $E5 $F9 $00 $0C $80 $80 $80 $80  $80 $80 $80 $80 $80 $80 $80 $80  $00 $05 $44 $3A $2A $2E $2A $00
.by  $03 $33 $39 $33 $00 $1E $A9 $8F  $AF $80 $AD $A5 $AE $B5 $80 $80  $80 $80 $80 $80 $80 $80 $80 $80
.by  $80 $80 $80 $80 $80 $80 $A6 $E9  $EC $E5 $F3 $9A $00 $24 $8D $8D  $8D $8D $8D $8D $8D $8D $8D $8D
.by  $8D $8D $8D $8D $8D $8D $8D $8D  $8D $8D $8D $8D $8D $80 $8D $8D  $8D $8D $8D $8D $8D $8D $8D $8D
.by  $8D $8D $00 $11 $2E $E5 $F7 $80  $E9 $ED $E1 $E7 $E5 $80 $88 $E3  $EC $E5 $E1 $F2 $89 $00 $12 $2C
.by  $EF $E1 $E4 $80 $A1 $B4 $A1 $B3  $A3 $A9 $A9 $80 $E9 $ED $E1 $E7  $E5 $00 $12 $33 $E1 $F6 $E5 $80
.by  $A1 $B4 $A1 $B3 $A3 $A9 $A9 $80  $E9 $ED $E1 $E7 $E5 $00 $16 $B3  $E1 $F6 $E5 $80 $E5 $38 $E5 $E3
.by  $F5 $F4 $E1 $E2 $EC $E5 $80 $E2  $E9 $EE $E1 $F2 $F9 $00 $13 $AC  $EF $E1 $E4 $80 $E3 $F5 $F3 $F4
.by  $EF $ED $80 $23 $E8 $E1 $F2 $F3  $E5 $F4 $00 $17 $B2 $E5 $F3 $F4  $EF $F2 $E5 $80 $24 $E5 $E6 $E1
.by  $F5 $EC $F4 $80 $E3 $E8 $E1 $F2  $F3 $E5 $F4 $00 $0B $31 $F5 $E9  $F4 $80 $F4 $EF $80 $A4 $AF $B3
.by  $00 $13 $B0 $F2 $E5 $F3 $F3 $80  $25 $33 $23 $80 $F4 $EF $80 $EC  $E5 $E1 $F6 $E5 $80 $00 $0F $A5
.by  $A4 $E9 $B4 $AF $B2 $80 $B3 $A5  $B4 $B4 $E9 $AE $A7 $B3 $00 $13  $22 $E1 $E3 $EB $E7 $F2 $EF $F5
.by  $EE $E4 $80 $E3 $EF $EC $EF $F2  $9A $80 $84 $00 $13 $26 $EF $F2  $E5 $E7 $F2 $EF $F5 $EE $E4 $80
.by  $E3 $EF $EC $EF $F2 $9A $80 $84  $00 $15 $21 $F2 $F2 $EF $F7 $F3  $80 $F7 $E9 $F4 $E8 $EF $F5 $F4
.by  $80 $A3 $F4 $F2 $EC $9A $80 $00  $03 $6F $6E $80 $00 $03 $6F $66  $66 $00 $12 $23 $E8 $E1 $F2 $E3
.by  $EF $E4 $E5 $80 $E4 $E9 $F3 $F0  $EC $E1 $F9 $9A $80 $00 $07 $6F  $66 $66 $80 $80 $80 $80 $00 $07
.by  $21 $34 $21 $33 $23 $29 $29 $00  $07 $21 $6E $74 $69 $63 $80 $80  $00 $0B $33 $E1 $F6 $E5 $80 $E3
.by  $EF $EE $E6 $E9 $E7 $00 $12 $B0  $F2 $E5 $F3 $F3 $80 $25 $33 $23  $80 $F4 $EF $80 $EC $E5 $E1 $F6
.by  $E5 $00 $6C $6A $3B $FF $FF $6B  $2B $2A $6F $FF $70 $75 $9B $69  $2D $3D $76 $FF $63 $FF $FF $62
.by  $78 $7A $34 $FF $33 $36 $1B $35  $32 $31 $2C $20 $2E $6E $FF $6D  $2F $81 $72 $FF $65 $79 $7F $74
.by  $77 $71 $39 $FF $30 $37 $7E $38  $3E $FF $66 $68 $64 $FF $82 $67  $73 $61 $4C $4A $3A $FF $FF $4B
.by  $5C $5E $4F $FF $50 $55 $FF $49  $5F $7C $56 $FF $43 $FF $FF $42  $58 $5A $24 $FF $23 $26 $FF $25
.by  $22 $21 $5B $3B $5D $4E $FF $4D  $3F $FF $52 $FF $45 $59 $FF $54  $57 $51 $28 $FF $29 $27 $FF $40
.by  $FF $FF $46 $48 $44 $FF $FF $47  $53 $41 $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF
.by  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF
.by  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF
.by  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF
.by  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF
.by  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF $FF $FF $FF $FF $FF $FF  $FF $FF
.endm

	end
